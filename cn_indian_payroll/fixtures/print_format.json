[
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": ".m1\n{\n    font-size: 20px;\n    font-family: serif;\n}\n\n.m2\n{\n    font-size: 14px;\n    font-family: serif;\n    \n    \n}\n\n\n\n.f1\n{\n    font-size: 14px;\n    font-family: serif;\n}\n\n.f2\n{\n    border:none;\n    font-size: 16px;\n    font-family: serif;\n}\n\n\n\n        /*tr.row1 td {*/\n        /*    border: 1px solid black; */\n        /*}*/",
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 1,
  "doc_type": "Salary Slip",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "<!DOCTYPE html>\n<html>\n    \n                {{letter_head}}\n           \n    \n<head>\n    \n</head>\n<body>\n    \n\n\n    \n   \n\n<p class=\"m1\">TDS WORK SHEET for the month of {{ frappe.utils.format_date(doc.start_date, \"MMMM, YYYY\") }}  </p>\n\n\n\n<table class=\"f2\" style=\"width:100%;\">\n  <tr>\n    <td class=\"f2\">Employee Name</td>\n    <td class=\"f2\">Pan</td>\n    <td class=\"f2\">Designation</td>\n    <td class=\"f2\">Tax Regime</td>\n  </tr>\n  \n  \n  {% set employee = frappe.get_doc(\"Employee\", doc.employee) %}\n       {% set tax_slab1 = frappe.get_list(\"Salary Structure Assignment\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"name\", \"employee\", \"income_tax_slab\"], order_by=\"from_date desc\") %}\n                {% if tax_slab1 %}\n                   {% set employee_tax_slab = tax_slab1[0].income_tax_slab %}\n                    \n               {%endif%}\n  \n  \n  \n   <tr>\n    <td class=\"f2\">{{doc.employee_name}}</td>\n    <td class=\"f2\">{%if employee.pan_number%} {{employee.pan_number}} {%endif%}</td>\n    <td class=\"f2\">{%if employee.designation%} {{employee.designation}} {%endif%}</td>\n    <td class=\"f2\">{{employee_tax_slab}}</td>\n  </tr>\n  \n  \n  \n  \n  \n</table>\n\n\n\n\n\n<hr style=\"border-style: dotted; border-width: 1px; border-color: black;\">\n\n\n    <p style=\"font-size: 16px;font-family: serif;\">Details of salary paid and any other income tax and tax deducted</p>\n\n<table style=\"width:100%;border: 1px solid black;\" >\n  <tr class=\"row2\" style=\"border: 1px solid black;\">\n    <th class=\"m2\" style=\"border: 1px solid black;\">Particulars</th>\n    <th class=\"m2\" style=\"border: 1px solid black;\">Actual</th> \n    <th class=\"m2\" style=\"border: 1px solid black;\">Projection</th>\n    <th class=\"m2\" style=\"border: 1px solid black;\">Total</th>\n  </tr>\n  \n  \n  \n \n\n<tr>\n\n  \n  \n<td style=\"border: 1px solid black;\">\n    <b class=\"m2\">1)Gross Earnings</b></br></br>\n    \n    {%- for row in doc.earnings -%}\n    \n    \n     {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n     \n      {% if perquisite.is_tax_applicable==1 and perquisite.custom_perquisite==0 and perquisite.custom_is_reimbursement==0 %}\n\n            <p class=\"m2\">{{ row.salary_component }}</p>\n            \n        {%endif%}\n    \n    {%- endfor -%}\n    \n \n    \n    {% set ss_slip = frappe.get_list(\"Salary Structure Assignment\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"*\"], order_by=\"from_date desc\") %}\n               \n               {% if ss_slip[0].custom__car_perquisite==1 or ss_slip[0].custom_driver_provided_by_company==1%}\n               \n               \n               \n                <p style=\"font-size: 14px; font-family: serif;\">Total Perquisite Amount </p>\n            {% endif %}\n            \n            \n    \n    \n    \n \n </br></br>\n \n <p class=\"m2\"><b>Total Income</b></p>\n\n\n</td>\n\n<td style=\"border: 1px solid black;\" >\n    \n    \n</br></br>\n\n    {%- for row in doc.earnings -%}\n    \n    {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n     \n    {% if perquisite.is_tax_applicable==1 and perquisite.custom_perquisite==0 and perquisite.custom_is_reimbursement==0%}\n    \n    \n    \n        <p class=\"m2\"  style=\"text-align:right\">Rs.{{ (row.year_to_date|round |int) }}</p>\n        \n        {%endif%}\n        \n        \n        \n        \n        \n        \n    {%- endfor -%}\n    \n    \n     {% set ss_slip = frappe.get_list(\"Salary Structure Assignment\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"*\"], order_by=\"from_date desc\") %}\n               \n               {% if ss_slip[0].custom__car_perquisite==1 or ss_slip[0].custom_driver_provided_by_company==1%}\n               \n               {%if ss_slip[0].custom__car_perquisite==1%}\n                {% set car_perquisite = ss_slip[0].custom_car_perquisite_as_per_rules |int %}\n                {%else%}\n                {% set car_perquisite = 0  %}\n                {%endif%}\n                \n                {%if ss_slip[0].custom_driver_provided_by_company==1%}\n                {% set driver_perquisite = ss_slip[0].custom_driver_perquisite_as_per_rules |int %}\n                {%else%}\n                {% set driver_perquisite = 0 %}\n                {%endif%}\n                {% set per_total = car_perquisite + driver_perquisite %}\n                 <p class=\"m2\"  style=\"text-align:right\"> Rs.{{ (per_total*12 |int|round) }}</p>\n            {% endif %}\n    \n   \n    \n   \n    \n\n\n    \n\n\n\n</td>\n\n<td style=\"border: 1px solid black;\"></br></br>\n\n    {%- for row in doc.earnings -%}\n    \n     {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n     \n       {% if perquisite.is_tax_applicable==1 and perquisite.custom_perquisite==0 and perquisite.custom_is_reimbursement==0%}\n     \n     \n     \n     \n    \n    \n\n<p class=\"m2\" style=\"text-align:right\">\n    Rs.{{(row.custom_actual_amount * doc.custom_month_count) |round|int}}\n</p>\n\n   \n    {%endif%}\n {%- endfor -%}\n \n\n\n\n</td>\n<td style=\"border: 1px solid black;\"></br></br>\n\n{% set array = [] %}\n    {%- for row in doc.earnings -%}\n    \n    \n     {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n     \n     {% if perquisite.is_tax_applicable==1 and perquisite.custom_perquisite==0 and perquisite.custom_is_reimbursement==0%}\n    \n    \n\n    <p class=\"m2\"  style=\"text-align:right\"> Rs.{{((row.custom_actual_amount *doc.custom_month_count)+ row.year_to_date)|round|int}}</p>\n    {% set _ = array.append(row.year_to_date+(row.custom_actual_amount *doc.custom_month_count)|int|round) %}\n    \n    {%endif%}\n     \n {%- endfor -%}\n \n\n     \n     {% set ss_slip = frappe.get_list(\"Salary Structure Assignment\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"*\"], order_by=\"from_date desc\") %}\n               \n                {% if ss_slip[0].custom__car_perquisite==1 or ss_slip[0].custom_driver_provided_by_company==1%}\n               \n               {%if ss_slip[0].custom__car_perquisite==1%}\n                {% set car_perquisite = ss_slip[0].custom_car_perquisite_as_per_rules |int  %}\n                {%else%}\n                {% set car_perquisite = 0  %}\n                {%endif%}\n                \n                {%if ss_slip[0].custom_driver_provided_by_company==1%}\n                {% set driver_perquisite = ss_slip[0].custom_driver_perquisite_as_per_rules|int  %}\n                {%else%}\n                {% set driver_perquisite = 0 %}\n                {%endif%}\n                {% set per_total = car_perquisite + driver_perquisite %}\n                 <p class=\"m2\"  style=\"text-align:right\"> Rs.{{ per_total*12 |int}}</p>\n                 {% set _ = array.append(per_total*12) %}\n    {% endif %}\n \n \n \n \n \n \n \n \n {#\n \n {% set total = doc.custom_total_income_with_taxable_component%}\n #}\n {% set total=array|sum%}\n </br></br>\n \n \n        \n        \n     <p class=\"m2\" style=\"text-align:right\"><b>Rs.{{total|round|int}}</b></p>\n     \n       \n\n</td>\n\n\n</tr>\n\n\n<tr>\n\n  \n  \n<td style=\"border: 1px solid black;\" >\n    <b class=\"m2\">2)Allowance to the extent exempt under section 10</b></br></br>\n    \n    \n    \n    \n    \n    {% set tax_exemption = frappe.get_list(\"Employee Tax Exemption Declaration\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"*\"]) %}\n   \n    {% if tax_exemption %}\n        {% set section = frappe.get_doc(\"Employee Tax Exemption Declaration\", tax_exemption[0].name) %}\n        \n        {%if section.monthly_house_rent>0%}\n        \n         <p class=\"m2\" >House Rent Allowance</p>\n        {%endif%}\n        \n        {% for i in section.declarations %}\n            \n             {% if i.exemption_category in [\"Section 10(13A)\", \"Section 10(14)\"] %}\n                <p class=\"m2\" >{{ i.exemption_sub_category }}</p>\n            {% endif %}\n        {% endfor %}\n        \n        \n        \n        \n    {% endif %}\n \n </br></br>\n \n <p><b class=\"m2\"> Total of Allowance to the extent exempt under section 10</b></p>\n \n </td>\n\n\n<td style=\"border: 1px solid black;\">\n    {% set tax_exemption = frappe.get_list(\"Employee Tax Exemption Declaration\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"name\", \"employee\"]) %}\n   \n    {% if tax_exemption %}\n    </br></br>\n     {% set array1 = [] %}\n        {% set section = frappe.get_doc(\"Employee Tax Exemption Declaration\", tax_exemption[0].name) %}\n         {%if section.monthly_house_rent>0%}\n        \n         <p class=\"m2\" style=\"text-align:right\">Rs.{{section.annual_hra_exemption|int}}</p>\n          {% set _ = array1.append(section.annual_hra_exemption) %}\n        {%endif%}\n        \n       \n        {% for i in section.declarations %}\n             {% if i.exemption_category in [\"Section 10(13A)\", \"Section 10(14)\"] %}\n            \n            \n                <p class=\"m2\"  style=\"text-align:right\">Rs.{{ i.amount |round}}</p>\n                 {% set _ = array1.append(i.amount) %}\n            {% endif %}\n        {% endfor %}\n        \n         {% set tax_total = array1 | sum | round | int %}\n         \n         \n         \n    {%else%}\n    \n    <p class=\"m2\">Rs.0</p>\n     {% set tax_total = 0 %}\n        \n    {% endif %}\n\n\n\n\n \n\n\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    \n    \n    \n    {%if tax_total%}\n    \n   </br></br></br></br></br></br> <p class=\"m2\"  style=\"text-align:right\"><b>Rs.{{tax_total|int|round}}</b></p>\n    {%else%}\n    </br></br></br></br><p class=\"m2\"  style=\"text-align:right\"><b>Rs.0</b></p>\n    {%endif%}\n</td>\n\n\n\n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">3) Total After Exemption (1-2)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    {%if total or tax_total%}\n   \n    \n    <p class=\"m2\"  style=\"text-align:right\"><b >Rs.{{ (total - tax_total) |round|int}}</b></p>\n    \n    {% else %}\n    <p><b class=\"m2\"  style=\"text-align:right\">Rs.0</b></p>\n    \n    {%endif%}\n\n    \n    \n</td>\n    \n</tr>\n\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">4) Taxable income under previous employment</b></p></br></br>\n   <p class=\"m2\">1. Income after exemption</p>\n   <p class=\"m2\">2. Less:Professional Tax</p>\n   \n   </br></br>\n   \n   <p><b class=\"m2\">Total taxable income under previous employment</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\"></br></br>\n    &nbsp;\n   <p class=\"m2\"  style=\"text-align:right\">Rs.0</p> \n   <p class=\"m2\"  style=\"text-align:right\">Rs.0</p>\n</td>\n\n<td style=\"border: 1px solid black;\"></br></br>\n    &nbsp;\n    <p class=\"m2\"  style=\"text-align:right\">Rs.0</p>\n    <p class=\"m2\"  style=\"text-align:right\">Rs.0</p>\n   \n</td>\n\n<td style=\"border: 1px solid black;\"></br></br></br></br></br></br></br></br>\n<p class=\"m2\"  style=\"text-align:right\"><b>Rs.0</b></p>   \n</td>\n    \n</tr>\n\n\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">5) Gross Total (3+4)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    \n     {%if total or tax_total%}\n     \n    <p class=\"m2\"  style=\"text-align:right\"><b >Rs.{{ (total - tax_total)|int|round}}</b></p>\n    \n    {%else%}\n    <p class=\"m2\"  style=\"text-align:right\">Rs.0</p>\n    \n    {%endif%}\n    \n</td>\n    \n</tr>\n\n\n\n\n<tr>\n    <td style=\"border: 1px solid black;\">\n        <p><b style=\"font-size: 14px;font-family: serif;\">6) Under Section 16</b></p></br>\n    {% set tax_exemption = frappe.get_list(\"Employee Tax Exemption Declaration\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"name\", \"employee\"]) %}\n   \n    {% if tax_exemption %}\n        {% set section = frappe.get_doc(\"Employee Tax Exemption Declaration\", tax_exemption[0].name) %}\n        \n        {% for i in section.declarations %}\n            {% if i.exemption_category == \"Section 16\" %}\n                <p class=\"m2\" > {{ i.exemption_sub_category}}</p>\n            {% endif %}\n        {% endfor %}\n        \n        \n    \n    {% endif %}\n    \n    <p class=\"m2\">Standard Deduction</p>\n    \n    </br></br>\n    <p><b class=\"m2\"> Total Under Section 16</b></p>\n    \n    </td>\n    \n    <td style=\"border: 1px solid black;\"></br></br>\n        {% set tax_exemption = frappe.get_list(\"Employee Tax Exemption Declaration\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"name\", \"employee\"]) %}\n   \n    {% if tax_exemption %}\n        {% set section = frappe.get_doc(\"Employee Tax Exemption Declaration\", tax_exemption[0].name) %}\n        {% set array2=[]%}\n        \n        {% for i in section.declarations %}\n            {% if i.exemption_category == \"Section 16\" %}\n                <p class=\"m2\"  style=\"text-align:right\"> Rs.{{ i.amount |round}}</p>\n                {% set _ = array2.append(i.amount) %}\n            {% endif %}\n        {% endfor %}\n        \n        \n    {%else%}\n    \n    <!--<p class=\"m2\">Rs.0</p>-->\n    \n    {% set form_16 = 0 %}\n        \n    {% endif %}\n    \n    <p class=\"m2\"  style=\"text-align:right\">Rs.50000</p>\n    {%if array2%}\n    \n    {% set _ = array2.append(50000) %}\n     {% set form_16 = array2 | sum %}\n     \n     {%else%}\n     \n     {% set form_16 =50000 %}\n     \n     \n       {% endif %}\n    \n    \n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\"></br></br></br></br></br></br>\n{%if form_16%}\n       <p class=\"m2\"  style=\"text-align:right\"><b >Rs.{{form_16|int|round}} </b></p>   \n{%endif%}\n</td>\n    \n\n</tr>\n\n\n\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">7) Income chargeble under Head Salaries (5-6)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n         {%if total or tax_total or form_16 %} \n         \n         <p class=\"m2\"  style=\"text-align:right\"><b>Rs.{{ (total - tax_total - form_16) |round| int }}</b></p>\n         \n         {%else%}\n         <p class=\"m2\"  style=\"text-align:right\"><b>Rs.0</b></p>\n         \n         {%endif%}\n</td>\n    \n</tr>\n\n\n\n\n\n\n<tr>\n     \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">8) Any Other income reported by employee</b></p>\n   </br>\n   <p class=\"f1\">Interest Paid on Home Loan</p>\n   <p class=\"f1\">Let Out Property</p></br>\n   \n   <p><b class=\"f1\">Total Income From Other Sources</b></p>\n   <p style=\"font-size: 10px;font-family: serif;\">Note: A maximum of Rs.200,000.00 is allowed as exemption\nfor housing loan interests on Self Occupied House Property\nand Let Out Property.</p>\n</td>\n\n<td style=\"border: 1px solid black;\"></br></br>\n\n {% set c_array11 = [] %}\n{% set tax_exemption = frappe.get_list(\"Employee Tax Exemption Declaration\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"name\", \"employee\"]) %}\n   \n    {% if tax_exemption %}\n        {% set section1 = frappe.get_doc(\"Employee Tax Exemption Declaration\", tax_exemption[0].name) %}\n        \n        \n        \n        {% for i in section1.declarations %}\n            {% if i.exemption_category == \"Section 80EE\" %}\n            <p class=\"m2\"  style=\"text-align:right\">Rs.-{{i.amount|round}}</p> \n           \n            {% set _ = c_array11.append(i.amount) %}\n           \n            \n            {% endif %}\n        {% endfor %}\n        \n         \n        {% set c_array11 = c_array11 | sum %}\n        \n        \n        {%else%}\n        <p class=\"m2\"  style=\"text-align:right\">Rs.0</p>\n        {% set c_array11 = 0 %}\n    {%endif%}\n \n    \n    <!--<p>value</p>-->\n    <p class=\"m2\"  style=\"text-align:right\">Rs.0</p></br>\n    \n    \n    \n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\"></br></br></br></br></br></br></br>\n\n{%if c_array11 %}\n<p class=\"m2\"  style=\"text-align:right\"><b>Rs.-{{c_array11|round|int}}</b></p> \n{%else%}\n<p class=\"m2\"  style=\"text-align:right\"><b>Rs.0</b></p>\n{%endif%}\n</td>\n    \n</tr>\n\n\n\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">9) Gross Total Income (7+8)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    {%set sum_tax=[]%}\n     {%if total or tax_total or form_16 or c_array11%} \n         \n         <p class=\"m2\"  style=\"text-align:right\"><b>Rs.{{ (total-tax_total-form_16-c_array11) |round|int}}</b></p>\n         {% set t1= (total-tax_total-form_16-c_array11) |round|int%}\n \n         \n         \n          {% set _ = sum_tax.append(t1) %}\n         \n         \n         \n         \n         \n         {%else%}\n         <p class=\"m2\"  style=\"text-align:right\"><b>Rs.0</b></p>\n         \n         {%endif%}\n    \n   \n\n</td>\n    \n</tr>\n\n\n\n\n<tr>\n     <td style=\"border: 1px solid black;\">\n        \n         <p><b class=\"m2\">10) Deduction under chapter VI-A</b></p></br>\n   \n       <p class=\"f1\"><b>80C</b></p>\n       \n       {% set c_array1 = [] %}\n\n   {% set tax_exemption = frappe.get_list(\"Employee Tax Exemption Declaration\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"name\", \"employee\"]) %}\n   \n    {% if tax_exemption %}\n        {% set section1 = frappe.get_doc(\"Employee Tax Exemption Declaration\", tax_exemption[0].name) %}\n        \n        \n        {% for i in section1.declarations %}\n            {% if i.exemption_category == \"Section 80C\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\">- Rs.{{ i.amount|round|int }}</span>\n                \n                {% set _ = c_array1.append(i.amount) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n        {% set c_array11 = c_array1 | sum %}\n       \n        \n    {% endif %}\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n            <p class=\"m2\">Qualifying</p></br>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n             \n            <p class=\"m2\">Deductible</p>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\" ><br><br><br><br><br><br>\n         \n         {%if c_array11%}\n             \n            <p class=\"m2\" style=\"text-align:right\"><b>RS.{{c_array11|int|round}}</b></p>\n            {%else%}\n             <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">Rs.0</p>\n            {%endif%}\n             \n             \n         </td>\n    \n</tr>\n\n\n\n<tr>\n     <td style=\"border: 1px solid black;\">\n        \n         \n   \n       <p class=\"f1\"><b>80CCC</b></p>\n    \n     {% set tax_exemption = frappe.get_list(\"Employee Tax Exemption Declaration\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"name\", \"employee\"]) %}\n   \n    {% if tax_exemption %}\n        {% set section2 = frappe.get_doc(\"Employee Tax Exemption Declaration\", tax_exemption[0].name) %}\n        \n        {% set c_array2 = [] %}\n        \n        {% for i in section2.declarations %}\n            {% if i.exemption_category == \"Section 80CCC\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\">- Rs.{{ i.amount |int}}</span>\n                {% set _ = c_array2.append(i.amount) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n         {% set c_array22 = c_array2 | sum %}\n       \n        \n    {% endif %}\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n            <p class=\"m2\">&nbsp;</p></br>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n             \n            <p class=\"m2\">&nbsp;</p>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\" ><br>\n          {%if c_array11%}\n             \n            <p class=\"m2\" style=\"text-align:right\"><b>Rs.{{c_array22}}</b></p>\n            {%else%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">Rs.0</p>\n\n             {%endif%}\n             \n         </td>\n    \n</tr>\n\n\n\n\n<tr>\n     <td style=\"border: 1px solid black;\">\n        \n         \n   \n       <p class=\"f1\"><b>80CCD</b></p>\n    \n     {% set tax_exemption = frappe.get_list(\"Employee Tax Exemption Declaration\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"name\", \"employee\"]) %}\n   \n    {% if tax_exemption %}\n        {% set section3 = frappe.get_doc(\"Employee Tax Exemption Declaration\", tax_exemption[0].name) %}\n        \n          {% set c_array3 = [] %}   \n          \n        {% for i in section3.declarations %}\n            {% if i.exemption_category == \"Section 80CCD\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\">- Rs.{{ i.amount|int|round }}</span>\n                {% set _ = c_array3.append(i.amount) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n       {% set c_array33 = c_array3 | sum %}\n        \n    {% endif %}\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n            <p class=\"m2\">&nbsp;</p></br>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n             \n            <p class=\"m2\">&nbsp;</p>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\" ><br>\n         \n         {%if c_array33%}\n             \n            <p class=\"m2\">{{c_array33}}</p>\n            {%else%}\n                        <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">Rs.0</p>\n\n            {%endif%}\n             \n             \n         </td>\n    \n</tr>\n\n<tr>\n    <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>Total (80C+80CCC+80CCD)</b> </p>\n     </td>\n      <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>&nbsp;</b> </p>\n     </td>\n      <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>&nbsp;</b> </p>\n     </td>\n      <td style=\"border: 1px solid black;\">\n          {%if c_array11 or c_array22 or c_array33%}\n     <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">Rs.{{ (c_array11 + c_array22 + c_array33)|int }}</p></b> </p>\n     {%else%}\n          <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">Rs.0</p></b> </p>\n\n     {%endif%}\n     \n     </td>\n</tr>\n\n\n\n\n<tr>\n    <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>80CCD(1B)</b></p>\n    \n    {% set tax_exemption = frappe.get_list(\"Employee Tax Exemption Declaration\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"name\", \"employee\"]) %}\n   \n    {% if tax_exemption %}\n        {% set section4 = frappe.get_doc(\"Employee Tax Exemption Declaration\", tax_exemption[0].name) %}\n        \n          {% set c_array4 = [] %}   \n          \n        {% for i in section4.declarations %}\n            {% if i.exemption_category == \"Section 80CCD(1B)\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\">- Rs.{{ i.amount |round|int}}</span>\n                {% set _ = c_array4.append(i.amount) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n       {% set c_array44 = c_array4 | sum %}\n        \n    {% endif %}\n    </td>\n    <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">\n            \n            {%if c_array44%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">Rs.{{c_array44|round|int}}</p></b> </p>\n            {%else%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">Rs.0</p></b> </p>\n\n            {%endif%}\n        </td>\n     \n</tr>\n\n\n\n\n<tr>\n    <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>80CCD(2)</b></p>\n    \n    {% set tax_exemption = frappe.get_list(\"Employee Tax Exemption Declaration\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"name\", \"employee\"]) %}\n   \n    {% if tax_exemption %}\n        {% set section5 = frappe.get_doc(\"Employee Tax Exemption Declaration\", tax_exemption[0].name) %}\n        \n          {% set c_array5 = [] %}   \n          \n        {% for i in section5.declarations %}\n            {% if i.exemption_category == \"Section 80CCD(2)\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\">- Rs.{{ i.amount|round|int}}</span>\n                {% set _ = c_array5.append(i.amount) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n       {% set c_array55 = c_array5 | sum %}\n        \n    {% endif %}\n    </td>\n    <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">\n            {%if c_array55%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">Rs.{{c_array55|round|int}}</p></b> </p>\n            {%else%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">Rs.0</p></b> </p>\n\n            {%endif%}\n        </td>\n     \n</tr>\n\n\n\n\n\n<tr>\n    <td>\n    <p class=\"f1\"><b>80D</b></p>\n    \n   \n    {% set tax_exemption = frappe.get_list(\"Employee Tax Exemption Declaration\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"name\", \"employee\"]) %}\n   \n    {% if tax_exemption %}\n        {% set section6 = frappe.get_doc(\"Employee Tax Exemption Declaration\", tax_exemption[0].name) %}\n        \n          {% set c_array6 = [] %}   \n          \n        {% for i in section6.declarations %}\n            {% if i.exemption_category == \"Section 80D\" %}\n            \n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp;\n                <span style=\"float: right;\">- Rs.{{ i.amount |int}}</span>\n                {% set _ = c_array6.append(i.amount) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n        \n     \n        \n       {% set c_array66 = c_array6 | sum %}\n        \n    {% endif %}\n    </td>\n    <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">\n            \n            {%if c_array66 %}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">Rs.{{c_array66|round|int}}</p></b> </p>\n            {%else%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">Rs.0</p></b> </p>\n\n            {%endif%}\n        </td>\n     \n</tr>\n\n\n<tr>\n    \n     <td style=\"border: 1px solid black;\">\n         <p class=\"f1\"><b>Total of Deductions under Chapter VI-A</b></p>\n\n     </td>\n     <td style=\"border: 1px solid black;\">\n         &nbsp;\n         \n     </td>\n     <td style=\"border: 1px solid black;\">&nbsp;\n         \n     </td>\n     <td style=\"border: 1px solid black;\">\n         \n          {%if c_array66 or c_array55 or c_array44 or c_array11 or c_array22 or c_array33 %}\n         \n         <p class=\"f1\" style=\"text-align:right\"><b>Rs.{{(c_array66+c_array55+c_array44+c_array11 + c_array22 + c_array33)|int|round}}</b></p>\n         {% set _ = sum_tax.append(c_array66+c_array55+c_array44+c_array11 + c_array22 + c_array33|int|round) %}\n         \n         \n         \n         {%else%}\n         <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">Rs.0</p></b> </p>\n     {%endif%}\n     </td>\n    \n</tr>\n\n\n{#\n\n<tr>\n\n <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">10) Deduction under chapter VI-A</b></p></br>\n   \n       <p class=\"f1\"><b>80C</b></p>\n       \n       {% set c_array1 = [] %}\n\n   {% set tax_exemption = frappe.get_list(\"Employee Tax Exemption Declaration\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"name\", \"employee\"]) %}\n   \n    {% if tax_exemption %}\n        {% set section1 = frappe.get_doc(\"Employee Tax Exemption Declaration\", tax_exemption[0].name) %}\n        \n        \n        {% for i in section1.declarations %}\n            {% if i.exemption_category == \"Section 80C\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\">- Rs.{{ i.amount|int }}</span>\n                \n                {% set _ = c_array1.append(i.amount) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n        {% set c_array11 = c_array1 | sum %}\n       \n        \n    {% endif %}\n    \n    </br>\n    \n    <p class=\"f1\"><b>80CCC</b></p>\n    \n     {% set tax_exemption = frappe.get_list(\"Employee Tax Exemption Declaration\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"name\", \"employee\"]) %}\n   \n    {% if tax_exemption %}\n        {% set section2 = frappe.get_doc(\"Employee Tax Exemption Declaration\", tax_exemption[0].name) %}\n        \n        {% set c_array2 = [] %}\n        \n        {% for i in section2.declarations %}\n            {% if i.exemption_category == \"Section 80CCC\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\">- Rs.{{ i.amount |int}}</span>\n                {% set _ = c_array2.append(i.amount) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n         {% set c_array22 = c_array2 | sum %}\n       \n        \n    {% endif %}\n    \n    \n    \n    <p class=\"f1\"><b>80CCD</b></p>\n    \n     {% set tax_exemption = frappe.get_list(\"Employee Tax Exemption Declaration\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"name\", \"employee\"]) %}\n   \n    {% if tax_exemption %}\n        {% set section3 = frappe.get_doc(\"Employee Tax Exemption Declaration\", tax_exemption[0].name) %}\n        \n          {% set c_array3 = [] %}   \n          \n        {% for i in section3.declarations %}\n            {% if i.exemption_category == \"Section 80CCD\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\">- Rs.{{ i.amount|int }}</span>\n                {% set _ = c_array3.append(i.amount) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n       {% set c_array33 = c_array3 | sum %}\n        \n    {% endif %}\n    </br>\n    \n    <p class=\"f1\"><b>Total (80C+80CCC+80CCD)</b> </p>\n    \n    </br>\n    \n    <p class=\"f1\"><b>80CCD(1B)</b></p>\n    \n    {% set tax_exemption = frappe.get_list(\"Employee Tax Exemption Declaration\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"name\", \"employee\"]) %}\n   \n    {% if tax_exemption %}\n        {% set section4 = frappe.get_doc(\"Employee Tax Exemption Declaration\", tax_exemption[0].name) %}\n        \n          {% set c_array4 = [] %}   \n          \n        {% for i in section4.declarations %}\n            {% if i.exemption_category == \"Section 80CCD(1B)\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\">- Rs.{{ i.amount |round}}</span>\n                {% set _ = c_array4.append(i.amount) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n       {% set c_array44 = c_array4 | sum %}\n        \n    {% endif %}\n    </br>\n    \n    <p class=\"f1\"><b>Total</b></p></br></br>\n    \n    \n    \n    \n    \n    \n    \n     <p class=\"f1\"><b>80CCD(2)</b></p>\n    \n    {% set tax_exemption = frappe.get_list(\"Employee Tax Exemption Declaration\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"name\", \"employee\"]) %}\n   \n    {% if tax_exemption %}\n        {% set section5 = frappe.get_doc(\"Employee Tax Exemption Declaration\", tax_exemption[0].name) %}\n        \n          {% set c_array5 = [] %}   \n          \n        {% for i in section5.declarations %}\n            {% if i.exemption_category == \"Section 80CCD(2)\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\">- Rs.{{ i.amount |int}}</span>\n                {% set _ = c_array5.append(i.amount) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n       {% set c_array55 = c_array5 | sum %}\n        \n    {% endif %}\n    </br>\n    \n    <p class=\"f1\"><b>Total</b></p></br></br>\n    \n    \n    \n    \n  \n    <p class=\"f1\"><b>80D</b></p>\n    \n   \n    {% set tax_exemption = frappe.get_list(\"Employee Tax Exemption Declaration\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"name\", \"employee\"]) %}\n   \n    {% if tax_exemption %}\n        {% set section6 = frappe.get_doc(\"Employee Tax Exemption Declaration\", tax_exemption[0].name) %}\n        \n          {% set c_array6 = [] %}   \n          \n        {% for i in section6.declarations %}\n            {% if i.exemption_category == \"Section 80D\" %}\n            \n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp;\n                <span style=\"float: right;\">- Rs.{{ i.amount |int}}</span>\n                {% set _ = c_array6.append(i.amount) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n        \n     \n        \n       {% set c_array66 = c_array6 | sum %}\n        \n    {% endif %}\n    </br></br>\n    \n    \n    <p class=\"f1\"><b>Total</b></p>\n   \n    \n    </br></br>\n    \n    <p class=\"f1\"><b>Total of Deductions under Chapter VI-A</b></p>\n    \n    \n    \n    \n   \n   \n   \n   \n</td>\n\n<td style=\"border: 1px solid black;\">\n    \n    <p class=\"m2\">Qualifying</p></br></br></br></br></br></br></br></br></br></br></br>\n    \n    {% if c_array11 or c_array22 or c_array33 %}\n    {% set a1 = [] %} \n    \n    {% if c_array11 > 150000 %}\n        <p class=\"f1\"  style=\"text-align:right\">Rs.150000</p>\n        <br><br><br><br><br>\n        {% set v1 = 150000 %}\n    {% else %}\n        <p class=\"f1\"  style=\"text-align:right\">Rs.{{ (c_array11 + c_array22 + c_array33)|int }}</p>\n        <br><br><br><br><br>\n        {% set v1 = c_array11 + c_array22 + c_array33 %}\n    {% endif %}\n    \n    {% set _ = a1.append(v1) %}\n    \n    \n    \n{% endif %}\n\n    \n        {% if c_array4%}\n    \n            <p class=\"f1\"  style=\"text-align:right\">Rs.{{c_array44|int}}</p></br></br></br></br></br></br>\n              {% set _ = a1.append(c_array44) %}\n            \n            {%else%}\n             \n              \n              \n    \n    {%endif%}\n    \n    {%if c_array5 %}\n    \n          <p class=\"f1\"  style=\"text-align:right\">Rs.{{c_array55|int}}</p></p></br></br></br></br></br></p></br></br></br>\n           {% set _ = a1.append(c_array55) %}\n          \n          {%else%}\n          <p class=\"f1\"  style=\"text-align:right\">Rs.0</p></p></p></br></br></br></br></br>\n      \n    {%endif%}\n      \n      {%if c_array6%}\n      \n              <p class=\"f1\"  style=\"text-align:right\">Rs.{{c_array66|int}}</p>\n               {% set _ = a1.append(c_array66) %}\n              \n              {%else%}\n              <p class=\"f1\"  style=\"text-align:right\">Rs.0</p>\n              \n              \n            \n              \n      \n      {%endif%}\n      \n      \n    \n    &nbsp;\n    \n</td>\n\n\n\n<td style=\"border: 1px solid black;\">\n    \n    \n    <p class=\"m2\">Deductible</p></p></br></br></br></br></br></br></br></br></br></br></br>\n    \n    {%if c_array11 or c_array22 or c_array33%}\n    \n    \n    \n        {%if c_array11>150000%}\n        <p class=\"m2\"  style=\"text-align:right\">Rs.150000</p></br></br></br></br></br>\n      \n        \n        {%else%}\n    \n         <p class=\"f1\"  style=\"text-align:right\">Rs.{{(c_array11+c_array22+c_array33)|int}}</p></br></br></br></br></br>\n         {%endif%}\n    \n     {%endif%}\n     \n      {%if c_array44%}\n    \n            <p class=\"f1\"  style=\"text-align:right\">Rs.{{c_array44|int}}</p></p></br></br></br></br></br></br>\n            {%else%}\n              \n     {%endif%}\n     \n      {%if c_array55%}\n            <p class=\"f1\"  style=\"text-align:right\">Rs.{{c_array55|int}}</p></br></br></br></br></br></p></br></br></br>\n             {%else%}\n          <p class=\"f1\"  style=\"text-align:right\">Rs.0</p></br></br></br></br></br>\n     {%endif%}\n     \n      {%if c_array66%}\n        <p class=\"f1\"  style=\"text-align:right\">Rs.{{c_array66|int}}</p>\n         {%else%}\n          <p class=\"f1\"  style=\"text-align:right\">Rs.0</p>\n      {%endif%}\n    &nbsp;\n    \n</td>\n\n<td style=\"border: 1px solid black;\">\n    \n\n    {% set v2 = a1 | sum %}\n    \n    {%if v2==0%}\n    </br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br>\n\n        <p class=\"f1\"  style=\"text-align:right\"><b>Rs.0</b></p>\n    {%else%}\n    </br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br>\n\n    \n         <p class=\"f1\"  style=\"text-align:right\"><b>Rs. {{ v2 |int}}</b></p>\n         \n    {%endif%}\n    \n        \n    \n   \n</td>\n\n\n\n\n</tr>\n\n#}\n\n\n<tr>\n\n <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">11) Total Taxble Value  (9-10)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    \n    <!--{% set sw = sum_tax | sum %}-->\n    \n    \n    {#\n    <p class=\"f1\"  style=\"text-align:right\"><b>Rs.{{doc.custom_taxable_amount|int|round}}</b></p>\n    #}\n    \n    <p class=\"f1\"  style=\"text-align:right\"><b>Rs.{{(sum_tax[0]-sum_tax[1]|int|round)}}</b></p>\n    \n    \n   \n    \n      \n      \n      \n    \n    </td>\n        \n  </tr> \n  \n  \n  <tr>\n      <td style=\"border: 1px solid black;\">\n          \n          <p><b class=\"m2\"> 12) Tax Calculation</b></p>\n          \n          {%if doc.custom_tax_slab|length>0%}\n          \n          \n          <table style=\"border:1px solid black;width:100%\">\n              <tr>\n                  <td style=\"width:70%;border:1px solid black\">\n                       <p class=\"f1\"><b> Taxable Income Range</b></p>\n                     \n                  </td>\n                  \n                  <td style=\"width:30%;border:1px solid black\">\n                     <p class=\"f1\"><b>  Tax Amount</b></p>\n                  </td>\n                  \n                  \n              </tr>\n              \n              {%for i in doc.custom_tax_slab%}\n              <tr>\n                  <td style=\"border:1px solid black\">\n                      {%if i.to_amount>0%}\n                       <p class=\"f1\"  >Rs.{{i.from_amount|round}}-Rs.{{i.to_amount|round}}<br>(Tax: of {{i.percentage}}% of Rs.{{i.amount|round}})</p>\n                  \n                        {%else%}\n                        {%if i.to_amount==0%}\n                        <p class=\"f1\"  >Rs.{{i.from_amount|round}} And Above<br>(Tax: of {{i.percentage}}% of Rs.{{i.amount|round}})</p>\n\n                        {%endif%}\n                        \n                {%endif%}\n\n                  \n                  </td>\n                  \n                  <td style=\"border:1px solid black\">\n                       <p class=\"f1\" style=\"text-align:right\" >Rs.{{i.tax_amount|round}}</p>\n                  </td>\n              </tr>\n              {%endfor%}\n          </table>\n          <br>\n          \n\n        {%endif%}\n         \n      </td>\n      <td style=\"border: 1px solid black;\">\n          \n      </td>\n      <td style=\"border: 1px solid black;\">\n          \n      </td>\n      <td style=\"border: 1px solid black;\">\n          \n          \n          \n      </td>\n  </tr>\n  \n  \n  \n  <tr>\n    \n    <td style=\"border: 1px solid black;\">\n    \n   <p class=\"f1\"><b>Tax on total Income</b></p>\n          <p class=\"f1\"><b>Less : Rebate Under Section 87A</b></p>\n          <p style=\"font-size:10px\">Note: If taxable income is less than Rs.500,000.00, tax rebate\nof a maximum of Rs.12,500.00 is provided under Section 87A.</p></b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n\n        <p class=\"f1\" style=\"text-align:right\"><b>Rs.{{doc.custom_tax_on_total_income|round|int}}</b></p>\n          <p class=\"f1\"  style=\"text-align:right\"><b>Rs.{{doc.custom_rebate_under_section_87a|int}}</b></p>\n          \n   \n\n</td>\n    \n    \n</tr>\n  \n  \n  \n  \n  \n  \n \n             \n  \n\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">13) Total Tax on Income</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n   \n         <p class=\"m2\"   style=\"text-align:right\"><b>Rs.{{doc.custom_total_tax_on_income|round|int}}</b></p>\n        \n</td>\n    \n    \n</tr>\n\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n  \n   \n   \n   \n   \n                    <p class=\"m2\"><b>Surcharge</b></p>\n                    <p class=\"m2\"><b>Education Cess</b></p>\n                    <p class=\"m2\"><b>Less: Relief Under Section 89</b></p>\n                    \n\n \n   \n    </td>\n    \n    <td style=\"border: 1px solid black;\">\n       \n        &nbsp;\n    </td>\n    \n    <td style=\"border: 1px solid black;\">\n       \n        &nbsp;\n    </td>\n    <td style=\"border: 1px solid black;\">\n        \n      <p class=\"m2\"  style=\"text-align:right\"><b>Rs.{{doc.custom_surcharge|round|int}}</b></p>\n             <p class=\"m2\"  style=\"text-align:right\"><b>Rs.{{doc.custom_education_cess|round|int}}</b></p>\n             <p class=\"m2\"  style=\"text-align:right\"><b>Rs.0</b></p>\n            \n       </td>\n        \n       \n     \n    \n    \n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">14) Tax Payable including Education cess minus of relief under section 89</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    \n        \n              \n         <p class=\"m2\"  style=\"text-align:right\"><b>Rs.{{ (doc.custom_total_tax_on_income + doc.custom_surcharge + doc.custom_education_cess) | round |int}}</b></p>\n\n             \n           \n    \n</td>\n    \n    \n</tr>\n\n\n\n\n\n<tr>\n\n <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">15) Tax Deducted at source u/s 192</b></p>\n   </br> \n   <p class=\"m2\">* TDS till last month</p>\n   <p class=\"m2\">* TDS of the month</p>\n   <p class=\"m2\">* TDS by Previous Employer</p></br>\n   <p class=\"m2\">Total Tax Deducted at source</p></br>\n   <p class=\"m2\">Tax Payable / Refundable (14 - 15(A))</p>\n   <p class=\"m2\">TDS per month for the next 11 months</p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    <!--&nbsp;-->\n    \n    </br>    </br>\n   <p class=\"m2\"  style=\"text-align:right\">Rs.0</p>\n   \n   \n     \n{%if doc.current_month_income_tax > 0%}\n{%set month_tds=doc.custom_total_amount/12%}\n<p class=\"m2\"  style=\"text-align:right\">Rs.{{ doc.current_month_income_tax | round|int}}</p>\n{%else%}\n<p class=\"m2\"  style=\"text-align:right\">Rs.0</p>\n{%endif%}\n<p class=\"m2\"  style=\"text-align:right\">Rs.0</p></br>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\"></br>    </br></br>    </br></br>    </br></br>\n{%if doc.current_month_income_tax > 0%}\n    <p class=\"m2\"  style=\"text-align:right\"><b>Rs.{{ doc.current_month_income_tax | round|int}}</b></p>\n    {%else%}\n<p class=\"m2\"  style=\"text-align:right\">Rs.0</p>\n{%endif%}\n</td>\n    \n\n</tr>\n\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n        <p class=\"m2\"><b>TDS for April</b></p>\n   </td>\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    {%if doc.current_month_income_tax > 0%}\n    \n    <p class=\"m2\"  style=\"text-align:right\"><b>Rs.{{ doc.current_month_income_tax | round|int}}</b></p>\n    {%else%}\n<p class=\"m2\"  style=\"text-align:right\">Rs.0</p>\n{%endif%}\n</td>\n    \n    \n</tr>\n\n\n  \n</table>\n\n</body>\n</html>\n",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2024-08-12 13:07:47.559744",
  "module": "cn-indian-payroll",
  "name": "Income Tax",
  "page_number": "Hide",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": ".s2\n{\n    font-size: 16px;font-family: serif;\n    border:none;\n    background-color: #CCF8DB;\n}\n\n.f22\n{\n    font-size: 14px;\n    font-family: serif ;\n    color:#566573\n}\n\n\n\n.f11\n{\n    \n    font-size: 14px;\n    font-family: serif;\n    border:none;\n    color:#566573\n}\n\n\n.f1\n{\n    \n    font-size: 16px;\n    font-family: serif;\n}\n\n.f2\n{\n    \n    font-size: 14px;\n    font-family: serif;\n    border:none;\n    color:black;\n}\n\n.f4\n{\n    \n    font-size: 30px;\n    font-family: serif;\n    color: #15C650\n}\n\n.f6\n{\n    \n   \n    border:none;\n    font-size: 14px;\n    font-family: serif;\n}\n\n\n\n.f8 {\n  background-color: #dddddd;\n   border:none;\n   font-size: 14px;\n   font-family: serif;\n}\n\n\n  /*table, td {*/\n  /*  border: 1px solid black;*/\n  /*  border-collapse: collapse;*/\n  /*}*/\n  \n  .right-box {\n    float: right;\n    border: 1px solid black;\n    padding: 10px;\n    margin-left: 20px;\n  }\n",
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Salary Slip",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "\n\n<!--<p class=\"f1\"><b>Meril Life Sciences Private Limited</b></p>-->\n<!--<p class=\"f2\">Survey no. 135/139, Muktanand Marg, Chala, Vapi, Gujarat Vapi Gujarat 396191 India</p>-->\n\n{{letter_head}}\n\n<hr>\n\n    <p class=\"f1\">Payslip for the month of {{ frappe.utils.format_date(doc.start_date, \"MMMM, YYYY\") }}</p>\n    <p class=\"f2\"><b>Employee Pay Summary</b></p>\n    \n    \n\n    {% set employee = frappe.get_doc(\"Employee\", doc.employee) %}\n\n    \n    \n    \n<table class=\"f11\" style=\"width:100%\">\n  <tr>\n    <td class=\"f11\">\n    <p class=\"f11\" >Employee Code</p>\n    <p class=\"f11\" >Employee Name</p>\n    <p class=\"f11\"  >Designation</p>\n    <p class=\"f11\"  >Department</p>\n    <p class=\"f11\"  >Date of Joining</p>\n    <p class=\"f11\"  >Pay Period</p>\n    <p class=\"f11\" >Pay Date</p>\n    <p class=\"f11\" >PF A/C Number</p>\n    <p class=\"f11\" >UAN</p>\n    <p class=\"f11\">Bank Acc.No</p>\n    </td>\n    \n    <td class=\"f2\">\n        <p class=\"f2\">{{ doc.employee }}</p>\n        <p class=\"f2\">{{ doc.employee_name }}</p>\n        <p class=\"f2\">{{ employee.designation }}</p>\n        <p class=\"f2\">{{ employee.department }}</p>\n        <p class=\"f2\">{{ frappe.utils.format_date(employee.date_of_joining, \"dd-MM-yyyy\") }}</p>\n        <p class=\"f2\">{{ frappe.utils.format_date(doc.start_date, \"MMMM, YYYY\") }}\n        <p class=\"f2\">{{ frappe.utils.format_date(doc.posting_date, \"dd-MM-yyyy\") }}\n        <p class=\"f2\">{{ employee.provident_fund_account }}\n        <p class=\"f2\">{{ employee.custom_uan }}\n        <p class=\"f2\">{{ employee.bank_ac_no }}\n        \n        \n        </td>\n        \n    <td class=\"f2\">\n        <!--<table style=\"width:100%\" border-color: #96D4D4;>-->\n        <table style=\"width:100%; border:1px solid black\">\n\n              <tr>\n                <td style=\"border-color: #CCD1D1\">\n                    <center><p class=\"f22\">Employee Netpay</p></center>\n                   <b> <center><p class=\"f4\">Rs. {{ \"{:,.0f}\".format(doc.custom_net_pay_amount|int) }}</p></center></b>\n                    <center><p class=\"f22\"> Paid Days : {{doc.payment_days}} | LOP Days : {{doc.leave_without_pay}}  {%if doc.custom_lop_reversal_days>0%}<br> LOP Reversal Days: {{doc.custom_lop_reversal_days}} {%endif%}</p></center>\n                    \n                </td>\n                \n              </tr>\n            </table>\n        \n        \n        \n    </td>\n    \n  </tr>\n  \n  </table>\n  \n  <hr>\n  \n\n\n<table style=\"width:100%;border;none\" >\n    <tr>\n        <td>\n            <table style=\"width:100%;border:1px solid black\">\n                <tr>\n                    <td  class=\"f8\" style=\"border: 1px solid black\"><b>Earnings</b></td>\n                    <td  class=\"f8\" style=\"border: 1px solid black\"><b>Amount</b></td>\n                    <td  class=\"f8\" style=\"border: 1px solid black\"><b>YTD</b></td>\n                </tr>\n                \n                \n  \n                \n    {% set component_dict = {} %}\n        {% set array = [] %}\n        \n        {%set ytd_sum=[]%}\n        \n        {%set reimbursement_array=[]%}\n        \n        {%- for row in doc.earnings -%}\n            {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n            \n            {% if perquisite.custom_is_part_of_gross_pay == 1 or (perquisite.do_not_include_in_total == 0 and perquisite.custom_is_reimbursement == 0) %}\n                {# Append to array for sorting later #}\n                {% set _ = array.append({\"component\": perquisite.name, \"sequence\": perquisite.custom_sequence | int, \"amount\": row.amount, \"year_to_date\": row.year_to_date}) %}\n            {% endif %}\n            \n            {% if perquisite.custom_is_reimbursement == 1 or perquisite.component_type==\"LTA Taxable\" or perquisite.component_type==\"LTA Non Taxable\"%}\n        \n                {%set _=reimbursement_array.append(row.salary_component)%}\n   \n            {% endif %}\n            \n            \n            \n        {%- endfor -%}\n        \n        {# Sort the array based on the sequence for ordered display #}\n        {% set sorted_array = array | sort(attribute='sequence') %}\n        \n        {%- for item in sorted_array -%}\n            {% if item.component in component_dict %}\n                {% set component_dict = component_dict.update({\n                    item.component: {\n                        \"amount\": component_dict[item.component][\"amount\"] + item.amount,\n                        \"year_to_date\": component_dict[item.component][\"year_to_date\"] + item.year_to_date\n                    }\n                }) %}\n            {% else %}\n                {% set component_dict = component_dict.update({\n                    item.component: {\n                        \"amount\": item.amount,\n                        \"year_to_date\": item.year_to_date\n                    }\n                }) %}\n            {% endif %}\n        {%- endfor -%}\n        \n        {%- for component_name, values in component_dict.items() -%}\n            <tr>\n                <td style=\"border: 1px solid black;font-family: serif;\">{{ component_name }}</td>\n                <td style=\"border: 1px solid black;font-family: serif;text-align:right\">{{ \"{:,.0f}\".format(values.amount|round|int) }}</td>\n                <td style=\"border: 1px solid black;font-family: serif;text-align:right\">{{ \"{:,.0f}\".format(values.year_to_date|round|int) }}</td>\n                {%set _=ytd_sum.append(values.year_to_date|round|int)%}\n            </tr>\n        {%- endfor -%}\n\n        {% set ytd_total = ytd_sum | sum %}\n       \n                <tr>\n                    <td style=\"border: 1px solid black;font-family: serif;font-size: 14px;\"><b>Gross Earnings</b></td>\n                    <td   style=\"border: 1px solid black;font-family: serif;text-align:right\"><b>{{ \"{:,.0f}\".format(doc.custom_total_income|round|int) }}</b></td>\n                    <td   style=\"border: 1px solid black;font-family: serif;text-align:right\"><b>{{ \"{:,.0f}\".format(ytd_total|int) }}</b></td>\n                    \n                    \n        \n                </tr>\n            </table>\n            \n            \n            \n            \n        </td>\n        \n        <td>\n            <table style=\"width:100%;border:1px solid black\">\n                <tr>\n                    <td class=\"f8\" style=\"border: 1px solid black\"><b>Deductions</b></td>\n                    <td  class=\"f8\" style=\"border: 1px solid black\"><b>Amount</b></td>\n                    <td  class=\"f8\" style=\"border: 1px solid black\"><b>YTD</b></td>\n                  </tr>\n                <tr>\n                \n                \n                \n                \n        {% set component_dict = {} %}\n        {% set array = [] %}\n        \n        {%set ytd_deduction=[]%}\n        \n        {%- for row in doc.deductions -%}\n            {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n            \n            {%if perquisite.do_not_include_in_total==0 %}            \n                {% set _ = array.append({\"component\": perquisite.name, \"sequence\": perquisite.custom_sequence | int, \"amount\": row.amount, \"year_to_date\": row.year_to_date}) %}\n            {% endif %}\n        {%- endfor -%}\n        \n        {% set sorted_array = array | sort(attribute='sequence') %}\n        \n        {%- for item in sorted_array -%}\n            {% if item.component in component_dict %}\n                {% set component_dict = component_dict.update({\n                    item.component: {\n                        \"amount\": component_dict[item.component][\"amount\"] + item.amount,\n                        \"year_to_date\": component_dict[item.component][\"year_to_date\"] + item.year_to_date\n                    }\n                }) %}\n            {% else %}\n                {% set component_dict = component_dict.update({\n                    item.component: {\n                        \"amount\": item.amount,\n                        \"year_to_date\": item.year_to_date\n                    }\n                }) %}\n            {% endif %}\n        {%- endfor -%}\n        \n        {%- for component_name, values in component_dict.items() -%}\n            <tr>\n                <td style=\"border: 1px solid black;font-family: serif;\">{{ component_name }}</td>\n                <td style=\"border: 1px solid black;font-family: serif;text-align:right\">{{ \"{:,.0f}\".format(values.amount|round|int) }}</td>\n                <td style=\"border: 1px solid black;font-family: serif;text-align:right\">{{ \"{:,.0f}\".format(values.year_to_date|round|int) }}</td>\n                {%set _=ytd_deduction.append(values.year_to_date|round|int)%}\n            </tr>\n        {%- endfor -%}\n                \n                \n                \n                \n                \n                \n                \n                    \n    \n    \n    \n    \n    \n    \n    \n    \n    \n    \n    \n    \n    \n    \n    {%if doc.loans%}\n    {%set loan_array=[]%}\n    {%for i in doc.loans%}\n    <tr>\n            <td class=\"f6\" style=\"border: 1px solid black;\">Personal Loan</td>\n          <td class=\"f6\" style=\"border: 1px solid black;text-align:right\">{{ \"{:,.0f}\".format(i.total_payment|int) }}\n          \n           {%set _=loan_array.append(i.total_payment)%}\n           \n           </td>\n         <td class=\"f6\" style=\"border: 1px solid black;text-align:right\">{{ \"{:,.0f}\".format(i.total_payment|int) }}</td> \n        {%set _=ytd_deduction.append(i.total_payment)%}\n\n    </tr>\n    {%endfor%}\n    {%endif%}\n    \n                </tr>\n                \n                {% set ytd_total_sum = ytd_deduction | sum %}\n\n                <tr>\n                    <td style=\"border: 1px solid black;font-family: serif;font-size: 14px;\"><b>Total Deduction</b></td>\n                    <td   style=\"border: 1px solid black;font-family: serif;text-align:right\"><b>{{ \"{:,.0f}\".format(doc.custom_total_deduction_amount|int) }}</b></td>\n                    <td   style=\"border: 1px solid black;font-family: serif;text-align:right\"><b>{{ \"{:,.0f}\".format(ytd_total_sum|int) }}</b></td>\n        \n                </tr>\n            </table>\n        </td>\n    </tr>\n</table>\n {% set total1 = loan_array | sum %}\n\n\n<br>\n\n\n\n\n\n\n\n\n\n\n\n\n<table style=\"width:100%;border:1px solid black\">\n    \n    \n            \n        {% if reimbursement_array|length > 0 %}\n\n             <tr>\n             \n                    <td style=\"font-size: 14px;font-family: serif ; border:1px solid black;background-color: #dddddd;text-align:center\">\n                        <b>Reimbursements</b>\n                    </td>\n                    <td style=\"font-size: 14px;font-family: serif ;border:1px solid black;background-color: #dddddd;text-align:center\">\n                        <b>Amount</b>\n                    </td>\n                   \n                </tr>\n             \n            \n    \n        {%set sum=[]%}\n        {%set re_ytd_sum=[]%}\n        {% for row in doc.earnings %}\n        \n            {%set doc1 = frappe.get_doc('Salary Component', row.salary_component)%}\n            \n                {%if doc1.custom_is_reimbursement==1 or doc1.component_type==\"LTA Taxable\" or doc1.component_type==\"LTA Non Taxable\"%}\n                <tr>\n                \n                \n                <td style=\"font-size: 14px;font-family: serif ;border:1px solid black;\">\n                    {{row.salary_component}}\n                </td>\n                <td style=\"font-size: 14px;font-family: serif ;border:1px solid black;text-align:right\">\n                    {{ \"{:,.0f}\".format(row.amount|int) }}\n                        {%set _=sum.append(row.amount)%}\n                        \n                </td>\n                \n                </tr>\n                \n                {%endif%}\n        \n        \n        \n        {%endfor%}\n        \n        {% set total = sum | sum %}\n        {% set total1 = re_ytd_sum | sum %}\n        <td style=\"font-size: 14px;font-family: serif ; border:1px solid black;\">\n                        <b>Total Amount</b>\n                    </td>\n                    <td style=\"font-size: 14px;font-family: serif ;border:1px solid black;text-align:right\">\n                        <b>{{ \"{:,.0f}\".format(total|int) }}</b>\n                    </td>\n                    \n                    \n        \n        \n         {% endif %}\n        \n        \n        \n        \n        \n    \n</table>\n\n\n\n\n<br>\n\n\n<table style=\"width:100%\" class=\"s2\">\n  <tr class=\"s2\">\n    <td class=\"s2\">Total Net Payable <b>Rs. {{ \"{:,.0f}\".format(doc.custom_net_pay_amount|int) }}</b>-{{doc.custom_in_words}}</td>\n \n    \n  </tr>\n</table>\n\n<p class=\"f6\" style=\"color:#566573\">**Total Net Payable = Gross Earnings - Total Deductions</p>\n\n\n\n\n  \n \n\n\n",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2024-09-23 11:31:22.370073",
  "module": "cn-indian-payroll",
  "name": "Payslip",
  "page_number": "Hide",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": ".m1\n{\n    font-size: 20px;\n    font-family: serif;\n}\n\n.m2\n{\n    font-size: 14px;\n    font-family: serif;\n    \n    \n}\n\n\n\n.f1\n{\n    font-size: 14px;\n    font-family: serif;\n}\n\n.f2\n{\n    border:none;\n    font-size: 16px;\n    font-family: serif;\n}\n\n\n\n        /*tr.row1 td {*/\n        /*    border: 1px solid black; */\n        /*}*/",
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Salary Slip",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "<!DOCTYPE html>\n<html>\n    \n                {{letter_head}}\n           \n    \n<head>\n    \n</head>\n<body>\n    \n\n\n    \n   \n\n<p class=\"m1\">TDS WORK SHEET for the month of {{ frappe.utils.format_date(doc.start_date, \"MMMM, YYYY\") }}  </p>\n\n\n\n<table class=\"f2\" style=\"width:100%;\">\n  <tr>\n    <td class=\"f2\">Employee Name</td>\n    <td class=\"f2\">Pan</td>\n    <td class=\"f2\">Designation</td>\n    <td class=\"f2\">Tax Regime</td>\n  </tr>\n  \n  \n  {% set employee = frappe.get_doc(\"Employee\", doc.employee) %}\n       {% set tax_slab1 = frappe.get_list(\"Salary Structure Assignment\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"name\", \"employee\", \"income_tax_slab\"], order_by=\"from_date desc\") %}\n                {% if tax_slab1 %}\n                   {% set employee_tax_slab = tax_slab1[0].income_tax_slab %}\n                    \n               {%endif%}\n  \n  \n  \n   <tr>\n    <td class=\"f2\">{{doc.employee_name}}</td>\n    <td class=\"f2\">{%if employee.pan_number%} {{employee.pan_number}} {%endif%}</td>\n    <td class=\"f2\">{%if employee.designation%} {{employee.designation}} {%endif%}</td>\n    <td class=\"f2\">{{employee_tax_slab}}</td>\n  </tr>\n  \n  \n  \n  \n  \n</table>\n\n\n\n\n\n<hr style=\"border-style: dotted; border-width: 1px; border-color: black;\">\n\n\n    <p style=\"font-size: 16px;font-family: serif;\">Details of salary paid and any other income tax and tax deducted</p>\n\n<table style=\"width:100%;border: 1px solid black;\" >\n  <tr class=\"row2\" style=\"border: 1px solid black;\">\n    <th class=\"m2\" style=\"border: 1px solid black;\">Particulars</th>\n    <th class=\"m2\" style=\"border: 1px solid black;\">Actual</th> \n    <th class=\"m2\" style=\"border: 1px solid black;\">Projection</th>\n    <th class=\"m2\" style=\"border: 1px solid black;\">Total</th>\n  </tr>\n  \n  \n  \n \n\n<tr>\n\n  \n  \n<td style=\"border: 1px solid black;\">\n    <b class=\"m2\">1) Gross Earnings</b></br></br>\n{% set component_dict = {} %}\n    \n{%- for row in doc.earnings -%}\n    {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n    \n    {% if perquisite.is_tax_applicable == 1 and perquisite.custom_perquisite == 0 and perquisite.custom_is_reimbursement == 0 %}\n        {# Summing the values for duplicate keys #}\n        \n        {% if row.salary_component in component_dict %}\n            {% set component_dict = component_dict.update({row.salary_component: component_dict[row.salary_component] + row.amount}) %}\n        {% else %}\n            {% set component_dict = component_dict.update({row.salary_component: row.amount}) %}\n        {% endif %}\n    {% endif %}\n{%- endfor -%}\n\n{# Display the merged components and their values #}\n{% for component, amount in component_dict.items() %}\n    <p class=\"m2\">{{ component }}</p>\n{% endfor %}\n\n    \n{%if doc.custom_perquisite_amount>0%}\n<p style=\"font-size: 14px; font-family: serif;\">Loan Perquisite </p>\n\n{%endif%}\n    \n    {% set ss_slip = frappe.get_list(\"Salary Structure Assignment\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"*\"], order_by=\"from_date desc\") %}\n               \n               {% if ss_slip[0].custom__car_perquisite==1 or ss_slip[0].custom_driver_provided_by_company==1%}\n               \n               \n               \n                <p style=\"font-size: 14px; font-family: serif;\">Total Perquisite Amount </p>\n            {% endif %}\n            \n            \n    \n    \n    \n \n </br></br>\n \n <p class=\"m2\"><b>Total Income</b></p>\n\n\n</td>\n\n<td style=\"border: 1px solid black;\" >\n    \n    \n</br></br>\n\n    \n    \n       {% set component_dict = {} %}\n    \n{%- for row in doc.earnings -%}\n    {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n    \n    {% if perquisite.is_tax_applicable == 1 and perquisite.custom_perquisite == 0 and perquisite.custom_is_reimbursement == 0 %}\n        {# Summing the values for duplicate keys #}\n        \n        {% if row.salary_component in component_dict %}\n            {% set component_dict = component_dict.update({row.salary_component: component_dict[row.salary_component] + row.year_to_date}) %}\n        {% else %}\n            {% set component_dict = component_dict.update({row.salary_component: row.year_to_date}) %}\n        {% endif %}\n    {% endif %}\n{%- endfor -%}\n\n{# Display the merged components and their values #}\n{% for component, amount in component_dict.items() %}\n   \n      <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format(amount|round|int) }}</p>\n{% endfor %}\n\n\n{%if doc.custom_perquisite_amount>0%}\n\n<p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((doc.custom_perquisite_amount) |round|int) }}</p>\n\n{%endif%}\n    \n    \n     {% set ss_slip = frappe.get_list(\"Salary Structure Assignment\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"*\"], order_by=\"from_date desc\") %}\n               \n               {% if ss_slip[0].custom__car_perquisite==1 or ss_slip[0].custom_driver_provided_by_company==1%}\n               \n               {%if ss_slip[0].custom__car_perquisite==1%}\n                {% set car_perquisite = ss_slip[0].custom_car_perquisite_as_per_rules |int %}\n                {%else%}\n                {% set car_perquisite = 0  %}\n                {%endif%}\n                \n                {%if ss_slip[0].custom_driver_provided_by_company==1%}\n                {% set driver_perquisite = ss_slip[0].custom_driver_perquisite_as_per_rules |int %}\n                {%else%}\n                {% set driver_perquisite = 0 %}\n                {%endif%}\n                {% set per_total = car_perquisite + driver_perquisite %}\n                 \n                <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((per_total * 12) |round|int) }}</p>\n\n            {% endif %}\n    \n   \n    \n   \n    \n\n\n    \n\n\n\n</td>\n\n<td style=\"border: 1px solid black;\"></br></br>\n\n   \n       \n       \n       \n       \n       {% set component_dict = {} %}\n    \n{%- for row in doc.earnings -%}\n    {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n    \n    {% if perquisite.is_tax_applicable == 1 and perquisite.custom_perquisite == 0 and perquisite.custom_is_reimbursement == 0 %}\n        {# Summing the values for duplicate keys #}\n        \n        {% if row.salary_component in component_dict %}\n            {% set component_dict = component_dict.update({row.salary_component: component_dict[row.salary_component] + row.custom_actual_amount}) %}\n        {% else %}\n            {% set component_dict = component_dict.update({row.salary_component: row.custom_actual_amount}) %}\n        {% endif %}\n    {% endif %}\n{%- endfor -%}\n\n{# Display the merged components and their values #}\n{% for component, amount in component_dict.items() %}\n   \n      <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((amount*doc.custom_month_count)|round|int) }}</p>\n{% endfor %}\n     \n     \n\n \n\n\n\n</td>\n<td style=\"border: 1px solid black;\"></br></br>\n\n{%set array=[]%}\n {% set component_dict = {} %}\n    \n{%- for row in doc.earnings -%}\n    {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n    \n    {% if perquisite.is_tax_applicable == 1 and perquisite.custom_perquisite == 0 and perquisite.custom_is_reimbursement == 0 %}\n        {# Summing the values for duplicate keys #}\n        \n        {% if row.salary_component in component_dict %}\n            {% set component_dict = component_dict.update({row.salary_component: component_dict[row.salary_component] + (row.custom_actual_amount *doc.custom_month_count)+ row.year_to_date}) %}\n        {% else %}\n            {% set component_dict = component_dict.update({row.salary_component: (row.custom_actual_amount *doc.custom_month_count)+ row.year_to_date}) %}\n        {% endif %}\n    {% endif %}\n{%- endfor -%}\n\n{% for component, amount in component_dict.items() %}\n   \n      <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format(amount|round|int) }}</p>\n      {% set _ = array.append((amount)|round|int) %}\n      \n{% endfor %}\n\n{%if doc.custom_perquisite_amount>0%}\n\n<p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((doc.custom_perquisite_amount) |round|int) }}</p>\n\n{%endif%}\n \n\n     \n     {% set ss_slip = frappe.get_list(\"Salary Structure Assignment\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"*\"], order_by=\"from_date desc\") %}\n               \n                {% if ss_slip[0].custom__car_perquisite==1 or ss_slip[0].custom_driver_provided_by_company==1%}\n               \n               {%if ss_slip[0].custom__car_perquisite==1%}\n                {% set car_perquisite = ss_slip[0].custom_car_perquisite_as_per_rules |round  %}\n                {%else%}\n                {% set car_perquisite = 0  %}\n                {%endif%}\n                \n                {%if ss_slip[0].custom_driver_provided_by_company==1%}\n                {% set driver_perquisite = ss_slip[0].custom_driver_perquisite_as_per_rules|round  %}\n                {%else%}\n                {% set driver_perquisite = 0 %}\n                {%endif%}\n                {% set per_total = car_perquisite + driver_perquisite %}\n                <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((per_total * 12) |round|int) }}</p>\n                 {% set _ = array.append((per_total*12)|round|int) %}\n    {% endif %}\n \n \n \n \n \n \n \n \n \n \n  {% set total=array|sum%}\n \n {% set formatted_amount = \"{:,}\".format(total|round|int) %}\n\n </br></br>\n \n \n        \n        \n     <p class=\"m2\" style=\"text-align:right\"><b>{{formatted_amount}}</b></p>\n     \n       \n\n</td>\n\n\n</tr>\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n    <b class=\"m2\">2)Allowance to the extent exempt under section 10</b></br></br>\n\n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {%if tax_exemption[0].name %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        {%if section.monthly_house_rent>0%}\n        \n         <p class=\"m2\" >House Rent Allowance</p>\n        {%endif%}\n        \n        {% for i in section.declaration_details %}\n            \n             {% if i.exemption_category in [\"Section 10(13A)\", \"Section 10(14)\"] %}\n                <p class=\"m2\" >{{ i.exemption_sub_category }}</p>\n            {% endif %}\n        {% endfor %}\n    \n    \n    {%endif%}\n    {%endif%}\n    \n    \n    </br></br>\n    \n    <p><b class=\"m2\"> Total of Allowance to the extent exempt under section 10</b></p>\n</td>\n\n\n<td style=\"border: 1px solid black;\">\n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    {%if tax_exemption|length>0 %}\n    \n    {%if tax_exemption[0].name %}\n    </br></br>\n     {% set array1 = [] %}\n        {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n         {%if section.monthly_house_rent>0%}\n         \n        {% set formatted_amount = \"{:,}\".format(section.annual_hra_exemption|int) %}\n        <p class=\"m2\" style=\"text-align:right\">{{ formatted_amount }}</p>\n         \n          {% set _ = array1.append(section.annual_hra_exemption) %}\n        {%endif%}\n        \n       \n        {% for i in section.declaration_details %}\n             {% if i.exemption_category in [\"Section 10(13A)\", \"Section 10(14)\"] %}\n            \n            \n            {% set formatted_amount = \"{:,}\".format(i.declared_amount |round| int) %}\n            <p class=\"m2\" style=\"text-align:right\">{{ formatted_amount }}</p>\n                 {% set _ = array1.append(i.declared_amount|round| int) %}\n            {% endif %}\n        {% endfor %}\n        \n         {% set tax_total = array1 | sum | round | int %}\n         \n         \n         \n    {%else%}\n    \n    <p class=\"m2\">.0</p>\n     {% set tax_total = 0 %}\n        \n    {% endif %}\n    \n    {%else%}\n    {% set tax_total = 0 %}\n    \n    \n{%endif%}\n\n\n\n \n\n\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    \n    \n    \n    {%if tax_total%}\n    \n    {% set formatted_amount = \"{:,}\".format(tax_total|round | int) %}\n           \n   </br></br></br></br></br></br> <p class=\"m2\"  style=\"text-align:right\"><b>{{formatted_amount}}</b></p>\n    {%else%}\n    </br></br></br></br><p class=\"m2\"  style=\"text-align:right\"><b>0</b></p>\n    {%endif%}\n</td>\n\n\n\n\n\n\n\n\n  \n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">3) Total After Exemption (1-2)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    {%if total or tax_total%}\n    \n    \n   \n    <p class=\"m2\" style=\"text-align:right\"> <b>{{ \"{:,}\".format((total - tax_total)|round|int) }}</b></p>\n\n    \n    \n    {% else %}\n    <p><b class=\"m2\"  style=\"text-align:right\">0</b></p>\n    \n    {%endif%}\n\n    \n    \n</td>\n    \n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">4) Taxable income under previous employment</b></p></br></br>\n   <p class=\"m2\">1. Income after exemption</p>\n   <p class=\"m2\">2. Less:Professional Tax</p>\n   \n   </br></br>\n   \n   <p><b class=\"m2\">Total taxable income under previous employment</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\"></br></br>\n    &nbsp;\n   <p class=\"m2\"  style=\"text-align:right\"> 0</p> \n   <p class=\"m2\"  style=\"text-align:right\"> 0</p>\n</td>\n\n<td style=\"border: 1px solid black;\"></br></br>\n    &nbsp;\n    <p class=\"m2\"  style=\"text-align:right\"> 0</p>\n    <p class=\"m2\"  style=\"text-align:right\"> 0</p>\n   \n</td>\n\n<td style=\"border: 1px solid black;\"></br></br></br></br></br></br></br></br>\n<p class=\"m2\"  style=\"text-align:right\"><b> 0</b></p>   \n</td>\n    \n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">5) Gross Total (3+4)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    \n     {%if total or tax_total%}\n     \n    <p class=\"m2\"  style=\"text-align:right\"><b >{{ \"{:,}\".format((total - tax_total)|round|int) }}</b></p>\n    \n    \n    \n    {%else%}\n    <p class=\"m2\"  style=\"text-align:right\"> 0</p>\n    \n    {%endif%}\n    \n</td>\n    \n</tr>\n\n\n\n<tr>\n    <td style=\"border: 1px solid black;\">\n        <p><b style=\"font-size: 14px;font-family: serif;\">6) Under Section 16</b></p></br>\n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    \n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 16\" %}\n                <p class=\"m2\" > {{ i.exemption_sub_category}}</p>\n            {% endif %}\n        {% endfor %}\n        \n        \n    \n    {% endif %}\n    \n    <p class=\"m2\">Standard Deduction</p>\n    \n    </br></br>\n    <p><b class=\"m2\"> Total Under Section 16</b></p>\n    \n    </td>\n    \n    <td style=\"border: 1px solid black;\"></br></br>\n        {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        {% set array2=[]%}\n        \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 16\" %}\n                <p class=\"m2\"  style=\"text-align:right\"> {{ \"{:,}\".format(i.declared_amount|round| int) }}</p>\n                \n                {% set _ = array2.append(i.declared_amount|round| int) %}\n            {% endif %}\n        {% endfor %}\n        \n        \n    {%else%}\n    \n   \n    \n    {% set form_16 = 0 %}\n        \n    {% endif %}\n    \n    <p class=\"m2\"  style=\"text-align:right\">50000</p>\n    {%if array2%}\n    \n    {% set _ = array2.append(50000) %}\n     {% set form_16 = array2 | sum %}\n     \n     {%else%}\n     \n     {% set form_16 =50000 %}\n     \n     \n       {% endif %}\n    \n    \n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\"></br></br></br></br></br></br>\n{%if form_16%}\n       <p class=\"m2\"  style=\"text-align:right\"><b >{{ \"{:,}\".format(form_16|round| int) }} </b></p>  \n       \n{%endif%}\n</td>\n    \n\n</tr>\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">7) Income chargeble under Head Salaries (5-6)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n         {%if total or tax_total or form_16 %} \n         \n         <p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(total - tax_total - form_16|round| int) }}</b></p>\n         \n         \n         {%else%}\n         <p class=\"m2\"  style=\"text-align:right\"><b>0</b></p>\n         \n         {%endif%}\n</td>\n    \n</tr>\n\n\n\n<tr>\n     \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">8) Any Other income reported by employee</b></p>\n   </br>\n   <p class=\"f1\">Interest Paid on Home Loan</p>\n   <p class=\"f1\">Let Out Property</p></br>\n   \n   <p><b class=\"f1\">Total Income From Other Sources</b></p>\n   <p style=\"font-size: 10px;font-family: serif;\">Note: A maximum of Rs.200,000.00 is allowed as exemption\nfor housing loan interests on Self Occupied House Property\nand Let Out Property.</p>\n</td>\n\n<td style=\"border: 1px solid black;\"></br></br>\n\n {% set c_array11 = [] %}\n{% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80EE\" %}\n            <p class=\"m2\"  style=\"text-align:right\">{{ \"{:,}\".format(i.declared_amount|round| int) }}</p> \n            \n           \n            {% set _ = c_array11.append(i.declared_amount|round| int) %}\n           \n            \n            {% endif %}\n        {% endfor %}\n        \n         \n        {% set c_array11 = c_array11 | sum %}\n        \n        \n        {%else%}\n        <p class=\"m2\"  style=\"text-align:right\">0</p>\n        {% set c_array11 = 0 %}\n    {%endif%}\n \n    \n    <!--<p>value</p>-->\n    <p class=\"m2\"  style=\"text-align:right\">0</p></br>\n    \n    \n    \n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\"></br></br></br></br></br></br></br>\n\n{%if c_array11 %}\n<p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(c_array11|round| int) }}</b></p> \n\n{%else%}\n<p class=\"m2\"  style=\"text-align:right\"><b>0</b></p>\n{%endif%}\n</td>\n    \n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">9) Gross Total Income (7+8)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    {%set sum_tax=[]%}\n     {%if total or tax_total or form_16 or c_array11%} \n         \n         <p class=\"m2\" style=\"text-align:right\"><b>{{ \"{:,}\".format((total - tax_total - form_16 - c_array11) |round| int) }}</b></p>\n\n         \n         {% set t1= (total-tax_total-form_16-c_array11) |round|int%}\n \n         \n         \n          {% set _ = sum_tax.append(t1) %}\n         \n         \n         \n         \n         \n         {%else%}\n         <p class=\"m2\"  style=\"text-align:right\"><b>0</b></p>\n         \n         {%endif%}\n    \n   \n\n</td>\n    \n</tr>\n\n\n\n\n<tr>\n     <td style=\"border: 1px solid black;\">\n        \n         <p><b class=\"m2\">10) Deduction under chapter VI-A</b></p></br>\n   \n       <p class=\"f1\"><b>80C</b></p>\n       \n       {% set c_array1 = [] %}\n\n   {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80C\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\"> {{ \"{:,}\".format(i.declared_amount|round| int) }}</span>\n                \n                \n                {% set _ = c_array1.append(i.declared_amount|round| int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n        {% set c_array11 = c_array1 | sum %}\n       \n        \n    {% endif %}\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n            <p class=\"m2\">Qualifying</p></br>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n             \n            <p class=\"m2\">Deductible</p>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\" ><br><br><br><br><br><br>\n         \n         {%if c_array11%}\n             \n            <p class=\"m2\" style=\"text-align:right\"><b>{{ \"{:,}\".format(c_array11|round|int) }}</b></p>\n            \n            {%else%}\n             <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p>\n            {%endif%}\n             \n             \n         </td>\n    \n</tr>\n\n\n\n\n\n<tr>\n     <td style=\"border: 1px solid black;\">\n        \n         \n   \n       <p class=\"f1\"><b>80CCC</b></p>\n    \n     {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        {% set c_array2 = [] %}\n        \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80CCC\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\"> {{ \"{:,}\".format(i.declared_amount|round| int) }}</span>\n                \n                \n                {% set _ = c_array2.append(i.declared_amount|round| int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n         {% set c_array22 = c_array2 | sum %}\n       \n        \n    {% endif %}\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n            <p class=\"m2\">&nbsp;</p></br>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n             \n            <p class=\"m2\">&nbsp;</p>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\" ><br>\n          {%if c_array11%}\n             \n            <p class=\"m2\" style=\"text-align:right\"><b>{{ \"{:,}\".format(c_array22|round| int) }}</b></p>\n            \n            \n            \n            \n            {%else%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p>\n\n             {%endif%}\n             \n         </td>\n    \n</tr>\n\n\n\n<tr>\n     <td style=\"border: 1px solid black;\">\n        \n         \n   \n       <p class=\"f1\"><b>80CCD</b></p>\n    \n     {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n          {% set c_array3 = [] %}   \n          \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80CCD\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\"> {{ \"{:,}\".format(i.declared_amount|round|int) }}</span>\n                \n                {% set _ = c_array3.append(i.declared_amount|round|int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n       {% set c_array33 = c_array3 | sum %}\n        \n    {% endif %}\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n            <p class=\"m2\">&nbsp;</p></br>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n             \n            <p class=\"m2\">&nbsp;</p>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\" ><br>\n         \n         {%if c_array33%}\n             \n            <p class=\"m2\">{{ \"{:,}\".format(i.c_array33|round|int) }}</p>\n            {%else%}\n                        <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p>\n\n            {%endif%}\n             \n             \n         </td>\n    \n</tr>\n\n\n\n<tr>\n    <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>Total (80C+80CCC+80CCD)</b> </p>\n     </td>\n      <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>&nbsp;</b> </p>\n     </td>\n      <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>&nbsp;</b> </p>\n     </td>\n      <td style=\"border: 1px solid black;\">\n          {%if c_array11 or c_array22 or c_array33%}\n     <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">{{ \"{:,}\".format((c_array11 + c_array22 + c_array33)|round|int) }}</p></b> </p>\n     \n     {%else%}\n          <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p></b> </p>\n\n     {%endif%}\n     \n     </td>\n</tr>\n\n\n\n\n\n<tr>\n    <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>80CCD(1B)</b></p>\n    \n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n          {% set c_array4 = [] %}   \n          \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80CCD(1B)\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\">  {{ \"{:,}\".format(i.declared_amount|round|int) }}</span>\n                \n                {% set _ = c_array4.append(i.declared_amount|round|int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n       {% set c_array44 = c_array4 | sum %}\n        \n    {% endif %}\n    </td>\n    <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">\n            \n            {%if c_array44%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">{{ \"{:,}\".format(c_array44|round|int) }}</p></b> </p>\n            \n            {%else%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p></b> </p>\n\n            {%endif%}\n        </td>\n     \n</tr>\n\n\n\n\n\n\n<tr>\n    <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>80CCD(2)</b></p>\n    \n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n          {% set c_array5 = [] %}   \n          \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80CCD(2)\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\"> {{ \"{:,}\".format(i.declared_amount|round|int) }}</span>\n                {% set _ = c_array5.append(i.declared_amount|round|int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n       {% set c_array55 = c_array5 | sum %}\n        \n    {% endif %}\n    </td>\n    <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">\n            {%if c_array55%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">{{ \"{:,}\".format(c_array55|round|int) }}</p></b> </p>\n            {%else%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p></b> </p>\n\n            {%endif%}\n        </td>\n     \n</tr>\n\n\n\n\n\n<tr>\n    <td>\n    <p class=\"f1\"><b>80D</b></p>\n    \n   \n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n          {% set c_array6 = [] %}   \n          \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80D\" %}\n            \n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp;\n                <span style=\"float: right;\">  {{ \"{:,}\".format(i.declared_amount|round|int) }}</span>\n                {% set _ = c_array6.append(i.declared_amount|round|int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n        \n     \n        \n       {% set c_array66 = c_array6 | sum %}\n        \n    {% endif %}\n    </td>\n    <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">\n            \n            {%if c_array66 %}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">{{ \"{:,}\".format(c_array66|round|int) }}</p></b> </p>\n            {%else%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p></b> </p>\n\n            {%endif%}\n        </td>\n     \n</tr>\n\n\n<tr>\n    \n     <td style=\"border: 1px solid black;\">\n         <p class=\"f1\"><b>Total of Deductions under Chapter VI-A</b></p>\n\n     </td>\n     <td style=\"border: 1px solid black;\">\n         &nbsp;\n         \n     </td>\n     <td style=\"border: 1px solid black;\">&nbsp;\n         \n     </td>\n     <td style=\"border: 1px solid black;\">\n         \n          {%if c_array66 or c_array55 or c_array44 or c_array11 or c_array22 or c_array33 %}\n         \n         <p class=\"f1\" style=\"text-align:right\"><b>{{ \"{:,}\".format((c_array66+c_array55+c_array44+c_array11 + c_array22 + c_array33)|round|int) }}</b></p>\n         \n         {% set _ = sum_tax.append(c_array66+c_array55+c_array44+c_array11 + c_array22 + c_array33|round|int) %}\n         \n         \n         \n         {%else%}\n         {% set _ = sum_tax.append(0) %}\n         <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p></b> </p>\n     {%endif%}\n     </td>\n    \n</tr>\n\n\n\n<tr>\n\n <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">11) Total Taxble Value  (9-10)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    \n   \n    \n    \n    \n    \n    <p class=\"f1\"  style=\"text-align:right\"><b>{{ \"{:,}\".format((sum_tax[0]-sum_tax[1])|round|int) }}</b></p>\n    \n    \n    \n       \n    \n    \n   \n    \n      \n      \n      \n    \n    </td>\n        \n  </tr> \n  \n  \n  \n    <tr>\n      <td style=\"border: 1px solid black;\">\n          \n          <p><b class=\"m2\"> 12) Tax Calculation</b></p>\n          \n          {%if doc.custom_tax_slab|length>0%}\n          \n          \n          <table style=\"border:1px solid black;width:100%\">\n              <tr>\n                  <td style=\"width:70%;border:1px solid black\">\n                       <p class=\"f1\"><b> Taxable Income Range</b></p>\n                     \n                  </td>\n                  \n                  <td style=\"width:30%;border:1px solid black\">\n                     <p class=\"f1\"><b>  Tax Amount</b></p>\n                  </td>\n                  \n                  \n              </tr>\n              \n              {%for i in doc.custom_tax_slab%}\n              <tr>\n                  <td style=\"border:1px solid black\">\n                      {%if i.to_amount>0%}\n                       <p class=\"f1\"  >{{i.from_amount|round}}-{{i.to_amount|round}}<br>(Tax: of {{i.percentage}}% of {{i.amount|round}})</p>\n                  \n                        {%else%}\n                        {%if i.to_amount==0%}\n                        <p class=\"f1\"  >{{i.from_amount|round}} And Above<br>(Tax: of {{i.percentage}}% of {{i.amount|round}})</p>\n\n                        {%endif%}\n                        \n                {%endif%}\n\n                  \n                  </td>\n                  \n                  <td style=\"border:1px solid black\">\n                       <p class=\"f1\" style=\"text-align:right\" >{{i.tax_amount|round}}</p>\n                  </td>\n              </tr>\n              {%endfor%}\n          </table>\n          <br>\n          \n\n        {%endif%}\n         \n      </td>\n      <td style=\"border: 1px solid black;\">\n          \n      </td>\n      <td style=\"border: 1px solid black;\">\n          \n      </td>\n      <td style=\"border: 1px solid black;\">\n          \n          \n          \n      </td>\n  </tr>\n  \n  \n  \n  \n   \n  <tr>\n    \n    <td style=\"border: 1px solid black;\">\n        \n        {%if doc.custom_income_tax_slab==\"Old Regime\"%}\n    \n           <p class=\"f1\"><b>Tax on total Income</b></p>\n                  <p class=\"f1\"><b>Less : Rebate Under Section 87A</b></p>\n                  <p style=\"font-size:10px\">Note: If taxable income is less than Rs.500,000.00, tax rebate\n        of a maximum of Rs.12,500.00 is provided under Section 87A.</p></b></p>\n        \n        {%else%}\n        \n         <p class=\"f1\"><b>Tax on total Income</b></p>\n                  <p class=\"f1\"><b>Less : Rebate Under Section 87B</b></p>\n                  <p style=\"font-size:10px\">Note: If taxable income is less than Rs.700,000.00, tax rebate\n        of a maximum of Rs.25,000.00 is provided under Section 87A.</p></b></p>\n        \n        {%endif%}\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n\n        <p class=\"f1\" style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.custom_tax_on_total_income|round|int) }}</b></p>\n          <p class=\"f1\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.custom_rebate_under_section_87a|round|int) }}</b></p>\n          \n          \n          \n   \n\n</td>\n    \n    \n</tr>\n  \n  \n  \n  \n  \n  \n \n             \n  \n\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">13) Total Tax on Income</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n   \n         <p class=\"m2\"   style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.custom_total_tax_on_income|round|int) }}</b></p>\n         \n         \n        \n</td>\n    \n    \n</tr>\n\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n  \n   \n   \n   \n   \n                    <p class=\"m2\"><b>Surcharge</b></p>\n                    <p class=\"m2\"><b>Education Cess</b></p>\n                    <p class=\"m2\"><b>Less: Relief Under Section 89</b></p>\n                    \n\n \n   \n    </td>\n    \n    <td style=\"border: 1px solid black;\">\n       \n        &nbsp;\n    </td>\n    \n    <td style=\"border: 1px solid black;\">\n       \n        &nbsp;\n    </td>\n    <td style=\"border: 1px solid black;\">\n        \n      <p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.custom_surcharge|round|int) }}</b></p>\n             <p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.custom_education_cess|round|int) }}</b></p>\n             <p class=\"m2\"  style=\"text-align:right\"><b>0</b></p>\n            \n       </td>\n        \n       \n     \n    \n    \n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">14) Tax Payable including Education cess minus of relief under section 89</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    \n        \n              \n         <p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format((doc.custom_total_tax_on_income + doc.custom_surcharge + doc.custom_education_cess)|round|int) }}</b></p>\n         \n\n             \n           \n    \n</td>\n    \n    \n</tr>\n\n\n\n<tr>\n\n <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">15) Tax Deducted at source u/s 192</b></p>\n   </br> \n   <p class=\"m2\">* TDS till last month</p>\n   <p class=\"m2\">* TDS of the month</p>\n   <p class=\"m2\">* TDS by Previous Employer</p></br>\n   <p class=\"m2\">Total Tax Deducted at source</p></br>\n   <p class=\"m2\">Tax Payable / Refundable (14 - 15(A))</p>\n   <p class=\"m2\">TDS per month for the next {{doc.custom_month_count}} months</p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n   {% set tax_exemption = frappe.get_list(\n        \"Salary Slip\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"custom_payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"*\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {%set tds_sum=[]%}\n    {%for j in tax_exemption %}\n    {%if j.name!=doc.name%}\n    \n    {%set _ = tds_sum.append(j.current_month_income_tax)%}\n    \n    \n    \n    \n    \n    \n    \n    {%endif%}\n    \n    {%endfor%}\n    \n    {%endif%}\n    \n    {%set j1=tds_sum|sum%}\n    \n    </br>    </br>\n   <p class=\"m2\"  style=\"text-align:right\">{{j1|round|int}}</p>\n   \n   \n     \n{%if doc.current_month_income_tax > 0%}\n{%set month_tds=doc.custom_total_amount/12%}\n<p class=\"m2\"  style=\"text-align:right\">{{ \"{:,}\".format(doc.current_month_income_tax|round|int) }}</p>\n{%else%}\n<p class=\"m2\"  style=\"text-align:right\">0</p>\n{%endif%}\n\n\n\n        <p class=\"m2\"  style=\"text-align:right\">0</p></br>\n\n\n\n\n\n\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\"></br>    </br></br>    </br></br>    </br></br>\n{%if doc.current_month_income_tax > 0%}\n    <p class=\"m2\"  style=\"text-align:right\"><b>{{(doc.current_month_income_tax+j1)|round|int}}</b></p>\n    \n    {%else%}\n<p class=\"m2\"  style=\"text-align:right\">0</p>\n{%endif%}\n \n {%set j2=doc.current_month_income_tax+j1%}\n {%set j3=doc.custom_total_tax_on_income + doc.custom_surcharge + doc.custom_education_cess%}\n {%set final=j3-j2%}\n <br>\n <p class=\"m2\"  style=\"text-align:right\"><b>{{(final)|round|int}}</b></p>\n {#\n <p class=\"m2\"  style=\"text-align:right\"><b>{{(final/doc.custom_month_count)|round|int}}</b></p>\n #}\n <p class=\"m2\"  style=\"text-align:right\"><b>{{(doc.current_month_income_tax|round|int)}}</b></p>\n\n</td>\n    \n\n</tr>\n\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n        <p class=\"m2\"><b>TDS for {{doc.custom_month}}</b></p>\n   </td>\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    {%if doc.current_month_income_tax > 0%}\n    \n    <p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.current_month_income_tax|round|int) }}</b></p>\n    {%else%}\n<p class=\"m2\"  style=\"text-align:right\">0</p>\n{%endif%}\n</td>\n    \n    \n</tr>\n\n\n\n\n\n\n\n\n\n\n\n\n\n</table>\n\n\n<br>\n<table style=\"width:100%;border:1px solid black\">\n    \n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%set sum_array=[]%}\n    {%if tax_exemption|length>0 %}\n        {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        \n        {% if section.hra_breakup| length > 0 %}\n    \n    \n    <tr>\n        <td class=\"m2\" style=\"border:1px solid black\">Month</td>\n        <td class=\"m2\" style=\"border:1px solid black\">Rent Paid</td>\n        <td class=\"m2\" style=\"border:1px solid black\">% of Earned Basic(Metro 50%, Non-Metro 40%)</td>\n        <td class=\"m2\" style=\"border:1px solid black\">HRA Received</td>\n        <td class=\"m2\" style=\"border:1px solid black\">Excess of Rent Paid Over 10% of Basic</td>\n        <td class=\"m2\" style=\"border:1px solid black\">Exemption Amount</td>\n    </tr>\n    \n    {% endif %}\n    {% endif %}\n    \n    \n    \n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%set sum_array=[]%}\n    {%if tax_exemption|length>0 %}\n        {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        \n        {% if section.hra_breakup| length > 0 %}\n            {% for i in section.hra_breakup %}\n                <tr>\n                   <td class=\"m2\" style=\"border:1px solid black\">{{ i.month}}</td>\n                    <td class=\"m2\" style=\"border:1px solid black\">{{ i.rent_paid|int }}</td>\n                    <td class=\"m2\" style=\"border:1px solid black\">{{ i.earned_basic|int }}</td>\n                    {% set _ = sum_array.append(i.earned_basic | int) %}\n                    \n                    <td class=\"m2\" style=\"border:1px solid black\">{{ i.hra_received|int }}</td>\n                    <td class=\"m2\" style=\"border:1px solid black\">{{ i.excess_of_rent_paid|int }}</td>\n                    <td class=\"m2\" style=\"border:1px solid black\">{{ i.exemption_amount|int }}</td>\n                    \n                    \n                </tr>\n           \n     {% endfor %}\n    {% set b = sum_array | sum %}\n    \n    \n    <tr>\n        <td class=\"m2\" style=\"border:1px solid black\"><b>Total</b></td>\n        <td class=\"m2\" style=\"border:1px solid black\"><b>{{((section.monthly_house_rent*12)|round|int)}}</b></td>\n        \n        <td class=\"m2\" style=\"border:1px solid black\"><b>{{b}}</b></td>\n        <td class=\"m2\" style=\"border:1px solid black\"><b>{{section.hra_as_per_salary_structure|round|int}}</b></td>\n        <td class=\"m2\" style=\"border:1px solid black\"><b>{{section.annual_hra_exemption|round|int}}</b></td>\n        <td class=\"m2\" style=\"border:1px solid black\"><b>{{section.annual_hra_exemption|round|int}}</b></td>\n        \n    </tr>\n</table><br>\n\n\n        {% endif %}\n    {% endif %}\n    \n    \n {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%set sum_array=[]%}\n    {%if tax_exemption|length>0 %}\n        {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        \n        {% if section.hra_breakup| length > 0 %}   \n    \n<table style=\"border:1px solid black;width:100%\">\n    <tr>\n        <td class=\"m2\" >\n            Total House Rent Allowance Exemption Amount\nLeast amount of the three columns (% of Earned Basic, HRA Received and Excess of Rent Paid\nOver 10% of Basic) will be considered for tax exemption under HRA\n        </td>\n        <td class=\"m2\" >\n            <b>{{section.annual_hra_exemption|round|int}}</b>\n        </td>\n    </tr>\n</table>\n    {% endif %}\n    {% endif %}\n\n</body>\n</html>\n",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2024-08-27 10:19:55.546761",
  "module": "cn-indian-payroll",
  "name": "Income Tax Salary Slip",
  "page_number": "Hide",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": ".m1\n{\n    font-size: 20px;\n    font-family: serif;\n}\n\n.m2\n{\n    font-size: 14px;\n    font-family: serif;\n    \n    \n}\n\n\n\n.f1\n{\n    font-size: 14px;\n    font-family: serif;\n}\n\n.f2\n{\n    border:none;\n    font-size: 16px;\n    font-family: serif;\n}\n\n\n\n        /*tr.row1 td {*/\n        /*    border: 1px solid black; */\n        /*}*/",
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Salary Slip",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "<!DOCTYPE html>\n<html>\n    \n                {{letter_head}}\n           \n    \n<head>\n    \n</head>\n<body>\n    \n\n\n    \n   \n\n<p class=\"m1\">TDS WORK SHEET for the month of {{ frappe.utils.format_date(doc.start_date, \"MMMM, YYYY\") }}  </p>\n\n\n\n<table class=\"f2\" style=\"width:100%;\">\n  <tr>\n    <td class=\"f2\">Employee Name</td>\n    <td class=\"f2\">Pan</td>\n    <td class=\"f2\">Designation</td>\n    <td class=\"f2\">Tax Regime</td>\n  </tr>\n  \n  \n  {% set employee = frappe.get_doc(\"Employee\", doc.employee) %}\n       {% set tax_slab1 = frappe.get_list(\"Salary Structure Assignment\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"name\", \"employee\", \"income_tax_slab\"], order_by=\"from_date desc\") %}\n                {% if tax_slab1 %}\n                   {% set employee_tax_slab = tax_slab1[0].income_tax_slab %}\n                    \n               {%endif%}\n  \n  \n  \n   <tr>\n    <td class=\"f2\">{{doc.employee_name}}</td>\n    <td class=\"f2\">{%if employee.pan_number%} {{employee.pan_number}} {%endif%}</td>\n    <td class=\"f2\">{%if employee.designation%} {{employee.designation}} {%endif%}</td>\n    <td class=\"f2\">{{employee_tax_slab}}</td>\n  </tr>\n  \n  \n  \n  \n  \n</table>\n\n\n\n\n\n<hr style=\"border-style: dotted; border-width: 1px; border-color: black;\">\n\n\n    <p style=\"font-size: 16px;font-family: serif;\">Details of salary paid and any other income tax and tax deducted</p>\n\n<table style=\"width:100%;border: 1px solid black;\" >\n  <tr class=\"row2\" style=\"border: 1px solid black;\">\n    <th class=\"m2\" style=\"border: 1px solid black;\">Particulars</th>\n    <th class=\"m2\" style=\"border: 1px solid black;\">Actual</th> \n    <th class=\"m2\" style=\"border: 1px solid black;\">Projection</th>\n    <th class=\"m2\" style=\"border: 1px solid black;\">Total</th>\n  </tr>\n  \n  \n  \n \n\n<tr>\n\n  \n  \n<td style=\"border: 1px solid black;\">\n    <b class=\"m2\">1) Gross Earnings</b></br></br>\n{% set component_dict = {} %}\n{% set array = [] %}\n\n{%- for row in doc.earnings -%}\n    {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n    \n    {% if perquisite.is_tax_applicable == 1 and perquisite.custom_perquisite == 0 and perquisite.custom_is_reimbursement == 0 and perquisite.component_type!=\"LTA Taxable\"%}\n        \n        {% set _ = array.append({\"component\": perquisite.name, \"sequence\": perquisite.custom_sequence | int, \"amount\": row.amount, \"year_to_date\": row.year_to_date}) %}\n        \n        \n    {% endif %}\n    \n    \n    \n    \n{%- endfor -%}\n\n{# Sort the array based on the sequence for ordered display #}\n{% set sorted_array = array | sort(attribute='sequence') %}\n\n{%- for item in sorted_array -%}\n\n    {% if item.component in component_dict %}\n            {% set component_dict = component_dict.update({item.component: component_dict[item.component] + item.year_to_date}) %}\n        {% else %}\n            {% set component_dict = component_dict.update({item.component: item.year_to_date}) %}\n        {% endif %}\n    \n    \n    \n{% endfor %}\n\n{% for component, amount in component_dict.items() %}\n    <p class=\"m2\">{{ component }}</p>\n{% endfor %}\n\n\n{%- for row in doc.earnings -%}\n    {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n\n{%if perquisite.component_type==\"LTA Taxable\"%}\n    <p class=\"m2\">{{  perquisite.name}}</p>\n    \n    {%endif%}\n\n{%- endfor -%}\n\n\n    \n{%if doc.custom_perquisite_amount>0%}\n\n<p style=\"font-size: 14px; font-family: serif;\">Loan Perquisite </p>\n{%endif%}\n\n    \n    {% set ss_slip = frappe.get_list(\"Salary Structure Assignment\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"*\"], order_by=\"from_date desc\") %}\n               \n               {% if ss_slip[0].custom__car_perquisite==1 or ss_slip[0].custom_driver_provided_by_company==1%}\n               \n               \n               \n                <p style=\"font-size: 14px; font-family: serif;\">Other Perquisite Amount </p>\n            {% endif %}\n            \n            \n    \n    \n    \n \n </br></br>\n \n <p class=\"m2\"><b>Total Income</b></p>\n\n\n</td>\n\n<td style=\"border: 1px solid black;\" >\n    \n    \n</br></br>\n\n    \n    \n       {% set component_dict = {} %}\n       \n       {%set array=[]%}\n    \n{%- for row in doc.earnings -%}\n    {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n    \n    {% if perquisite.is_tax_applicable == 1 and perquisite.custom_perquisite == 0 and perquisite.custom_is_reimbursement == 0 and perquisite.component_type!=\"LTA Taxable\"%}\n        {% set _ = array.append({\"component\": perquisite.name, \"sequence\": perquisite.custom_sequence | int, \"amount\": row.amount, \"year_to_date\": row.year_to_date}) %}\n        \n        \n    {% endif %}\n{%- endfor -%}\n\n{# Sort the array based on the sequence for ordered display #}\n{% set sorted_array = array | sort(attribute='sequence') %}\n\n\n\n{%- for item in sorted_array -%}\n\n    {% if item.component in component_dict %}\n            {% set component_dict = component_dict.update({item.component: component_dict[item.component] + item.year_to_date }) %}\n        {% else %}\n            {% set component_dict = component_dict.update({item.component: item.year_to_date}) %}\n        {% endif %}\n    \n    \n    \n{% endfor %}\n\n{% for component, amount in component_dict.items() %}\n<p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format(amount|round|int) }}</p>\n{% endfor %}\n\n\n\n{%- for row in doc.earnings -%}\n    {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n\n{%if perquisite.component_type==\"LTA Taxable\"%}\n    <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((row.amount) |round|int) }}</p>\n    \n    {%endif%}\n\n{%- endfor -%}\n\n\n\n\n\n\n{%if doc.custom_perquisite_amount>0%}\n\n<p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((doc.custom_perquisite_amount) |round|int) }}</p>\n\n{%endif%}\n    \n    \n     {% set ss_slip = frappe.get_list(\"Salary Structure Assignment\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"*\"], order_by=\"from_date desc\") %}\n               \n               {% if ss_slip[0].custom__car_perquisite==1 or ss_slip[0].custom_driver_provided_by_company==1%}\n               \n               {%if ss_slip[0].custom__car_perquisite==1%}\n                {% set car_perquisite = ss_slip[0].custom_car_perquisite_as_per_rules |int %}\n                {%else%}\n                {% set car_perquisite = 0  %}\n                {%endif%}\n                \n                {%if ss_slip[0].custom_driver_provided_by_company==1%}\n                {% set driver_perquisite = ss_slip[0].custom_driver_perquisite_as_per_rules |int %}\n                {%else%}\n                {% set driver_perquisite = 0 %}\n                {%endif%}\n                {% set per_total = car_perquisite + driver_perquisite %}\n                 \n                <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((per_total * 12) |round|int) }}</p>\n\n            {% endif %}\n    \n   \n    \n   \n    \n\n\n    \n\n\n\n</td>\n\n<td style=\"border: 1px solid black;\"></br></br>\n\n   \n       \n       \n       \n      \n       {% set component_dict = {} %}\n    {%set array=[]%}\n{%- for row in doc.earnings -%}\n    {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n    \n    {% if perquisite.is_tax_applicable == 1 and perquisite.custom_perquisite == 0 and perquisite.custom_is_reimbursement == 0 and perquisite.component_type!=\"LTA Taxable\" %}\n        {# Summing the values for duplicate keys #}\n        {% set _ = array.append({\"component\": perquisite.name, \"sequence\": perquisite.custom_sequence | int, \"amount\": row.amount, \"year_to_date\": row.year_to_date,\"custom_amount\":row.custom_actual_amount}) %}\n        \n        \n    {% endif %}\n{%- endfor -%}\n\n{# Sort the array based on the sequence for ordered display #}\n{% set sorted_array = array | sort(attribute='sequence') %}\n\n{%- for item in sorted_array -%}\n     {% if item.component in component_dict %}\n            {% set component_dict = component_dict.update({item.component: component_dict[item.component] + item.custom_amount}) %}\n        {% else %}\n            {% set component_dict = component_dict.update({item.component: item.custom_amount}) %}\n        {% endif %}\n{% endfor %}\n\n{% for component, amount in component_dict.items() %}\n   \n      <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((amount*doc.custom_month_count)|round|int) }}</p>\n{% endfor %}\n     \n\n \n\n\n\n</td>\n<td style=\"border: 1px solid black;\"></br></br>\n\n{%set array=[]%}\n {% set component_dict = {} %}\n    \n{%- for row in doc.earnings -%}\n    {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n    \n    {% if perquisite.is_tax_applicable == 1 and perquisite.custom_perquisite == 0 and perquisite.custom_is_reimbursement == 0 and perquisite.component_type!=\"LTA Taxable\" %}\n        {# Summing the values for duplicate keys #}\n    {% set _ = array.append({\"component\": perquisite.name, \"sequence\": perquisite.custom_sequence | int, \"amount\": row.amount, \"year_to_date\": row.year_to_date,\"custom_amount\":row.custom_actual_amount}) %}\n\n       \n    {% endif %}\n{%- endfor -%}\n\n{% set sorted_array = array | sort(attribute='sequence') %}\n\n{%set total_taxable_sum=[]%}\n{%- for item in sorted_array -%}\n\n        {% if item.component in component_dict %}\n            {% set component_dict = component_dict.update({item.component: component_dict[item.component] + (item.custom_amount *doc.custom_month_count)+ item.year_to_date}) %}\n        {% else %}\n            {% set component_dict = component_dict.update({item.component: (item.custom_amount *doc.custom_month_count)+ item.year_to_date}) %}\n        {% endif %}\n\n    \n\n{% endfor %}\n\n\n{% for component, amount in component_dict.items() %}\n   \n      <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format(amount|round|int) }}</p>\n      {% set _ = total_taxable_sum.append((amount)|round|int) %}\n      \n{% endfor %}\n\n\n{%- for row in doc.earnings -%}\n    {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n\n{%if perquisite.component_type==\"LTA Taxable\"%}\n    <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((row.amount) |round|int) }}</p>\n    {% set _ = total_taxable_sum.append((row.amount)|round|int) %}\n    \n    {%endif%}\n\n{%- endfor -%}\n\n\n\n{%if doc.custom_perquisite_amount>0%}\n\n<p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((doc.custom_perquisite_amount) |round|int) }}</p>\n {% set _ = total_taxable_sum.append((doc.custom_perquisite_amount)|round|int) %}\n\n{%endif%}\n \n\n     \n     {% set ss_slip = frappe.get_list(\"Salary Structure Assignment\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"*\"], order_by=\"from_date desc\") %}\n               \n                {% if ss_slip[0].custom__car_perquisite==1 or ss_slip[0].custom_driver_provided_by_company==1%}\n               \n               {%if ss_slip[0].custom__car_perquisite==1%}\n                {% set car_perquisite = ss_slip[0].custom_car_perquisite_as_per_rules |round  %}\n                {%else%}\n                {% set car_perquisite = 0  %}\n                {%endif%}\n                \n                {%if ss_slip[0].custom_driver_provided_by_company==1%}\n                {% set driver_perquisite = ss_slip[0].custom_driver_perquisite_as_per_rules|round  %}\n                {%else%}\n                {% set driver_perquisite = 0 %}\n                {%endif%}\n                {% set per_total = car_perquisite + driver_perquisite %}\n                <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((per_total * 12) |round|int) }}</p>\n                 {% set _ = total_taxable_sum.append((per_total*12)|round|int) %}\n    {% endif %}\n \n \n \n \n \n \n \n \n \n \n  \n  {% set total=total_taxable_sum|sum%}\n \n {% set formatted_amount = \"{:,}\".format(total|round|int) %}\n\n </br></br>\n \n \n        \n        \n     <p class=\"m2\" style=\"text-align:right\"><b>{{formatted_amount}}</b></p>\n     \n       \n\n</td>\n\n\n</tr>\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n    <b class=\"m2\">2)Allowance to the extent exempt under section 10</b></br></br>\n\n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {%if tax_exemption[0].name %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        {%if section.annual_hra_exemption>0%}\n        \n         <p class=\"m2\" >House Rent Allowance</p>\n        {%endif%}\n        \n        {% for i in section.declaration_details %}\n            \n             {% if i.exemption_category in [\"Section 10(13A)\", \"Section 10(14)\"] %}\n                <p class=\"m2\" >{{ i.exemption_sub_category }}</p>\n            {% endif %}\n        {% endfor %}\n    \n    \n    {%endif%}\n    {%endif%}\n    \n    \n    </br></br>\n    \n    <p><b class=\"m2\"> Total of Allowance to the extent exempt under section 10</b></p>\n</td>\n\n\n<td style=\"border: 1px solid black;\">\n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    {%if tax_exemption|length>0 %}\n    \n    {%if tax_exemption[0].name %}\n    </br></br>\n     {% set array1 = [] %}\n        {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n         {%if section.annual_hra_exemption>0%}\n         \n        {% set formatted_amount = \"{:,}\".format(section.annual_hra_exemption|int) %}\n        <p class=\"m2\" style=\"text-align:right\">{{ formatted_amount }}</p>\n         \n          {% set _ = array1.append(section.annual_hra_exemption) %}\n        {%endif%}\n        \n       \n        {% for i in section.declaration_details %}\n             {% if i.exemption_category in [\"Section 10(13A)\", \"Section 10(14)\"] %}\n            \n            \n            {% set formatted_amount = \"{:,}\".format(i.declared_amount |round| int) %}\n            <p class=\"m2\" style=\"text-align:right\">{{ formatted_amount }}</p>\n                 {% set _ = array1.append(i.declared_amount|round| int) %}\n            {% endif %}\n        {% endfor %}\n        \n         {% set tax_total = array1 | sum | round | int %}\n         \n         \n         \n    {%else%}\n    \n    <p class=\"m2\">.0</p>\n     {% set tax_total = 0 %}\n        \n    {% endif %}\n    \n    {%else%}\n    {% set tax_total = 0 %}\n    \n    \n{%endif%}\n\n\n\n \n\n\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    \n    \n    \n    {%if tax_total%}\n    \n    {% set formatted_amount = \"{:,}\".format(tax_total|round | int) %}\n           \n   </br></br></br></br></br></br> <p class=\"m2\"  style=\"text-align:right\"><b>{{formatted_amount}}</b></p>\n    {%else%}\n    </br></br></br></br><p class=\"m2\"  style=\"text-align:right\"><b>0</b></p>\n    {%endif%}\n</td>\n\n\n\n\n\n\n\n\n  \n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">3) Total After Exemption (1-2)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    {%if total or tax_total%}\n    \n    \n   \n    <p class=\"m2\" style=\"text-align:right\"> <b>{{ \"{:,}\".format((total - tax_total)|round|int) }}</b></p>\n\n    \n    \n    {% else %}\n    <p><b class=\"m2\"  style=\"text-align:right\">0</b></p>\n    \n    {%endif%}\n\n    \n    \n</td>\n    \n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">4) Taxable income under previous employment</b></p></br></br>\n   <p class=\"m2\">1. Income after exemption</p>\n   <p class=\"m2\">2. Less:Professional Tax</p>\n   \n   </br></br>\n   \n   <p><b class=\"m2\">Total taxable income under previous employment</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\"></br></br>\n    &nbsp;\n   <p class=\"m2\"  style=\"text-align:right\"> 0</p> \n   <p class=\"m2\"  style=\"text-align:right\"> 0</p>\n</td>\n\n<td style=\"border: 1px solid black;\"></br></br>\n    &nbsp;\n    <p class=\"m2\"  style=\"text-align:right\"> 0</p>\n    <p class=\"m2\"  style=\"text-align:right\"> 0</p>\n   \n</td>\n\n<td style=\"border: 1px solid black;\"></br></br></br></br></br></br></br></br>\n<p class=\"m2\"  style=\"text-align:right\"><b> 0</b></p>   \n</td>\n    \n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">5) Gross Total (3+4)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    \n     {%if total or tax_total%}\n     \n    <p class=\"m2\"  style=\"text-align:right\"><b >{{ \"{:,}\".format((total - tax_total)|round|int) }}</b></p>\n    \n    \n    \n    {%else%}\n    <p class=\"m2\"  style=\"text-align:right\"> 0</p>\n    \n    {%endif%}\n    \n</td>\n    \n</tr>\n\n\n\n<tr>\n    <td style=\"border: 1px solid black;\">\n        <p><b style=\"font-size: 14px;font-family: serif;\">6) Under Section 16</b></p></br>\n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    \n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 16\" %}\n                <p class=\"m2\" > {{ i.exemption_sub_category}}</p>\n            {% endif %}\n        {% endfor %}\n        \n        \n    \n    {% endif %}\n    \n    <p class=\"m2\">Standard Deduction</p>\n    \n    </br></br>\n    <p><b class=\"m2\"> Total Under Section 16</b></p>\n    \n    </td>\n    \n    <td style=\"border: 1px solid black;\"></br></br>\n        {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        {% set array2=[]%}\n        \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 16\" %}\n                <p class=\"m2\"  style=\"text-align:right\"> {{ \"{:,}\".format(i.declared_amount|round| int) }}</p>\n                \n                {% set _ = array2.append(i.declared_amount|round| int) %}\n            {% endif %}\n        {% endfor %}\n        \n        \n    {%else%}\n    \n   \n    \n    {% set form_16 = 0 %}\n        \n    {% endif %}\n    \n    <p class=\"m2\"  style=\"text-align:right\">50000</p>\n    {%if array2%}\n    \n    {% set _ = array2.append(50000) %}\n     {% set form_16 = array2 | sum %}\n     \n     {%else%}\n     \n     {% set form_16 =50000 %}\n     \n     \n       {% endif %}\n    \n    \n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\"></br></br></br></br></br></br>\n{%if form_16%}\n       <p class=\"m2\"  style=\"text-align:right\"><b >{{ \"{:,}\".format(form_16|round| int) }} </b></p>  \n       \n{%endif%}\n</td>\n    \n\n</tr>\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">7) Income chargeble under Head Salaries (5-6)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n         {%if total or tax_total or form_16 %} \n         \n         <p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(total - tax_total - form_16|round| int) }}</b></p>\n         \n         \n         {%else%}\n         <p class=\"m2\"  style=\"text-align:right\"><b>0</b></p>\n         \n         {%endif%}\n</td>\n    \n</tr>\n\n\n\n<tr>\n     \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">8) Any Other income reported by employee</b></p>\n   </br>\n   <p class=\"f1\">Interest Paid on Home Loan</p>\n   <p class=\"f1\">Let Out Property</p></br>\n   \n   <p><b class=\"f1\">Total Income From Other Sources</b></p>\n   <p style=\"font-size: 10px;font-family: serif;\">Note: A maximum of Rs.200,000.00 is allowed as exemption\nfor housing loan interests on Self Occupied House Property\nand Let Out Property.</p>\n</td>\n\n<td style=\"border: 1px solid black;\"></br></br>\n\n {% set c_array11 = [] %}\n{% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80EE\" %}\n            <p class=\"m2\"  style=\"text-align:right\">{{ \"{:,}\".format(i.declared_amount|round| int) }}</p> \n            \n           \n            {% set _ = c_array11.append(i.declared_amount|round| int) %}\n           \n            \n            {% endif %}\n        {% endfor %}\n        \n         \n        {% set c_array11 = c_array11 | sum %}\n        \n        \n        {%else%}\n        <p class=\"m2\"  style=\"text-align:right\">0</p>\n        {% set c_array11 = 0 %}\n    {%endif%}\n \n    \n    <!--<p>value</p>-->\n    <p class=\"m2\"  style=\"text-align:right\">0</p></br>\n    \n    \n    \n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\"></br></br></br></br></br></br></br>\n\n{%if c_array11 %}\n<p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(c_array11|round| int) }}</b></p> \n\n{%else%}\n<p class=\"m2\"  style=\"text-align:right\"><b>0</b></p>\n{%endif%}\n</td>\n    \n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">9) Gross Total Income (7+8)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    {%set sum_tax=[]%}\n     {%if total or tax_total or form_16 or c_array11%} \n         \n         <p class=\"m2\" style=\"text-align:right\"><b>{{ \"{:,}\".format((total - tax_total - form_16 - c_array11) |round| int) }}</b></p>\n\n         \n         {% set t1= (total-tax_total-form_16-c_array11) |round|int%}\n \n         \n         \n          {% set _ = sum_tax.append(t1) %}\n         \n         \n         \n         \n         \n         {%else%}\n         <p class=\"m2\"  style=\"text-align:right\"><b>0</b></p>\n         \n         {%endif%}\n    \n   \n\n</td>\n    \n</tr>\n\n\n\n\n<tr>\n     <td style=\"border: 1px solid black;\">\n        \n         <p><b class=\"m2\">10) Deduction under chapter VI-A</b></p></br>\n   \n       <p class=\"f1\"><b>80C</b></p>\n       \n       {% set c_array1 = [] %}\n\n   {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80C\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\"> {{ \"{:,}\".format(i.declared_amount|round| int) }}</span>\n                \n                \n                {% set _ = c_array1.append(i.declared_amount|round| int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n        {#\n        {% set c_array11 = c_array1 | sum %}\n        #}\n        \n         {% set c_sum = c_array1 | sum %}\n         {%if c_sum>150000%}\n         \n         {%set c_array11=150000%}\n         \n         {%else%}\n         \n         {%set c_array11=c_sum%}\n         \n         {%endif%}\n         \n         \n        \n        \n       \n        \n    {% endif %}\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n            <p class=\"m2\">Qualifying</p></br>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n             \n            <p class=\"m2\">Deductible</p>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\" ><br><br><br><br><br><br>\n         \n         {%if c_array11%}\n             \n            <p class=\"m2\" style=\"text-align:right\"><b>{{ \"{:,}\".format(c_array11|round|int) }}</b></p>\n            \n            {%else%}\n             <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p>\n            {%endif%}\n             \n             \n         </td>\n    \n</tr>\n\n\n\n\n\n<tr>\n     <td style=\"border: 1px solid black;\">\n        \n         \n   \n       <p class=\"f1\"><b>80CCC</b></p>\n    \n     {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        {% set c_array2 = [] %}\n        \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80CCC\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\"> {{ \"{:,}\".format(i.declared_amount|round| int) }}</span>\n                \n                \n                {% set _ = c_array2.append(i.declared_amount|round| int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n         {% set c_array22 = c_array2 | sum %}\n       \n        \n    {% endif %}\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n            <p class=\"m2\">&nbsp;</p></br>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n             \n            <p class=\"m2\">&nbsp;</p>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\" ><br>\n          {%if c_array11%}\n             \n            <p class=\"m2\" style=\"text-align:right\"><b>{{ \"{:,}\".format(c_array22|round| int) }}</b></p>\n            \n            \n            \n            \n            {%else%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p>\n\n             {%endif%}\n             \n         </td>\n    \n</tr>\n\n\n\n<tr>\n     <td style=\"border: 1px solid black;\">\n        \n         \n   \n       <p class=\"f1\"><b>80CCD</b></p>\n    \n     {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n          {% set c_array3 = [] %}   \n          \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80CCD\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\"> {{ \"{:,}\".format(i.declared_amount|round|int) }}</span>\n                \n                {% set _ = c_array3.append(i.declared_amount|round|int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n       {% set c_array33 = c_array3 | sum %}\n        \n    {% endif %}\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n            <p class=\"m2\">&nbsp;</p></br>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n             \n            <p class=\"m2\">&nbsp;</p>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\" ><br>\n         \n         {%if c_array33%}\n             \n            <p class=\"m2\">{{ \"{:,}\".format(i.c_array33|round|int) }}</p>\n            {%else%}\n                        <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p>\n\n            {%endif%}\n             \n             \n         </td>\n    \n</tr>\n\n\n\n<tr>\n    <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>Total (80C+80CCC+80CCD)</b> </p>\n     </td>\n      <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>&nbsp;</b> </p>\n     </td>\n      <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>&nbsp;</b> </p>\n     </td>\n      <td style=\"border: 1px solid black;\">\n          {%if c_array11 or c_array22 or c_array33%}\n     <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">{{ \"{:,}\".format((c_array11 + c_array22 + c_array33)|round|int) }}</p></b> </p>\n     \n     {%else%}\n          <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p></b> </p>\n\n     {%endif%}\n     \n     </td>\n</tr>\n\n\n\n\n\n<tr>\n    <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>80CCD(1B)</b></p>\n    \n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n          {% set c_array4 = [] %}   \n          \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80CCD(1B)\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\">  {{ \"{:,}\".format(i.declared_amount|round|int) }}</span>\n                \n                {% set _ = c_array4.append(i.declared_amount|round|int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n       {% set c_array44 = c_array4 | sum %}\n        \n    {% endif %}\n    </td>\n    <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">\n            \n            {%if c_array44%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">{{ \"{:,}\".format(c_array44|round|int) }}</p></b> </p>\n            \n            {%else%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p></b> </p>\n\n            {%endif%}\n        </td>\n     \n</tr>\n\n\n\n\n\n\n<tr>\n    <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>80CCD(2)</b></p>\n    \n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n          {% set c_array5 = [] %}   \n          \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80CCD(2)\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\"> {{ \"{:,}\".format(i.declared_amount|round|int) }}</span>\n                {% set _ = c_array5.append(i.declared_amount|round|int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n       {% set c_array55 = c_array5 | sum %}\n        \n    {% endif %}\n    </td>\n    <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">\n            {%if c_array55%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">{{ \"{:,}\".format(c_array55|round|int) }}</p></b> </p>\n            {%else%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p></b> </p>\n\n            {%endif%}\n        </td>\n     \n</tr>\n\n\n\n\n\n<tr>\n    <td>\n    <p class=\"f1\"><b>80D</b></p>\n    \n   \n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n          {% set c_array6 = [] %}   \n          \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80D\" %}\n            \n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp;\n                <span style=\"float: right;\">  {{ \"{:,}\".format(i.declared_amount|round|int) }}</span>\n                {% set _ = c_array6.append(i.declared_amount|round|int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n        \n     \n        \n       {% set c_array66 = c_array6 | sum %}\n        \n    {% endif %}\n    </td>\n    <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">\n            \n            {%if c_array66 %}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">{{ \"{:,}\".format(c_array66|round|int) }}</p></b> </p>\n            {%else%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p></b> </p>\n\n            {%endif%}\n        </td>\n     \n</tr>\n\n\n<tr>\n    \n     <td style=\"border: 1px solid black;\">\n         <p class=\"f1\"><b>Total of Deductions under Chapter VI-A</b></p>\n\n     </td>\n     <td style=\"border: 1px solid black;\">\n         &nbsp;\n         \n     </td>\n     <td style=\"border: 1px solid black;\">&nbsp;\n         \n     </td>\n     <td style=\"border: 1px solid black;\">\n         \n          {%if c_array66 or c_array55 or c_array44 or c_array11 or c_array22 or c_array33 %}\n         \n         <p class=\"f1\" style=\"text-align:right\"><b>{{ \"{:,}\".format((c_array66+c_array55+c_array44+c_array11 + c_array22 + c_array33)|round|int) }}</b></p>\n         \n         {% set _ = sum_tax.append(c_array66+c_array55+c_array44+c_array11 + c_array22 + c_array33|round|int) %}\n         \n         \n         \n         {%else%}\n         {% set _ = sum_tax.append(0) %}\n         <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p></b> </p>\n     {%endif%}\n     </td>\n    \n</tr>\n\n\n\n<tr>\n\n <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">11) Total Taxble Value  (9-10)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    \n   \n    \n    \n    \n    \n    <p class=\"f1\"  style=\"text-align:right\"><b>{{ \"{:,}\".format((sum_tax[0]-sum_tax[1])|round|int) }}</b></p>\n    \n    \n    \n       \n    \n    \n   \n    \n      \n      \n      \n    \n    </td>\n        \n  </tr> \n  \n  \n  \n    <tr>\n      <td style=\"border: 1px solid black;\">\n          \n          <p><b class=\"m2\"> 12) Tax Calculation</b></p>\n          \n          {%if doc.custom_tax_slab|length>0%}\n          \n          \n          <table style=\"border:1px solid black;width:100%\">\n              <tr>\n                  <td style=\"width:70%;border:1px solid black\">\n                       <p class=\"f1\"><b> Taxable Income Range</b></p>\n                     \n                  </td>\n                  \n                  <td style=\"width:30%;border:1px solid black\">\n                     <p class=\"f1\"><b>  Tax Amount</b></p>\n                  </td>\n                  \n                  \n              </tr>\n              \n              {%for i in doc.custom_tax_slab%}\n              <tr>\n                  <td style=\"border:1px solid black\">\n                      {%if i.to_amount>0%}\n                       <p class=\"f1\"  >{{i.from_amount|round}}-{{i.to_amount|round}}<br>(Tax: of {{i.percentage}}% of {{i.amount|round}})</p>\n                  \n                        {%else%}\n                        {%if i.to_amount==0%}\n                        <p class=\"f1\"  >{{i.from_amount|round}} And Above<br>(Tax: of {{i.percentage}}% of {{i.amount|round}})</p>\n\n                        {%endif%}\n                        \n                {%endif%}\n\n                  \n                  </td>\n                  \n                  <td style=\"border:1px solid black\">\n                       <p class=\"f1\" style=\"text-align:right\" >{{i.tax_amount|round}}</p>\n                  </td>\n              </tr>\n              {%endfor%}\n          </table>\n          <br>\n          \n\n        {%endif%}\n         \n      </td>\n      <td style=\"border: 1px solid black;\">\n          \n      </td>\n      <td style=\"border: 1px solid black;\">\n          \n      </td>\n      <td style=\"border: 1px solid black;\">\n          \n          \n          \n      </td>\n  </tr>\n  \n  \n  \n  \n   \n  <tr>\n    \n    <td style=\"border: 1px solid black;\">\n        \n        {%if doc.custom_income_tax_slab==\"Old Regime\"%}\n    \n           <p class=\"f1\"><b>Tax on total Income</b></p>\n                  <p class=\"f1\"><b>Less : Rebate Under Section 87A</b></p>\n                  <p style=\"font-size:10px\">Note: If taxable income is less than Rs.500,000.00, tax rebate\n        of a maximum of Rs.12,500.00 is provided under Section 87A.</p></b></p>\n        \n        {%else%}\n        \n         <p class=\"f1\"><b>Tax on total Income</b></p>\n                  <p class=\"f1\"><b>Less : Rebate Under Section 87B</b></p>\n                  <p style=\"font-size:10px\">Note: If taxable income is less than Rs.700,000.00, tax rebate\n        of a maximum of Rs.25,000.00 is provided under Section 87A.</p></b></p>\n        \n        {%endif%}\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n\n        <p class=\"f1\" style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.custom_tax_on_total_income|round|int) }}</b></p>\n          <p class=\"f1\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.custom_rebate_under_section_87a|round|int) }}</b></p>\n          \n          \n          \n   \n\n</td>\n    \n    \n</tr>\n  \n  \n  \n  \n  \n  \n \n             \n  \n\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">13) Total Tax on Income</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n   \n         <p class=\"m2\"   style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.custom_total_tax_on_income|round|int) }}</b></p>\n         \n         \n        \n</td>\n    \n    \n</tr>\n\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n  \n   \n   \n   \n   \n                    <p class=\"m2\"><b>Surcharge</b></p>\n                    <p class=\"m2\"><b>Education Cess</b></p>\n                    <p class=\"m2\"><b>Less: Relief Under Section 89</b></p>\n                    \n\n \n   \n    </td>\n    \n    <td style=\"border: 1px solid black;\">\n       \n        &nbsp;\n    </td>\n    \n    <td style=\"border: 1px solid black;\">\n       \n        &nbsp;\n    </td>\n    <td style=\"border: 1px solid black;\">\n        \n      <p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.custom_surcharge|round|int) }}</b></p>\n             <p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.custom_education_cess|round|int) }}</b></p>\n             <p class=\"m2\"  style=\"text-align:right\"><b>0</b></p>\n            \n       </td>\n        \n       \n     \n    \n    \n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">14) Tax Payable including Education cess minus of relief under section 89</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    \n        \n              \n         <p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format((doc.custom_total_tax_on_income + doc.custom_surcharge + doc.custom_education_cess)|round|int) }}</b></p>\n         \n\n             \n           \n    \n</td>\n    \n    \n</tr>\n\n\n\n<tr>\n\n <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">15) Tax Deducted at source u/s 192</b></p>\n   </br> \n   <p class=\"m2\">* TDS till last month</p>\n   <p class=\"m2\">* TDS of the month</p>\n   <p class=\"m2\">* TDS by Previous Employer</p></br>\n   <p class=\"m2\">Total Tax Deducted at source</p></br>\n   <p class=\"m2\">Tax Payable / Refundable (14 - 15(A))</p>\n   <p class=\"m2\">TDS per month for the next {{doc.custom_month_count}} months</p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n   {% set tax_exemption = frappe.get_list(\n        \"Salary Slip\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"custom_payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"*\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {%set tds_sum=[]%}\n    {%for j in tax_exemption %}\n    {%if j.name!=doc.name%}\n    \n    {%set _ = tds_sum.append(j.current_month_income_tax)%}\n    \n    \n    \n    \n    \n    \n    \n    {%endif%}\n    \n    {%endfor%}\n    \n    {%endif%}\n    \n    {%set j1=tds_sum|sum%}\n    \n    </br>    </br>\n   <p class=\"m2\"  style=\"text-align:right\">{{j1|round|int}}</p>\n   \n   \n     \n{%if doc.current_month_income_tax > 0%}\n{%set month_tds=doc.custom_total_amount/12%}\n<p class=\"m2\"  style=\"text-align:right\">{{ \"{:,}\".format(doc.current_month_income_tax|round|int) }}</p>\n{%else%}\n<p class=\"m2\"  style=\"text-align:right\">0</p>\n{%endif%}\n\n\n\n        <p class=\"m2\"  style=\"text-align:right\">0</p></br>\n\n\n\n\n\n\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\"></br>    </br></br>    </br></br>    </br></br>\n{%if doc.current_month_income_tax > 0%}\n    <p class=\"m2\"  style=\"text-align:right\"><b>{{(doc.current_month_income_tax+j1)|round|int}}</b></p>\n    \n    {%else%}\n<p class=\"m2\"  style=\"text-align:right\">0</p>\n{%endif%}\n \n {%set j2=doc.current_month_income_tax+j1%}\n {%set j3=doc.custom_total_tax_on_income + doc.custom_surcharge + doc.custom_education_cess%}\n {%set final=j3-j2%}\n <br>\n <p class=\"m2\"  style=\"text-align:right\"><b>{{(final)|round|int}}</b></p>\n {#\n <p class=\"m2\"  style=\"text-align:right\"><b>{{(final/doc.custom_month_count)|round|int}}</b></p>\n #}\n <p class=\"m2\"  style=\"text-align:right\"><b>{{(doc.current_month_income_tax|round|int)}}</b></p>\n\n</td>\n    \n\n</tr>\n\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n        <p class=\"m2\"><b>TDS for {{doc.custom_month}}</b></p>\n   </td>\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    {%if doc.current_month_income_tax > 0%}\n    \n    <p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.current_month_income_tax|round|int) }}</b></p>\n    {%else%}\n<p class=\"m2\"  style=\"text-align:right\">0</p>\n{%endif%}\n</td>\n    \n    \n</tr>\n\n\n\n\n\n\n\n\n\n\n\n\n\n</table>\n\n\n<br>\n<table style=\"width:100%;border:1px solid black\">\n    \n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%set sum_array=[]%}\n    {%if tax_exemption|length>0 %}\n        {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        \n        {% if section.hra_breakup| length > 0 %}\n    \n    \n    <tr>\n        <td class=\"m2\" style=\"border:1px solid black\">Month</td>\n        <td class=\"m2\" style=\"border:1px solid black\">Rent Paid</td>\n        <td class=\"m2\" style=\"border:1px solid black\">% of Earned Basic(Metro 50%, Non-Metro 40%)</td>\n        <td class=\"m2\" style=\"border:1px solid black\">HRA Received</td>\n        <td class=\"m2\" style=\"border:1px solid black\">Excess of Rent Paid Over 10% of Basic</td>\n        <td class=\"m2\" style=\"border:1px solid black\">Exemption Amount</td>\n    </tr>\n    \n    {% endif %}\n    {% endif %}\n    \n    \n    \n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%set sum_array=[]%}\n    {%if tax_exemption|length>0 %}\n        {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        \n        {% if section.hra_breakup| length > 0 %}\n            {% for i in section.hra_breakup %}\n                <tr>\n                   <td class=\"m2\" style=\"border:1px solid black\">{{ i.month}}</td>\n                    <td class=\"m2\" style=\"border:1px solid black\">{{ i.rent_paid|int }}</td>\n                    <td class=\"m2\" style=\"border:1px solid black\">{{ i.earned_basic|int }}</td>\n                    {% set _ = sum_array.append(i.earned_basic | int) %}\n                    \n                    <td class=\"m2\" style=\"border:1px solid black\">{{ i.hra_received|int }}</td>\n                    <td class=\"m2\" style=\"border:1px solid black\">{{ i.excess_of_rent_paid|int }}</td>\n                    <td class=\"m2\" style=\"border:1px solid black\">{{ i.exemption_amount|int }}</td>\n                    \n                    \n                </tr>\n           \n     {% endfor %}\n    {% set b = sum_array | sum %}\n    \n    \n    <tr>\n        <td class=\"m2\" style=\"border:1px solid black\"><b>Total</b></td>\n        <td class=\"m2\" style=\"border:1px solid black\"><b>{{((section.monthly_house_rent*12)|round|int)}}</b></td>\n        \n        <td class=\"m2\" style=\"border:1px solid black\"><b>{{b}}</b></td>\n        <td class=\"m2\" style=\"border:1px solid black\"><b>{{section.hra_as_per_salary_structure|round|int}}</b></td>\n        <td class=\"m2\" style=\"border:1px solid black\"><b>{{section.annual_hra_exemption|round|int}}</b></td>\n        <td class=\"m2\" style=\"border:1px solid black\"><b>{{section.annual_hra_exemption|round|int}}</b></td>\n        \n    </tr>\n</table><br>\n\n\n        {% endif %}\n    {% endif %}\n    \n    \n {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%set sum_array=[]%}\n    {%if tax_exemption|length>0 %}\n        {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        \n        {% if section.hra_breakup| length > 0 %}   \n    \n<table style=\"border:1px solid black;width:100%\">\n    <tr>\n        <td class=\"m2\" >\n            Total House Rent Allowance Exemption Amount\nLeast amount of the three columns (% of Earned Basic, HRA Received and Excess of Rent Paid\nOver 10% of Basic) will be considered for tax exemption under HRA\n        </td>\n        <td class=\"m2\" >\n            <b>{{section.annual_hra_exemption|round|int}}</b>\n        </td>\n    </tr>\n</table>\n    {% endif %}\n    {% endif %}\n\n</body>\n</html>\n",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2024-09-10 09:53:48.730077",
  "module": "cn-indian-payroll",
  "name": "TDS",
  "page_number": "Hide",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": ".s2\n{\n    font-size: 16px;font-family: serif;\n    border:none;\n    background-color: #CCF8DB;\n}\n\n.f22\n{\n    font-size: 14px;\n    font-family: serif ;\n    color:#566573\n}\n\n\n\n.f11\n{\n    \n    font-size: 14px;\n    font-family: serif;\n    border:none;\n    color:#566573\n}\n\n\n.f1\n{\n    \n    font-size: 16px;\n    font-family: serif;\n}\n\n.f2\n{\n    \n    font-size: 14px;\n    font-family: serif;\n    border:none;\n    color:black;\n}\n\n.f4\n{\n    \n    font-size: 30px;\n    font-family: serif;\n    color: #15C650\n}\n\n.f6\n{\n    \n   \n    border:none;\n    font-size: 14px;\n    font-family: serif;\n}\n\n\n\n.f8 {\n  background-color: #dddddd;\n   border:none;\n   font-size: 14px;\n   font-family: serif;\n}\n\n\n  /*table, td {*/\n  /*  border: 1px solid black;*/\n  /*  border-collapse: collapse;*/\n  /*}*/\n  \n  .right-box {\n    float: right;\n    border: 1px solid black;\n    padding: 10px;\n    margin-left: 20px;\n  }\n",
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Salary Slip",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "\n\n<!--<p class=\"f1\"><b>Meril Life Sciences Private Limited</b></p>-->\n<!--<p class=\"f2\">Survey no. 135/139, Muktanand Marg, Chala, Vapi, Gujarat Vapi Gujarat 396191 India</p>-->\n\n{{letter_head}}\n\n<hr>\n\n    <p class=\"f1\">Payslip for the month of {{ frappe.utils.format_date(doc.start_date, \"MMMM, YYYY\") }}</p>\n    <p class=\"f2\"><b>Employee Pay Summary</b></p>\n    \n    \n\n    {% set employee = frappe.get_doc(\"Employee\", doc.employee) %}\n\n    \n    \n    \n<table class=\"f11\" style=\"width:100%\">\n  <tr>\n    <td class=\"f11\">\n    <p class=\"f11\" >Employee Code</p>\n    <p class=\"f11\" >Employee Name</p>\n    <p class=\"f11\"  >Designation</p>\n    <p class=\"f11\"  >Department</p>\n    <p class=\"f11\"  >Date of Joining</p>\n    <p class=\"f11\"  >Pay Period</p>\n    <p class=\"f11\" >Pay Date</p>\n    <p class=\"f11\" >PF A/C Number</p>\n    <p class=\"f11\" >UAN</p>\n    <p class=\"f11\">Bank Acc.No</p>\n    </td>\n    \n    <td class=\"f2\">\n        <p class=\"f2\">{{ doc.employee }}</p>\n        <p class=\"f2\">{{ doc.employee_name }}</p>\n        <p class=\"f2\">{{ employee.designation }}</p>\n        <p class=\"f2\">{{ employee.department }}</p>\n        <p class=\"f2\">{{ frappe.utils.format_date(employee.date_of_joining, \"dd-MM-yyyy\") }}</p>\n        <p class=\"f2\">{{ frappe.utils.format_date(doc.start_date, \"MMMM, YYYY\") }}\n        <p class=\"f2\">{{ frappe.utils.format_date(doc.posting_date, \"dd-MM-yyyy\") }}\n        <p class=\"f2\">{{ employee.provident_fund_account }}\n        <p class=\"f2\">{{ employee.custom_uan }}\n        <p class=\"f2\">{{ employee.bank_ac_no }}\n        \n        \n        </td>\n        \n    <td class=\"f2\">\n        <!--<table style=\"width:100%\" border-color: #96D4D4;>-->\n        <table style=\"width:100%; border:1px solid black\">\n\n              <tr>\n                <td style=\"border-color: #CCD1D1\">\n                    <center><p class=\"f22\">Employee Netpay</p></center>\n                   <b> <center><p class=\"f4\">Rs. {{ \"{:,.0f}\".format(doc.custom_net_pay_amount|int) }}</p></center></b>\n                    <center><p class=\"f22\"> Paid Days : {{doc.payment_days}} | LOP Days : {{doc.leave_without_pay}}  {%if doc.custom_lop_reversal_days>0%}<br> LOP Reversal Days: {{doc.custom_lop_reversal_days}} {%endif%}</p></center>\n                    \n                </td>\n                \n              </tr>\n            </table>\n        \n        \n        \n    </td>\n    \n  </tr>\n  \n  </table>\n  \n  <hr>\n  \n\n\n<table style=\"width:100%;border;none\" >\n    <tr>\n        <td>\n            <table style=\"width:100%;border:1px solid black\">\n                <tr>\n                    <td  class=\"f8\" style=\"border: 1px solid black\"><b>Earnings</b></td>\n                    <td  class=\"f8\" style=\"border: 1px solid black\"><b>Amount</b></td>\n                    <td  class=\"f8\" style=\"border: 1px solid black\"><b>YTD</b></td>\n                </tr>\n                \n                    \n                    {%set ytd_sum=[]%}\n                    {%set array=[]%}\n                     {%- for row in doc.earnings -%}\n                    <tr>\n                        \n                        {%set doc1 = frappe.get_doc('Salary Component', row.salary_component)%}\n                        \n                        {%if doc1.custom_is_part_of_gross_pay==1 or doc1.do_not_include_in_total==0 and doc1.custom_is_reimbursement==0%}\n                        \n                              <td class=\"f6\" style=\"border: 1px solid black\">{{ row.salary_component }}</td>\n                              <td class=\"f6\" style=\"border: 1px solid black;text-align:right\">{{ \"{:,.0f}\".format(row.amount|int) }}</td>\n                             <td class=\"f6\" style=\"border: 1px solid black;text-align:right\">{{ \"{:,.0f}\".format(row.year_to_date|int) }}</td>\n                             \n                                {%set _=ytd_sum.append(row.year_to_date)%}\n\n                        {%endif%}\n                        \n                        {% if doc1.custom_is_reimbursement == 1 %}\n        \n                        {%set _=array.append(row.salary_component)%}\n                        \n                            \n                               \n                                \n                           \n                        {% endif %}\n                        \n                        \n                        \n                        \n                    </tr>\n                    {%- endfor -%}\n                    \n                     {% set ytd_total = ytd_sum | sum %}\n                \n                \n                <tr>\n                    <td style=\"border: 1px solid black;font-family: serif;font-size: 14px;\"><b>Gross Earnings</b></td>\n                    <td   style=\"border: 1px solid black;font-family: serif;text-align:right\"><b>{{ \"{:,.0f}\".format(doc.custom_total_income|int) }}</b></td>\n                    <td   style=\"border: 1px solid black;font-family: serif;text-align:right\"><b>{{ \"{:,.0f}\".format(ytd_total|int) }}</b></td>\n        \n                </tr>\n            </table>\n            \n            \n            \n            \n        </td>\n        \n        <td>\n            <table style=\"width:100%;border:1px solid black\">\n                <tr>\n                    <td class=\"f8\" style=\"border: 1px solid black\"><b>Deductions</b></td>\n                    <td  class=\"f8\" style=\"border: 1px solid black\"><b>Amount</b></td>\n                    <td  class=\"f8\" style=\"border: 1px solid black\"><b>YTD</b></td>\n                  </tr>\n                <tr>\n                    \n    {%set ytd_deduction=[]%}\n                      \n     {%- for row in doc.deductions -%}\n     {%if row.amount>0%}\n    <tr>\n        \n        {%set doc1 = frappe.get_doc('Salary Component', row.salary_component)%}\n        \n        {%if doc1.do_not_include_in_total==0 %}\n        \n              <td class=\"f6\" style=\"border: 1px solid black\">{{ row.salary_component }}</td>\n              <td class=\"f6\" style=\"border: 1px solid black;text-align:right\">{{ \"{:,.0f}\".format(row.amount|int) }}</td>\n             <td class=\"f6\" style=\"border: 1px solid black;text-align:right\">{{ \"{:,.0f}\".format(row.year_to_date|int) }}</td>\n                \n            {%set _=ytd_deduction.append(row.year_to_date)%}\n\n             \n        {%endif%}\n    </tr>\n    {%endif%}\n    {%- endfor -%}\n    \n    \n    \n    \n    {%if doc.loans%}\n    {%set loan_array=[]%}\n    {%for i in doc.loans%}\n    <tr>\n            <td class=\"f6\" style=\"border: 1px solid black;\">Personal Loan</td>\n          <td class=\"f6\" style=\"border: 1px solid black;text-align:right\">{{ \"{:,.0f}\".format(i.total_payment|int) }}\n          \n           {%set _=loan_array.append(i.total_payment)%}\n           \n           </td>\n         <td class=\"f6\" style=\"border: 1px solid black;text-align:right\">{{ \"{:,.0f}\".format(i.total_payment|int) }}</td> \n        {%set _=ytd_deduction.append(i.total_payment)%}\n\n    </tr>\n    {%endfor%}\n    {%endif%}\n    \n                </tr>\n                \n                {% set ytd_total_sum = ytd_deduction | sum %}\n\n                <tr>\n                    <td style=\"border: 1px solid black;font-family: serif;font-size: 14px;\"><b>Total Deduction</b></td>\n                    <td   style=\"border: 1px solid black;font-family: serif;text-align:right\"><b>{{ \"{:,.0f}\".format(doc.custom_total_deduction_amount|int) }}</b></td>\n                    <td   style=\"border: 1px solid black;font-family: serif;text-align:right\"><b>{{ \"{:,.0f}\".format(ytd_total_sum|int) }}</b></td>\n        \n                </tr>\n            </table>\n        </td>\n    </tr>\n</table>\n {% set total1 = loan_array | sum %}\n\n\n<br>\n\n\n\n<table style=\"width:100%;border:1px solid black\">\n    \n    \n            \n        {% if array|length > 0 %}\n\n             <tr>\n                    <td style=\"font-size: 14px;font-family: serif ; border:1px solid black;background-color: #dddddd;text-align:center\">\n                        <b>Reimbursements</b>\n                    </td>\n                    <td style=\"font-size: 14px;font-family: serif ;border:1px solid black;background-color: #dddddd;text-align:center\">\n                        <b>Amount</b>\n                    </td>\n                   \n                </tr>\n             \n            \n    \n        {%set sum=[]%}\n        {%set re_ytd_sum=[]%}\n        {% for row in doc.earnings %}\n        \n            {%set doc1 = frappe.get_doc('Salary Component', row.salary_component)%}\n            \n                {%if doc1.custom_is_reimbursement==1%}\n                <tr>\n                \n                \n                <td style=\"font-size: 14px;font-family: serif ;border:1px solid black;\">\n                    {{row.salary_component}}\n                </td>\n                <td style=\"font-size: 14px;font-family: serif ;border:1px solid black;text-align:right\">\n                    {{ \"{:,.0f}\".format(row.amount|int) }}\n                        {%set _=sum.append(row.amount)%}\n                        \n                </td>\n                \n                </tr>\n                \n                {%endif%}\n        \n        \n        \n        {%endfor%}\n        \n        {% set total = sum | sum %}\n        {% set total1 = re_ytd_sum | sum %}\n        <td style=\"font-size: 14px;font-family: serif ; border:1px solid black;\">\n                        <b>Total Amount</b>\n                    </td>\n                    <td style=\"font-size: 14px;font-family: serif ;border:1px solid black;text-align:right\">\n                        <b>{{ \"{:,.0f}\".format(total|int) }}</b>\n                    </td>\n                    \n                    \n        \n        \n         {% endif %}\n        \n        \n        \n        \n        \n    \n</table>\n\n\n\n\n<br>\n\n\n<table style=\"width:100%\" class=\"s2\">\n  <tr class=\"s2\">\n    <td class=\"s2\">Total Net Payable <b>Rs. {{ \"{:,.0f}\".format(doc.custom_net_pay_amount|int) }}</b>-{{doc.custom_in_words}}</td>\n \n    \n  </tr>\n</table>\n\n<p class=\"f6\" style=\"color:#566573\">**Total Net Payable = Gross Earnings - Total Deductions</p>\n\n\n\n\n  \n \n\n\n",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2024-09-01 19:53:20.661468",
  "module": "cn-indian-payroll",
  "name": "Salary Slip",
  "page_number": "Hide",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": ".m1\n{\n    font-size: 20px;\n    font-family: serif;\n}\n\n.m2\n{\n    font-size: 14px;\n    font-family: serif;\n    \n    \n}\n\n\n\n.f1\n{\n    font-size: 14px;\n    font-family: serif;\n}\n\n.f2\n{\n    border:none;\n    font-size: 16px;\n    font-family: serif;\n}\n\n\n\n        /*tr.row1 td {*/\n        /*    border: 1px solid black; */\n        /*}*/",
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Salary Slip",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "<!DOCTYPE html>\n<html>\n    \n                {{letter_head}}\n           \n    \n<head>\n    \n</head>\n<body>\n    \n\n\n    \n   \n\n<p class=\"m1\">TDS WORK SHEET for the month of {{ frappe.utils.format_date(doc.start_date, \"MMMM, YYYY\") }}  </p>\n\n\n\n<table class=\"f2\" style=\"width:100%;\">\n  <tr>\n    <td class=\"f2\">Employee Name</td>\n    <td class=\"f2\">Pan</td>\n    <td class=\"f2\">Designation</td>\n    <td class=\"f2\">Tax Regime</td>\n  </tr>\n  \n  \n  {% set employee = frappe.get_doc(\"Employee\", doc.employee) %}\n       {% set tax_slab1 = frappe.get_list(\"Salary Structure Assignment\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"name\", \"employee\", \"income_tax_slab\"], order_by=\"from_date desc\") %}\n                {% if tax_slab1 %}\n                   {% set employee_tax_slab = tax_slab1[0].income_tax_slab %}\n                    \n               {%endif%}\n  \n  \n  \n   <tr>\n    <td class=\"f2\">{{doc.employee_name}}</td>\n    <td class=\"f2\">{%if employee.pan_number%} {{employee.pan_number}} {%endif%}</td>\n    <td class=\"f2\">{%if employee.designation%} {{employee.designation}} {%endif%}</td>\n    <td class=\"f2\">{{employee_tax_slab}}</td>\n  </tr>\n  \n  \n  \n  \n  \n</table>\n\n\n\n\n\n<hr style=\"border-style: dotted; border-width: 1px; border-color: black;\">\n\n\n    <p style=\"font-size: 16px;font-family: serif;\">Details of salary paid and any other income tax and tax deducted</p>\n\n<table style=\"width:100%;border: 1px solid black;\" >\n  <tr class=\"row2\" style=\"border: 1px solid black;\">\n    <th class=\"m2\" style=\"border: 1px solid black;\">Particulars</th>\n    <th class=\"m2\" style=\"border: 1px solid black;\">Actual</th> \n    <th class=\"m2\" style=\"border: 1px solid black;\">Projection</th>\n    <th class=\"m2\" style=\"border: 1px solid black;\">Total</th>\n  </tr>\n  \n  \n  \n \n\n<tr>\n\n  \n  \n<td style=\"border: 1px solid black;\">\n    <b class=\"m2\">1) Gross Earnings</b></br></br>\n{% set component_dict = {} %}\n{% set array = [] %}\n\n{%if doc.custom_income_tax_slab %}\n\n{%set tax=frappe.get_doc(\"Income Tax Slab\", doc.custom_income_tax_slab)%}\n\n{%set regime=tax.custom_select_regime%}\n\n\n{%endif%}\n\n{%- for row in doc.earnings -%}\n    {%- set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n    \n    {% if row.is_tax_applicable == 1 %}\n        {% if perquisite.is_tax_applicable == 1 and perquisite.custom_perquisite == 0 and perquisite.custom_is_reimbursement == 0 and perquisite.component_type != \"LTA Taxable\" %}\n            {%- set _ = array.append({\n                \"component\": perquisite.name,\n                \"sequence\": perquisite.custom_sequence | int,\n                \"amount\": row.amount,\n                \"year_to_date\": row.year_to_date,\n                \"arrear\": perquisite.custom_is_arrear,\n                \"ytd_arrear\": row.custom_arrear_ytd,\n                \"food_coupon\": row.custom_total_ytd\n            }) %}\n        {% endif %}\n    {% else %}\n    \n    \n        {% if perquisite.is_tax_applicable == 1 and perquisite.custom_regime==\"New Regime\" and doc.custom_tax_regime==\"New Regime\"%}\n            {%- set _ = array.append({\n                \"component\": perquisite.name,\n                \"sequence\": perquisite.custom_sequence | int,\n                \"amount\": row.amount,\n                \"year_to_date\": row.year_to_date,\n                \"arrear\": perquisite.custom_is_arrear,\n                \"ytd_arrear\": row.custom_arrear_ytd,\n                \"food_coupon\": row.custom_total_ytd\n            }) %}\n        {% endif %}\n        \n    {% endif %}\n{%- endfor -%}\n\n\n{# Sort the array based on the sequence for ordered display #}\n{% set sorted_array = array | sort(attribute='sequence') %}\n\n\n\n{%- for item in sorted_array -%}\n\n    {% if item.component in component_dict %}\n            {% set component_dict = component_dict.update({item.component: component_dict[item.component] + item.year_to_date}) %}\n        {% else %}\n            {% set component_dict = component_dict.update({item.component: item.year_to_date}) %}\n        {% endif %}\n    \n    \n    \n{% endfor %}\n\n{% for component, amount in component_dict.items() %}\n    <p class=\"m2\">{{ component }}</p>\n{% endfor %}\n\n\n{%- for row in doc.earnings -%}\n    {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n\n{%if perquisite.component_type==\"LTA Taxable\"%}\n    <p class=\"m2\">{{  perquisite.name}}</p>\n    \n    {%endif%}\n\n{%- endfor -%}\n\n\n    \n{%if doc.custom_perquisite_amount>0%}\n\n<p style=\"font-size: 14px; font-family: serif;\">Loan Perquisite </p>\n{%endif%}\n\n    \n    {% set ss_slip = frappe.get_list(\"Salary Structure Assignment\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"*\"], order_by=\"from_date desc\") %}\n               \n               {% if ss_slip[0].custom__car_perquisite==1 or ss_slip[0].custom_driver_provided_by_company==1%}\n               \n               \n               \n                <p style=\"font-size: 14px; font-family: serif;\">Other Perquisite Amount </p>\n            {% endif %}\n            \n            \n    \n    \n    \n \n </br></br>\n \n <p class=\"m2\"><b>Total Income</b></p>\n\n\n</td>\n\n<td style=\"border: 1px solid black;\" >\n    \n    \n</br></br>\n\n    \n    \n       {% set component_dict = {} %}\n       \n       {%set array=[]%}\n       \n       {%if doc.custom_income_tax_slab %}\n\n{%set tax=frappe.get_doc(\"Income Tax Slab\", doc.custom_income_tax_slab)%}\n\n{%set regime=tax.custom_select_regime%}\n\n{%endif%}\n\n\n    \n{%- for row in doc.earnings -%}\n    {%- set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n    \n    {% if row.is_tax_applicable == 1 %}\n        {% if perquisite.is_tax_applicable == 1 and perquisite.custom_perquisite == 0 and perquisite.custom_is_reimbursement == 0 and perquisite.component_type != \"LTA Taxable\" %}\n            {%- set _ = array.append({\n                \"component\": perquisite.name,\n                \"sequence\": perquisite.custom_sequence | int,\n                \"amount\": row.amount,\n                \"year_to_date\": row.year_to_date,\n                \"arrear\": perquisite.custom_is_arrear,\n                \"ytd_arrear\": row.custom_arrear_ytd,\n                \"food_coupon\": row.custom_total_ytd\n            }) %}\n        {% endif %}\n    {% else %}\n        {% if perquisite.is_tax_applicable == 1 and perquisite.custom_regime==\"New Regime\"  and doc.custom_tax_regime==\"New Regime\" %}\n            {%- set _ = array.append({\n                \"component\": perquisite.name,\n                \"sequence\": perquisite.custom_sequence | int,\n                \"amount\": row.amount,\n                \"year_to_date\": row.year_to_date,\n                \"arrear\": perquisite.custom_is_arrear,\n                \"ytd_arrear\": row.custom_arrear_ytd,\n                \"food_coupon\": row.custom_total_ytd\n            }) %}\n        {% endif %}\n    {% endif %}\n{%- endfor -%}\n\n\n{# Sort the array based on the sequence for ordered display #}\n{% set sorted_array = array | sort(attribute='sequence') %}\n\n\n\n\n\n{%- for item in sorted_array -%}\n\n    {% if item.component in component_dict %}\n        {% if item.arrear == 0 %}\n            {% set component_dict = component_dict.update({item.component: component_dict[item.component] + item.year_to_date+item.ytd_arrear-item.food_coupon }) %}\n        {% else %}\n            {% set component_dict = component_dict.update({item.component: component_dict[item.component] + item.amount }) %}\n        {% endif %}\n    {% else %}\n        {% if item.arrear == 0 %}\n            {% set component_dict = component_dict.update({item.component: item.year_to_date+item.ytd_arrear-item.food_coupon}) %}\n        {% else %}\n            {% set component_dict = component_dict.update({item.component: item.amount}) %}\n        {% endif %}\n    {% endif %}\n    \n{% endfor %}\n\n{% for component, amount in component_dict.items() %}\n    <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format(amount|round|int) }}</p>\n    \n   \n{% endfor %}\n\n\n\n\n{%- for row in doc.earnings -%}\n    {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n\n{%if perquisite.component_type==\"LTA Taxable\"%}\n    <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((row.amount) |round|int) }}</p>\n    \n    {%endif%}\n\n{%- endfor -%}\n\n\n\n\n\n\n{%if doc.custom_perquisite_amount>0%}\n\n<p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((doc.custom_perquisite_amount) |round|int) }}</p>\n\n{%endif%}\n    \n    \n     {% set ss_slip = frappe.get_list(\"Salary Structure Assignment\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"*\"], order_by=\"from_date desc\") %}\n               \n               {% if ss_slip[0].custom__car_perquisite==1 or ss_slip[0].custom_driver_provided_by_company==1%}\n               \n               {%if ss_slip[0].custom__car_perquisite==1%}\n                {% set car_perquisite = ss_slip[0].custom_car_perquisite_as_per_rules |int %}\n                {%else%}\n                {% set car_perquisite = 0  %}\n                {%endif%}\n                \n                {%if ss_slip[0].custom_driver_provided_by_company==1%}\n                {% set driver_perquisite = ss_slip[0].custom_driver_perquisite_as_per_rules |int %}\n                {%else%}\n                {% set driver_perquisite = 0 %}\n                {%endif%}\n                {% set per_total = car_perquisite + driver_perquisite %}\n                \n                {% set payroll_period = frappe.get_doc(\"Payroll Period\", ss_slip[0].custom_payroll_period) %}\n                \n\n                {% set from_date = frappe.utils.getdate(ss_slip[0].from_date) %}\n                {% set end_date = frappe.utils.getdate(payroll_period.end_date) %}\n            \n                {# Calculate months between the dates #}\n                {% set months_count = (end_date.year - from_date.year) * 12 + (end_date.month - from_date.month) + 1 %}\n                \n                 \n                <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((per_total * months_count) |round|int) }}</p>\n\n            {% endif %}\n    \n   \n    \n   \n    \n\n\n    \n\n\n\n</td>\n\n<td style=\"border: 1px solid black;\"></br></br>\n\n   \n       \n       \n       \n      \n       {% set component_dict = {} %}\n    {%set array=[]%}\n    \n    {%if doc.custom_income_tax_slab %}\n\n{%set tax=frappe.get_doc(\"Income Tax Slab\", doc.custom_income_tax_slab)%}\n\n{%set regime=tax.custom_select_regime%}\n\n{%endif%}\n\n\n\n{%- for row in doc.earnings -%}\n    {%- set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n    \n    {% if row.is_tax_applicable == 1 %}\n        {% if perquisite.is_tax_applicable == 1 and perquisite.custom_perquisite == 0 and perquisite.custom_is_reimbursement == 0 and perquisite.component_type != \"LTA Taxable\" %}\n            {%- set _ = array.append({\n                \"component\": perquisite.name,\n                \"sequence\": perquisite.custom_sequence | int,\n                \"amount\": row.amount,\n                \"year_to_date\": row.year_to_date,\n                \"arrear\": perquisite.custom_is_arrear,\n                \"ytd_arrear\": row.custom_arrear_ytd,\n                \"food_coupon\": row.custom_total_ytd,\n                \"custom_amount\":row.custom_actual_amount\n            }) %}\n        {% endif %}\n    {% else %}\n        {% if perquisite.is_tax_applicable == 0 and perquisite.custom_regime==\"New Regime\"  and doc.custom_tax_regime==\"New Regime\"%}\n            {%- set _ = array.append({\n                \"component\": perquisite.name,\n                \"sequence\": perquisite.custom_sequence | int,\n                \"amount\": row.amount,\n                \"year_to_date\": row.year_to_date,\n                \"arrear\": perquisite.custom_is_arrear,\n                \"ytd_arrear\": row.custom_arrear_ytd,\n                \"food_coupon\": row.custom_total_ytd,\n                \"custom_amount\":row.custom_actual_amount\n            }) %}\n        {% endif %}\n    {% endif %}\n{%- endfor -%}\n\n\n{# Sort the array based on the sequence for ordered display #}\n{% set sorted_array = array | sort(attribute='sequence') %}\n\n{%- for item in sorted_array -%}\n\n\n\n\n\n\n\n     {% if item.component in component_dict %}\n            {% set component_dict = component_dict.update({item.component: component_dict[item.component] + item.custom_amount}) %}\n        {% else %}\n            {% set component_dict = component_dict.update({item.component: item.custom_amount}) %}\n        {% endif %}\n        \n        \n        \n        \n{% endfor %}\n\n{% for component, amount in component_dict.items() %}\n   \n      <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((amount*doc.custom_month_count)|round|int) }}</p>\n{% endfor %}\n     \n\n \n\n\n\n</td>\n<td style=\"border: 1px solid black;\"></br></br>\n\n{%set array=[]%}\n {% set component_dict = {} %}\n \n {%if doc.custom_income_tax_slab %}\n\n{%set tax=frappe.get_doc(\"Income Tax Slab\", doc.custom_income_tax_slab)%}\n\n{%set regime=tax.custom_select_regime%}\n\n{%endif%}\n    \n{%- for row in doc.earnings -%}\n    {%- set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n    \n    {% if row.is_tax_applicable == 1 %}\n        {% if perquisite.is_tax_applicable == 1 and perquisite.custom_perquisite == 0 and perquisite.custom_is_reimbursement == 0 and perquisite.component_type != \"LTA Taxable\" %}\n            {%- set _ = array.append({\n                \"component\": perquisite.name,\n                \"sequence\": perquisite.custom_sequence | int,\n                \"amount\": row.amount,\n                \"year_to_date\": row.year_to_date,\n                \"arrear\": perquisite.custom_is_arrear,\n                \"ytd_arrear\": row.custom_arrear_ytd,\n                \"food_coupon\": row.custom_total_ytd,\n                \"custom_amount\":row.custom_actual_amount\n            }) %}\n        {% endif %}\n    {% else %}\n        {% if perquisite.is_tax_applicable == 0 and perquisite.custom_regime==\"New Regime\"  and doc.custom_tax_regime==\"New Regime\" %}\n            {%- set _ = array.append({\n                \"component\": perquisite.name,\n                \"sequence\": perquisite.custom_sequence | int,\n                \"amount\": row.amount,\n                \"year_to_date\": row.year_to_date,\n                \"arrear\": perquisite.custom_is_arrear,\n                \"ytd_arrear\": row.custom_arrear_ytd,\n                \"food_coupon\": row.custom_total_ytd,\n                \"custom_amount\":row.custom_actual_amount\n            }) %}\n        {% endif %}\n    {% endif %}\n{%- endfor -%}\n\n{% set sorted_array = array | sort(attribute='sequence') %}\n\n{%set total_taxable_sum=[]%}\n\n\n\n\n{%- for item in sorted_array -%}\n\n       \n        \n        \n        \n        \n        {% if item.component in component_dict %}\n        {% if item.arrear == 0 %}\n            {% set component_dict = component_dict.update({item.component: component_dict[item.component] + (item.custom_amount *doc.custom_month_count)+ (item.year_to_date+item.ytd_arrear)-item.food_coupon }) %}\n        {% else %}\n            {% set component_dict = component_dict.update({item.component: component_dict[item.component] + item.year_to_date }) %}\n        {% endif %}\n    {% else %}\n        {% if item.arrear == 0 %}\n            {% set component_dict = component_dict.update({item.component: (item.custom_amount *doc.custom_month_count)+ (item.year_to_date+item.ytd_arrear)-item.food_coupon}) %}\n        {% else %}\n            {% set component_dict = component_dict.update({item.component: item.year_to_date}) %}\n        {% endif %}\n    {% endif %}\n        \n        \n        \n        \n        \n        \n\n{% endfor %}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n{% for component, amount in component_dict.items() %}\n   \n      <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format(amount|round|int) }}</p>\n      {% set _ = total_taxable_sum.append((amount)|round|int) %}\n      \n{% endfor %}\n\n\n{%- for row in doc.earnings -%}\n    {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n\n{%if perquisite.component_type==\"LTA Taxable\"%}\n    <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((row.amount) |round|int) }}</p>\n    {% set _ = total_taxable_sum.append((row.amount)|round|int) %}\n    \n    {%endif%}\n\n{%- endfor -%}\n\n\n\n{%if doc.custom_perquisite_amount>0%}\n\n<p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((doc.custom_perquisite_amount) |round|int) }}</p>\n {% set _ = total_taxable_sum.append((doc.custom_perquisite_amount)|round|int) %}\n\n{%endif%}\n \n\n     \n     {% set ss_slip = frappe.get_list(\"Salary Structure Assignment\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"*\"], order_by=\"from_date desc\") %}\n               \n                {% if ss_slip[0].custom__car_perquisite==1 or ss_slip[0].custom_driver_provided_by_company==1%}\n               \n               {%if ss_slip[0].custom__car_perquisite==1%}\n                {% set car_perquisite = ss_slip[0].custom_car_perquisite_as_per_rules |round  %}\n                {%else%}\n                {% set car_perquisite = 0  %}\n                {%endif%}\n                \n                {%if ss_slip[0].custom_driver_provided_by_company==1%}\n                {% set driver_perquisite = ss_slip[0].custom_driver_perquisite_as_per_rules|round  %}\n                {%else%}\n                {% set driver_perquisite = 0 %}\n                {%endif%}\n                {% set per_total = car_perquisite + driver_perquisite %}\n                \n                {% set payroll_period = frappe.get_doc(\"Payroll Period\", ss_slip[0].custom_payroll_period) %}\n                \n\n                {% set from_date = frappe.utils.getdate(ss_slip[0].from_date) %}\n                {% set end_date = frappe.utils.getdate(payroll_period.end_date) %}\n            \n                {# Calculate months between the dates #}\n                {% set months_count = (end_date.year - from_date.year) * 12 + (end_date.month - from_date.month) + 1 %}\n                \n                \n                \n                \n                \n                \n                <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((per_total * months_count) |round|int) }}</p>\n                 {% set _ = total_taxable_sum.append((per_total * months_count)|round|int) %}\n                 \n    {% endif %}\n \n \n \n \n \n \n \n \n \n \n  \n  {% set total=total_taxable_sum|sum%}\n \n {% set formatted_amount = \"{:,}\".format(total|round|int) %}\n\n </br></br>\n \n \n        \n        \n     <p class=\"m2\" style=\"text-align:right\"><b>{{formatted_amount}}</b></p>\n     \n       \n\n</td>\n\n\n</tr>\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n    <b class=\"m2\">2)Allowance to the extent exempt under section 10</b></br></br>\n\n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {%if tax_exemption[0].name %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        {%if section.annual_hra_exemption>0%}\n        \n         <p class=\"m2\" >House Rent Allowance</p>\n        {%endif%}\n        \n        {% for i in section.declaration_details %}\n            \n             {% if i.exemption_category in [\"Section 10(13A)\", \"Section 10(14)\"] %}\n                <p class=\"m2\" >{{ i.exemption_sub_category }}</p>\n            {% endif %}\n        {% endfor %}\n    \n    \n    {%endif%}\n    {%endif%}\n    \n    \n    </br></br>\n    \n    <p><b class=\"m2\"> Total of Allowance to the extent exempt under section 10</b></p>\n</td>\n\n\n<td style=\"border: 1px solid black;\">\n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    {%if tax_exemption|length>0 %}\n    \n    {%if tax_exemption[0].name %}\n    </br></br>\n     {% set array1 = [] %}\n        {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n         {%if section.annual_hra_exemption>0%}\n         \n        {% set formatted_amount = \"{:,}\".format(section.annual_hra_exemption|int) %}\n        <p class=\"m2\" style=\"text-align:right\">{{ formatted_amount }}</p>\n         \n          {% set _ = array1.append(section.annual_hra_exemption) %}\n        {%endif%}\n        \n       \n        {% for i in section.declaration_details %}\n             {% if i.exemption_category in [\"Section 10(13A)\", \"Section 10(14)\"] %}\n            \n            \n            {% set formatted_amount = \"{:,}\".format(i.declared_amount |round| int) %}\n            <p class=\"m2\" style=\"text-align:right\">{{ formatted_amount }}</p>\n                 {% set _ = array1.append(i.declared_amount|round| int) %}\n            {% endif %}\n        {% endfor %}\n        \n         {% set tax_total = array1 | sum | round | int %}\n         \n         \n         \n    {%else%}\n    \n    <p class=\"m2\">.0</p>\n     {% set tax_total = 0 %}\n        \n    {% endif %}\n    \n    {%else%}\n    {% set tax_total = 0 %}\n    \n    \n{%endif%}\n\n\n\n \n\n\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    \n    \n    \n    {%if tax_total%}\n    \n    {% set formatted_amount = \"{:,}\".format(tax_total|round | int) %}\n           \n   </br></br></br></br></br></br> <p class=\"m2\"  style=\"text-align:right\"><b>{{formatted_amount}}</b></p>\n    {%else%}\n    </br></br></br></br><p class=\"m2\"  style=\"text-align:right\"><b>0</b></p>\n    {%endif%}\n</td>\n\n\n\n\n\n\n\n\n  \n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">3) Total After Exemption (1-2)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    {%if total or tax_total%}\n    \n    \n   \n    <p class=\"m2\" style=\"text-align:right\"> <b>{{ \"{:,}\".format((total - tax_total)|round|int) }}</b></p>\n\n    \n    \n    {% else %}\n    <p><b class=\"m2\"  style=\"text-align:right\">0</b></p>\n    \n    {%endif%}\n\n    \n    \n</td>\n    \n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">4) Taxable income under previous employment</b></p></br></br>\n   <p class=\"m2\">1. Income after exemption</p>\n   <p class=\"m2\">2. Less:Professional Tax</p>\n   \n   </br></br>\n   \n   <p><b class=\"m2\">Total taxable income under previous employment</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\"></br></br>\n    &nbsp;\n   <p class=\"m2\"  style=\"text-align:right\"> 0</p> \n   <p class=\"m2\"  style=\"text-align:right\"> 0</p>\n</td>\n\n<td style=\"border: 1px solid black;\"></br></br>\n    &nbsp;\n    <p class=\"m2\"  style=\"text-align:right\"> 0</p>\n    <p class=\"m2\"  style=\"text-align:right\"> 0</p>\n   \n</td>\n\n<td style=\"border: 1px solid black;\"></br></br></br></br></br></br></br></br>\n<p class=\"m2\"  style=\"text-align:right\"><b> 0</b></p>   \n</td>\n    \n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">5) Gross Total (3+4)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    \n     {%if total or tax_total%}\n     \n    <p class=\"m2\"  style=\"text-align:right\"><b >{{ \"{:,}\".format((total - tax_total)|round|int) }}</b></p>\n    \n    \n    \n    {%else%}\n    <p class=\"m2\"  style=\"text-align:right\"> 0</p>\n    \n    {%endif%}\n    \n</td>\n    \n</tr>\n\n\n\n<tr>\n    <td style=\"border: 1px solid black;\">\n        <p><b style=\"font-size: 14px;font-family: serif;\">6) Under Section 16</b></p></br>\n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    \n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 16\" %}\n                <p class=\"m2\" > {{ i.exemption_sub_category}}</p>\n            {% endif %}\n        {% endfor %}\n        \n        \n    \n    {% endif %}\n    \n    <p class=\"m2\">Standard Deduction</p>\n    \n    </br></br>\n    <p><b class=\"m2\"> Total Under Section 16</b></p>\n    \n    </td>\n    \n        <td style=\"border: 1px solid black;\"></br></br>\n        {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        {% set array2=[]%}\n        \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 16\" %}\n                <p class=\"m2\"  style=\"text-align:right\"> {{ \"{:,}\".format(i.declared_amount|round| int) }}</p>\n                \n                {% set _ = array2.append(i.declared_amount|round| int) %}\n            {% endif %}\n        {% endfor %}\n        \n        \n    {%else%}\n    \n   \n    \n    {% set form_16 = 0 %}\n        \n    {% endif %}\n    \n    {%if doc.custom_income_tax_slab%}\n    \n    \n     {% set income_tax = frappe.get_doc(\"Income Tax Slab\", doc.custom_income_tax_slab) %}\n     \n     {%if income_tax.custom_select_regime==\"New Regime\"%}\n     \n     <p class=\"m2\"  style=\"text-align:right\">75,000</p>\n     \n     {%else%}\n     \n     {%if income_tax.custom_select_regime==\"Old Regime\"%}\n     \n      <p class=\"m2\"  style=\"text-align:right\">50,000</p>\n     \n     \n     {%endif%}\n      {%endif%}\n     \n\n    \n    {%endif%}\n    \n    \n    \n    \n    {%if array2%}\n    \n    \n    \n    {%if doc.custom_income_tax_slab%}\n    \n    \n     {% set income_tax = frappe.get_doc(\"Income Tax Slab\", doc.custom_income_tax_slab) %}\n     \n     {%if income_tax.custom_select_regime==\"New Regime\"%}\n     \n     \n     {% set _ = array2.append(75000) %}\n     {%else%}\n     \n     {%if income_tax.custom_select_regime==\"Old Regime\"%}\n     \n     {% set _ = array2.append(50000) %}\n     \n     \n     {%endif%}\n      {%endif%}\n     \n\n    \n    {%endif%}\n    \n    \n    \n    \n    \n    \n    \n    \n    \n    \n    \n    \n    \n    \n     {% set form_16 = array2 | sum %}\n     \n     {%else%}\n     \n     \n     \n     {%if doc.custom_income_tax_slab%}\n    \n    \n     {% set income_tax = frappe.get_doc(\"Income Tax Slab\", doc.custom_income_tax_slab) %}\n     \n     {%if income_tax.custom_select_regime==\"New Regime\"%}\n     \n     \n      {% set form_16 =75000 %}\n     \n     \n     {%else%}\n     \n     {%if income_tax.custom_select_regime==\"Old Regime\"%}\n     \n     {% set form_16 =50000 %}\n     \n     \n     {%endif%}\n      {%endif%}\n     \n\n    \n    {%endif%}\n     \n     \n    \n     \n     \n     \n     \n               \n     \n     \n       {% endif %}\n    \n    \n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\"></br></br></br></br></br></br>\n{%if form_16%}\n       <p class=\"m2\"  style=\"text-align:right\"><b >{{ \"{:,}\".format(form_16|round| int) }} </b></p>  \n       \n{%endif%}\n</td>\n    \n\n</tr>\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">7) Income chargeble under Head Salaries (5-6)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n         {%if total or tax_total or form_16 %} \n         \n         <p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(total - tax_total - form_16|round| int) }}</b></p>\n         \n         \n         {%else%}\n         <p class=\"m2\"  style=\"text-align:right\"><b>0</b></p>\n         \n         {%endif%}\n</td>\n    \n</tr>\n\n\n\n<tr>\n     \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">8) Any Other income reported by employee</b></p>\n   </br>\n   <p class=\"f1\">Interest Paid on Home Loan</p>\n   <p class=\"f1\">Let Out Property</p></br>\n   \n   <p><b class=\"f1\">Total Income From Other Sources</b></p>\n   <p style=\"font-size: 10px;font-family: serif;\">Note: A maximum of Rs.200,000.00 is allowed as exemption\nfor housing loan interests on Self Occupied House Property\nand Let Out Property.</p>\n</td>\n\n<td style=\"border: 1px solid black;\"></br></br>\n\n {% set c_array11 = [] %}\n{% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80EE\" %}\n            <p class=\"m2\"  style=\"text-align:right\">{{ \"{:,}\".format(i.declared_amount|round| int) }}</p> \n            \n           \n            {% set _ = c_array11.append(i.declared_amount|round| int) %}\n           \n            \n            {% endif %}\n        {% endfor %}\n        \n         \n        {% set c_array11 = c_array11 | sum %}\n        \n        \n        {%else%}\n        <p class=\"m2\"  style=\"text-align:right\">0</p>\n        {% set c_array11 = 0 %}\n    {%endif%}\n \n    \n    <!--<p>value</p>-->\n    <p class=\"m2\"  style=\"text-align:right\">0</p></br>\n    \n    \n    \n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\"></br></br></br></br></br></br></br>\n\n{%if c_array11 %}\n<p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(c_array11|round| int) }}</b></p> \n\n{%else%}\n<p class=\"m2\"  style=\"text-align:right\"><b>0</b></p>\n{%endif%}\n</td>\n    \n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">9) Gross Total Income (7+8)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    {%set sum_tax=[]%}\n     {%if total or tax_total or form_16 or c_array11%} \n         \n         <p class=\"m2\" style=\"text-align:right\"><b>{{ \"{:,}\".format((total - tax_total - form_16 - c_array11) |round| int) }}</b></p>\n\n         \n         {% set t1= (total-tax_total-form_16-c_array11) |round|int%}\n \n         \n         \n          {% set _ = sum_tax.append(t1) %}\n         \n         \n         \n         \n         \n         {%else%}\n         <p class=\"m2\"  style=\"text-align:right\"><b>0</b></p>\n         \n         {%endif%}\n    \n   \n\n</td>\n    \n</tr>\n\n\n\n\n<tr>\n     <td style=\"border: 1px solid black;\">\n        \n         <p><b class=\"m2\">10) Deduction under chapter VI-A</b></p></br>\n   \n       <p class=\"f1\"><b>80C</b></p>\n       \n       {% set c_array1 = [] %}\n\n   {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80C\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\"> {{ \"{:,}\".format(i.declared_amount|round| int) }}</span>\n                \n                \n                {% set _ = c_array1.append(i.declared_amount|round| int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n        {#\n        {% set c_array11 = c_array1 | sum %}\n        #}\n        \n         {% set c_sum = c_array1 | sum %}\n         {%if c_sum>150000%}\n         \n         {%set c_array11=150000%}\n         \n         {%else%}\n         \n         {%set c_array11=c_sum%}\n         \n         {%endif%}\n         \n         \n        \n        \n       \n        \n    {% endif %}\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n            <p class=\"m2\">Qualifying</p></br>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n             \n            <p class=\"m2\">Deductible</p>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\" ><br><br><br><br><br><br>\n         \n         {%if c_array11%}\n             \n            <p class=\"m2\" style=\"text-align:right\"><b>{{ \"{:,}\".format(c_array11|round|int) }}</b></p>\n            \n            {%else%}\n             <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p>\n            {%endif%}\n             \n             \n         </td>\n    \n</tr>\n\n\n\n\n\n<tr>\n     <td style=\"border: 1px solid black;\">\n        \n         \n   \n       <p class=\"f1\"><b>80CCC</b></p>\n    \n     {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        {% set c_array2 = [] %}\n        \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80CCC\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\"> {{ \"{:,}\".format(i.declared_amount|round| int) }}</span>\n                \n                \n                {% set _ = c_array2.append(i.declared_amount|round| int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n         {% set c_array22 = c_array2 | sum %}\n       \n        \n    {% endif %}\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n            <p class=\"m2\">&nbsp;</p></br>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n             \n            <p class=\"m2\">&nbsp;</p>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\" ><br>\n          {%if c_array11%}\n             \n            <p class=\"m2\" style=\"text-align:right\"><b>{{ \"{:,}\".format(c_array22|round| int) }}</b></p>\n            \n            \n            \n            \n            {%else%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p>\n\n             {%endif%}\n             \n         </td>\n    \n</tr>\n\n\n\n<tr>\n     <td style=\"border: 1px solid black;\">\n        \n         \n   \n       <p class=\"f1\"><b>80CCD</b></p>\n    \n     {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n          {% set c_array3 = [] %}   \n          \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80CCD\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\"> {{ \"{:,}\".format(i.declared_amount|round|int) }}</span>\n                \n                {% set _ = c_array3.append(i.declared_amount|round|int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n       {% set c_array33 = c_array3 | sum %}\n        \n    {% endif %}\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n            <p class=\"m2\">&nbsp;</p></br>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n             \n            <p class=\"m2\">&nbsp;</p>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\" ><br>\n         \n         {%if c_array33%}\n             \n            <p class=\"m2\">{{ \"{:,}\".format(i.c_array33|round|int) }}</p>\n            {%else%}\n                        <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p>\n\n            {%endif%}\n             \n             \n         </td>\n    \n</tr>\n\n\n\n<tr>\n    <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>Total (80C+80CCC+80CCD)</b> </p>\n     </td>\n      <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>&nbsp;</b> </p>\n     </td>\n      <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>&nbsp;</b> </p>\n     </td>\n      <td style=\"border: 1px solid black;\">\n          {%if c_array11 or c_array22 or c_array33%}\n     <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">{{ \"{:,}\".format((c_array11 + c_array22 + c_array33)|round|int) }}</p></b> </p>\n     \n     {%else%}\n          <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p></b> </p>\n\n     {%endif%}\n     \n     </td>\n</tr>\n\n\n\n\n\n<tr>\n    <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>80CCD(1B)</b></p>\n    \n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n          {% set c_array4 = [] %}   \n          \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80CCD(1B)\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\">  {{ \"{:,}\".format(i.declared_amount|round|int) }}</span>\n                \n                {% set _ = c_array4.append(i.declared_amount|round|int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n       {% set c_array44 = c_array4 | sum %}\n        \n    {% endif %}\n    </td>\n    <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">\n            \n            {%if c_array44%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">{{ \"{:,}\".format(c_array44|round|int) }}</p></b> </p>\n            \n            {%else%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p></b> </p>\n\n            {%endif%}\n        </td>\n     \n</tr>\n\n\n\n\n\n\n<tr>\n    <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>80CCD(2)</b></p>\n    \n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n          {% set c_array5 = [] %}   \n          \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80CCD(2)\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\"> {{ \"{:,}\".format(i.declared_amount|round|int) }}</span>\n                {% set _ = c_array5.append(i.declared_amount|round|int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n       {% set c_array55 = c_array5 | sum %}\n        \n    {% endif %}\n    </td>\n    <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">\n            {%if c_array55%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">{{ \"{:,}\".format(c_array55|round|int) }}</p></b> </p>\n            {%else%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p></b> </p>\n\n            {%endif%}\n        </td>\n     \n</tr>\n\n\n\n\n\n<tr>\n    <td>\n    <p class=\"f1\"><b>80D</b></p>\n    \n   \n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n          {% set c_array6 = [] %}   \n          \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80D\" %}\n            \n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp;\n                <span style=\"float: right;\">  {{ \"{:,}\".format(i.declared_amount|round|int) }}</span>\n                {% set _ = c_array6.append(i.declared_amount|round|int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n        \n     \n        \n       {% set c_array66 = c_array6 | sum %}\n        \n    {% endif %}\n    </td>\n    <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">\n            \n            {%if c_array66 %}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">{{ \"{:,}\".format(c_array66|round|int) }}</p></b> </p>\n            {%else%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p></b> </p>\n\n            {%endif%}\n        </td>\n     \n</tr>\n\n\n<tr>\n    \n     <td style=\"border: 1px solid black;\">\n         <p class=\"f1\"><b>Total of Deductions under Chapter VI-A</b></p>\n\n     </td>\n     <td style=\"border: 1px solid black;\">\n         &nbsp;\n         \n     </td>\n     <td style=\"border: 1px solid black;\">&nbsp;\n         \n     </td>\n     <td style=\"border: 1px solid black;\">\n         \n          {%if c_array66 or c_array55 or c_array44 or c_array11 or c_array22 or c_array33 %}\n         \n         <p class=\"f1\" style=\"text-align:right\"><b>{{ \"{:,}\".format((c_array66+c_array55+c_array44+c_array11 + c_array22 + c_array33)|round|int) }}</b></p>\n         \n         {% set _ = sum_tax.append(c_array66+c_array55+c_array44+c_array11 + c_array22 + c_array33|round|int) %}\n         \n         \n         \n         {%else%}\n         {% set _ = sum_tax.append(0) %}\n         <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p></b> </p>\n     {%endif%}\n     </td>\n    \n</tr>\n\n\n\n<tr>\n\n <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">11) Total Taxble Value  (9-10)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    \n   \n    \n    \n    \n    \n    <p class=\"f1\"  style=\"text-align:right\"><b>{{ \"{:,}\".format((sum_tax[0]-sum_tax[1])|round|int) }}</b></p>\n    \n    \n    \n       \n    \n    \n   \n    \n      \n      \n      \n    \n    </td>\n        \n  </tr> \n  \n  \n  \n    <tr>\n      <td style=\"border: 1px solid black;\">\n          \n          <p><b class=\"m2\"> 12) Tax Calculation</b></p>\n          \n          {%if doc.custom_tax_slab|length>0%}\n          \n          \n          <table style=\"border:1px solid black;width:100%\">\n              <tr>\n                  <td style=\"width:70%;border:1px solid black\">\n                       <p class=\"f1\"><b> Taxable Income Range</b></p>\n                     \n                  </td>\n                  \n                  <td style=\"width:30%;border:1px solid black\">\n                     <p class=\"f1\"><b>  Tax Amount</b></p>\n                  </td>\n                  \n                  \n              </tr>\n              \n              {%for i in doc.custom_tax_slab%}\n              <tr>\n                  <td style=\"border:1px solid black\">\n                      {%if i.to_amount>0%}\n                       <p class=\"f1\"  >{{i.from_amount|round}}-{{i.to_amount|round}}<br>(Tax: of {{i.percentage}}% of {{i.amount|round}})</p>\n                  \n                        {%else%}\n                        {%if i.to_amount==0%}\n                        <p class=\"f1\"  >{{i.from_amount|round}} And Above<br>(Tax: of {{i.percentage}}% of {{i.amount|round}})</p>\n\n                        {%endif%}\n                        \n                {%endif%}\n\n                  \n                  </td>\n                  \n                  <td style=\"border:1px solid black\">\n                       <p class=\"f1\" style=\"text-align:right\" >{{i.tax_amount|round}}</p>\n                  </td>\n              </tr>\n              {%endfor%}\n          </table>\n          <br>\n          \n\n        {%endif%}\n         \n      </td>\n      <td style=\"border: 1px solid black;\">\n          \n      </td>\n      <td style=\"border: 1px solid black;\">\n          \n      </td>\n      <td style=\"border: 1px solid black;\">\n          \n          \n          \n      </td>\n  </tr>\n  \n  \n  \n  \n   \n  <tr>\n    \n    <td style=\"border: 1px solid black;\">\n        \n        {%if doc.custom_income_tax_slab==\"Old Regime\"%}\n    \n           <p class=\"f1\"><b>Tax on total Income</b></p>\n                  <p class=\"f1\"><b>Less : Rebate Under Section 87A</b></p>\n                  <p style=\"font-size:10px\">Note: If taxable income is less than Rs.500,000.00, tax rebate\n        of a maximum of Rs.12,500.00 is provided under Section 87A.</p></b></p>\n        \n        {%else%}\n        \n         <p class=\"f1\"><b>Tax on total Income</b></p>\n                  <p class=\"f1\"><b>Less : Rebate Under Section 87B</b></p>\n                  <p style=\"font-size:10px\">Note: If taxable income is less than Rs.700,000.00, tax rebate\n        of a maximum of Rs.25,000.00 is provided under Section 87A.</p></b></p>\n        \n        {%endif%}\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n\n        <p class=\"f1\" style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.custom_tax_on_total_income|round|int) }}</b></p>\n          <p class=\"f1\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.custom_rebate_under_section_87a|round|int) }}</b></p>\n          \n          \n          \n   \n\n</td>\n    \n    \n</tr>\n  \n  \n  \n  \n  \n  \n \n             \n  \n\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">13) Total Tax on Income</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n   \n         <p class=\"m2\"   style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.custom_total_tax_on_income|round|int) }}</b></p>\n         \n         \n        \n</td>\n    \n    \n</tr>\n\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n  \n   \n   \n   \n   \n                    <p class=\"m2\"><b>Surcharge</b></p>\n                    <p class=\"m2\"><b>Education Cess</b></p>\n                    <p class=\"m2\"><b>Less: Relief Under Section 89</b></p>\n                    \n\n \n   \n    </td>\n    \n    <td style=\"border: 1px solid black;\">\n       \n        &nbsp;\n    </td>\n    \n    <td style=\"border: 1px solid black;\">\n       \n        &nbsp;\n    </td>\n    <td style=\"border: 1px solid black;\">\n        \n      <p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.custom_surcharge|round|int) }}</b></p>\n             <p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.custom_education_cess|round|int) }}</b></p>\n             <p class=\"m2\"  style=\"text-align:right\"><b>0</b></p>\n            \n       </td>\n        \n       \n     \n    \n    \n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">14) Tax Payable including Education cess minus of relief under section 89</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    \n        \n              \n         <p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format((doc.custom_total_tax_on_income + doc.custom_surcharge + doc.custom_education_cess)|round|int) }}</b></p>\n         \n\n             \n           \n    \n</td>\n    \n    \n</tr>\n\n\n\n<tr>\n\n <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">15) Tax Deducted at source u/s 192</b></p>\n   </br> \n   <p class=\"m2\">* TDS till last month</p>\n   <p class=\"m2\">* TDS of the month</p>\n   <p class=\"m2\">* TDS by Previous Employer</p></br>\n   <p class=\"m2\">Total Tax Deducted at source</p></br>\n   <p class=\"m2\">Tax Payable / Refundable (14 - 15(A))</p>\n   <p class=\"m2\">TDS per month for the next {{doc.custom_month_count}} months</p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n   {% set tax_exemption = frappe.get_list(\n        \"Salary Slip\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"custom_payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"*\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    \n    \n    {%set tds_sum=[]%}\n    {%for j in tax_exemption %}\n    {%if j.name!=doc.name%}\n    \n    {%set _ = tds_sum.append(j.current_month_income_tax)%}\n    \n   \n    \n    \n    \n    \n    \n    \n    \n    {%endif%}\n    \n    {%endfor%}\n    \n    {%endif%}\n    \n    \n    \n    {%set j1=tds_sum|sum%}\n    \n    </br>    </br>\n   \n   <p class=\"m2\"  style=\"text-align:right\">{{j1|round|int}}</p>\n   \n   \n     \n{%if doc.current_month_income_tax > 0%}\n{%set month_tds=doc.custom_total_amount/12%}\n<p class=\"m2\"  style=\"text-align:right\">{{ \"{:,}\".format(doc.current_month_income_tax|round|int) }}</p>\n{%else%}\n<p class=\"m2\"  style=\"text-align:right\">0</p>\n{%endif%}\n\n\n\n        <p class=\"m2\"  style=\"text-align:right\">0</p></br>\n\n\n\n\n\n\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\"></br>    </br></br>    </br></br>    </br></br>\n{%if doc.current_month_income_tax > 0%}\n    <p class=\"m2\"  style=\"text-align:right\"><b>{{(doc.current_month_income_tax+j1)|round|int}}</b></p>\n    \n    {%else%}\n<p class=\"m2\"  style=\"text-align:right\">0</p>\n{%endif%}\n \n {%set j2=doc.current_month_income_tax+j1%}\n {%set j3=doc.custom_total_tax_on_income + doc.custom_surcharge + doc.custom_education_cess%}\n {%set final=j3-j2%}\n <br>\n <p class=\"m2\"  style=\"text-align:right\"><b>{{(final)|round|int}}</b></p>\n \n <p class=\"m2\"  style=\"text-align:right\"><b>{{(final/doc.custom_month_count)|round|int}}</b></p>\n\n \n {#\n <p class=\"m2\"  style=\"text-align:right\"><b>{{(doc.current_month_income_tax|round|int)}}</b></p>\n #}\n</td>\n    \n\n</tr>\n\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n        <p class=\"m2\"><b>TDS for {{doc.custom_month}}</b></p>\n   </td>\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    {%if doc.current_month_income_tax > 0%}\n    \n    <p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.current_month_income_tax|round|int) }}</b></p>\n    {%else%}\n<p class=\"m2\"  style=\"text-align:right\">0</p>\n{%endif%}\n</td>\n    \n    \n</tr>\n\n\n\n\n\n\n\n\n\n\n\n\n\n</table>\n\n\n<br>\n<table style=\"width:100%;border:1px solid black\">\n    \n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%set sum_array=[]%}\n    {%if tax_exemption|length>0 %}\n        {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        \n        {% if section.hra_breakup| length > 0 %}\n    \n    \n    <tr>\n        <td class=\"m2\" style=\"border:1px solid black\">Month</td>\n        <td class=\"m2\" style=\"border:1px solid black\">Rent Paid</td>\n        <td class=\"m2\" style=\"border:1px solid black\">% of Earned Basic(Metro 50%, Non-Metro 40%)</td>\n        <td class=\"m2\" style=\"border:1px solid black\">HRA Received</td>\n        <td class=\"m2\" style=\"border:1px solid black\">Excess of Rent Paid Over 10% of Basic</td>\n        <td class=\"m2\" style=\"border:1px solid black\">Exemption Amount</td>\n    </tr>\n    \n    {% endif %}\n    {% endif %}\n    \n    \n    \n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%set sum_array=[]%}\n    {%if tax_exemption|length>0 %}\n        {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        \n        {% if section.hra_breakup| length > 0 %}\n            {% for i in section.hra_breakup %}\n                <tr>\n                   <td class=\"m2\" style=\"border:1px solid black\">{{ i.month}}</td>\n                    <td class=\"m2\" style=\"border:1px solid black\">{{ i.rent_paid|int }}</td>\n                    <td class=\"m2\" style=\"border:1px solid black\">{{ i.earned_basic|int }}</td>\n                    {% set _ = sum_array.append(i.earned_basic | int) %}\n                    \n                    <td class=\"m2\" style=\"border:1px solid black\">{{ i.hra_received|int }}</td>\n                    <td class=\"m2\" style=\"border:1px solid black\">{{ i.excess_of_rent_paid|int }}</td>\n                    <td class=\"m2\" style=\"border:1px solid black\">{{ i.exemption_amount|int }}</td>\n                    \n                    \n                </tr>\n           \n     {% endfor %}\n    {% set b = sum_array | sum %}\n    \n    \n    <tr>\n        <td class=\"m2\" style=\"border:1px solid black\"><b>Total</b></td>\n        <td class=\"m2\" style=\"border:1px solid black\"><b>{{((section.monthly_house_rent*12)|round|int)}}</b></td>\n        \n        <td class=\"m2\" style=\"border:1px solid black\"><b>{{b}}</b></td>\n        <td class=\"m2\" style=\"border:1px solid black\"><b>{{section.hra_as_per_salary_structure|round|int}}</b></td>\n        <td class=\"m2\" style=\"border:1px solid black\"><b>{{section.annual_hra_exemption|round|int}}</b></td>\n        <td class=\"m2\" style=\"border:1px solid black\"><b>{{section.annual_hra_exemption|round|int}}</b></td>\n        \n    </tr>\n</table><br>\n\n\n        {% endif %}\n    {% endif %}\n    \n    \n {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%set sum_array=[]%}\n    {%if tax_exemption|length>0 %}\n        {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        \n        {% if section.hra_breakup| length > 0 %}   \n    \n<table style=\"border:1px solid black;width:100%\">\n    <tr>\n        <td class=\"m2\" >\n            Total House Rent Allowance Exemption Amount\nLeast amount of the three columns (% of Earned Basic, HRA Received and Excess of Rent Paid\nOver 10% of Basic) will be considered for tax exemption under HRA\n        </td>\n        <td class=\"m2\" >\n            <b>{{section.annual_hra_exemption|round|int}}</b>\n        </td>\n    </tr>\n</table>\n    {% endif %}\n    {% endif %}\n\n</body>\n</html>\n",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2024-12-02 11:48:49.985028",
  "module": "cn-indian-payroll",
  "name": "TDS (WorkSheet)",
  "page_number": "Hide",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": ".m1\n{\n    font-size: 20px;\n    font-family: serif;\n}\n\n.m2\n{\n    font-size: 14px;\n    font-family: serif;\n    \n    \n}\n\n\n\n.f1\n{\n    font-size: 14px;\n    font-family: serif;\n}\n\n.f2\n{\n    border:none;\n    font-size: 16px;\n    font-family: serif;\n}\n\n\n\n        /*tr.row1 td {*/\n        /*    border: 1px solid black; */\n        /*}*/",
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Salary Slip",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "<!DOCTYPE html>\n<html>\n    \n                {{letter_head}}\n           \n    \n<head>\n    \n</head>\n<body>\n    \n\n\n    \n   \n\n<p class=\"m1\">TDS WORK SHEET for the month of {{ frappe.utils.format_date(doc.start_date, \"MMMM, YYYY\") }}  </p>\n\n\n\n<table class=\"f2\" style=\"width:100%;\">\n  <tr>\n    <td class=\"f2\">Employee Name</td>\n    <td class=\"f2\">Pan</td>\n    <td class=\"f2\">Designation</td>\n    <td class=\"f2\">Tax Regime</td>\n  </tr>\n  \n  \n  {% set employee = frappe.get_doc(\"Employee\", doc.employee) %}\n       {% set tax_slab1 = frappe.get_list(\"Salary Structure Assignment\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"name\", \"employee\", \"income_tax_slab\"], order_by=\"from_date desc\") %}\n                {% if tax_slab1 %}\n                   {% set employee_tax_slab = tax_slab1[0].income_tax_slab %}\n                    \n               {%endif%}\n  \n  \n  \n   <tr>\n    <td class=\"f2\">{{doc.employee_name}}</td>\n    <td class=\"f2\">{%if employee.pan_number%} {{employee.pan_number}} {%endif%}</td>\n    <td class=\"f2\">{%if employee.designation%} {{employee.designation}} {%endif%}</td>\n    <td class=\"f2\">{{employee_tax_slab}}</td>\n  </tr>\n  \n  \n  \n  \n  \n</table>\n\n\n\n\n\n<hr style=\"border-style: dotted; border-width: 1px; border-color: black;\">\n\n\n    <p style=\"font-size: 16px;font-family: serif;\">Details of salary paid and any other income tax and tax deducted</p>\n\n<table style=\"width:100%;border: 1px solid black;\" >\n  <tr class=\"row2\" style=\"border: 1px solid black;\">\n    <th class=\"m2\" style=\"border: 1px solid black;\">Particulars</th>\n    <th class=\"m2\" style=\"border: 1px solid black;\">Actual</th> \n    <th class=\"m2\" style=\"border: 1px solid black;\">Projection</th>\n    <th class=\"m2\" style=\"border: 1px solid black;\">Total</th>\n  </tr>\n  \n  \n  \n \n\n<tr>\n\n  \n  \n<td style=\"border: 1px solid black;\">\n    <b class=\"m2\">1) Gross Earnings</b></br></br>\n{% set component_dict = {} %}\n    \n{%- for row in doc.earnings -%}\n    {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n    \n    {% if perquisite.is_tax_applicable == 1 and perquisite.custom_perquisite == 0 and perquisite.custom_is_reimbursement == 0 %}\n        {# Summing the values for duplicate keys #}\n        \n        {% if row.salary_component in component_dict %}\n            {% set component_dict = component_dict.update({row.salary_component: component_dict[row.salary_component] + row.amount}) %}\n        {% else %}\n            {% set component_dict = component_dict.update({row.salary_component: row.amount}) %}\n        {% endif %}\n    {% endif %}\n{%- endfor -%}\n\n{# Display the merged components and their values #}\n{% for component, amount in component_dict.items() %}\n    <p class=\"m2\">{{ component }}</p>\n{% endfor %}\n\n    \n{%if doc.custom_perquisite_amount>0%}\n<p style=\"font-size: 14px; font-family: serif;\">Loan Perquisite </p>\n\n{%endif%}\n    \n    {% set ss_slip = frappe.get_list(\"Salary Structure Assignment\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"*\"], order_by=\"from_date desc\") %}\n               \n               {% if ss_slip[0].custom__car_perquisite==1 or ss_slip[0].custom_driver_provided_by_company==1%}\n               \n               \n               \n                <p style=\"font-size: 14px; font-family: serif;\">Total Perquisite Amount </p>\n            {% endif %}\n            \n            \n    \n    \n    \n \n </br></br>\n \n <p class=\"m2\"><b>Total Income</b></p>\n\n\n</td>\n\n<td style=\"border: 1px solid black;\" >\n    \n    \n</br></br>\n\n    \n    \n       {% set component_dict = {} %}\n    \n{%- for row in doc.earnings -%}\n    {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n    \n    {% if perquisite.is_tax_applicable == 1 and perquisite.custom_perquisite == 0 and perquisite.custom_is_reimbursement == 0 %}\n        {# Summing the values for duplicate keys #}\n        \n        {% if row.salary_component in component_dict %}\n            {% set component_dict = component_dict.update({row.salary_component: component_dict[row.salary_component] + row.year_to_date}) %}\n        {% else %}\n            {% set component_dict = component_dict.update({row.salary_component: row.year_to_date}) %}\n        {% endif %}\n    {% endif %}\n{%- endfor -%}\n\n{# Display the merged components and their values #}\n{% for component, amount in component_dict.items() %}\n   \n      <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format(amount|round|int) }}</p>\n{% endfor %}\n\n\n{%if doc.custom_perquisite_amount>0%}\n\n<p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((doc.custom_perquisite_amount) |round|int) }}</p>\n\n{%endif%}\n    \n    \n     {% set ss_slip = frappe.get_list(\"Salary Structure Assignment\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"*\"], order_by=\"from_date desc\") %}\n               \n               {% if ss_slip[0].custom__car_perquisite==1 or ss_slip[0].custom_driver_provided_by_company==1%}\n               \n               {%if ss_slip[0].custom__car_perquisite==1%}\n                {% set car_perquisite = ss_slip[0].custom_car_perquisite_as_per_rules |int %}\n                {%else%}\n                {% set car_perquisite = 0  %}\n                {%endif%}\n                \n                {%if ss_slip[0].custom_driver_provided_by_company==1%}\n                {% set driver_perquisite = ss_slip[0].custom_driver_perquisite_as_per_rules |int %}\n                {%else%}\n                {% set driver_perquisite = 0 %}\n                {%endif%}\n                {% set per_total = car_perquisite + driver_perquisite %}\n                 \n                <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((per_total * 12) |round|int) }}</p>\n\n            {% endif %}\n    \n   \n    \n   \n    \n\n\n    \n\n\n\n</td>\n\n<td style=\"border: 1px solid black;\"></br></br>\n\n   \n       \n       \n       \n       \n       {% set component_dict = {} %}\n    \n{%- for row in doc.earnings -%}\n    {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n    \n    {% if perquisite.is_tax_applicable == 1 and perquisite.custom_perquisite == 0 and perquisite.custom_is_reimbursement == 0 %}\n        {# Summing the values for duplicate keys #}\n        \n        {% if row.salary_component in component_dict %}\n            {% set component_dict = component_dict.update({row.salary_component: component_dict[row.salary_component] + row.custom_actual_amount}) %}\n        {% else %}\n            {% set component_dict = component_dict.update({row.salary_component: row.custom_actual_amount}) %}\n        {% endif %}\n    {% endif %}\n{%- endfor -%}\n\n{# Display the merged components and their values #}\n{% for component, amount in component_dict.items() %}\n   \n      <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((amount*doc.custom_month_count)|round|int) }}</p>\n{% endfor %}\n     \n     \n\n \n\n\n\n</td>\n<td style=\"border: 1px solid black;\"></br></br>\n\n{%set array=[]%}\n {% set component_dict = {} %}\n    \n{%- for row in doc.earnings -%}\n    {% set perquisite = frappe.get_doc(\"Salary Component\", row.salary_component) %}\n    \n    {% if perquisite.is_tax_applicable == 1 and perquisite.custom_perquisite == 0 and perquisite.custom_is_reimbursement == 0 %}\n        {# Summing the values for duplicate keys #}\n        \n        {% if row.salary_component in component_dict %}\n            {% set component_dict = component_dict.update({row.salary_component: component_dict[row.salary_component] + (row.custom_actual_amount *doc.custom_month_count)+ row.year_to_date}) %}\n        {% else %}\n            {% set component_dict = component_dict.update({row.salary_component: (row.custom_actual_amount *doc.custom_month_count)+ row.year_to_date}) %}\n        {% endif %}\n    {% endif %}\n{%- endfor -%}\n\n{% for component, amount in component_dict.items() %}\n   \n      <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format(amount|round|int) }}</p>\n      {% set _ = array.append((amount)|round|int) %}\n      \n{% endfor %}\n\n{%if doc.custom_perquisite_amount>0%}\n\n<p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((doc.custom_perquisite_amount) |round|int) }}</p>\n{% set _ = array.append((doc.custom_perquisite_amount)|round|int) %}\n\n{%endif%}\n \n\n     \n     {% set ss_slip = frappe.get_list(\"Salary Structure Assignment\", filters={\"docstatus\": 1, \"employee\": doc.employee}, fields=[\"*\"], order_by=\"from_date desc\") %}\n               \n                {% if ss_slip[0].custom__car_perquisite==1 or ss_slip[0].custom_driver_provided_by_company==1%}\n               \n               {%if ss_slip[0].custom__car_perquisite==1%}\n                {% set car_perquisite = ss_slip[0].custom_car_perquisite_as_per_rules |round  %}\n                {%else%}\n                {% set car_perquisite = 0  %}\n                {%endif%}\n                \n                {%if ss_slip[0].custom_driver_provided_by_company==1%}\n                {% set driver_perquisite = ss_slip[0].custom_driver_perquisite_as_per_rules|round  %}\n                {%else%}\n                {% set driver_perquisite = 0 %}\n                {%endif%}\n                {% set per_total = car_perquisite + driver_perquisite %}\n                <p class=\"m2\" style=\"text-align:right\"> {{ \"{:,}\".format((per_total * 12) |round|int) }}</p>\n                 {% set _ = array.append((per_total*12)|round|int) %}\n    {% endif %}\n \n \n \n \n \n \n \n \n \n \n  {% set total=array|sum%}\n  \n  \n \n {% set formatted_amount = \"{:,}\".format(total|round|int) %}\n\n </br></br>\n \n \n        \n        \n     <p class=\"m2\" style=\"text-align:right\"><b>{{formatted_amount}}</b></p>\n     \n       \n\n</td>\n\n\n</tr>\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n    <b class=\"m2\">2)Allowance to the extent exempt under section 10</b></br></br>\n\n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {%if tax_exemption[0].name %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        {%if section.monthly_house_rent>0%}\n        \n         <p class=\"m2\" >House Rent Allowance</p>\n        {%endif%}\n        \n        {% for i in section.declaration_details %}\n            \n             {% if i.exemption_category in [\"Section 10(13A)\", \"Section 10(14)\"] %}\n                <p class=\"m2\" >{{ i.exemption_sub_category }}</p>\n            {% endif %}\n        {% endfor %}\n    \n    \n    {%endif%}\n    {%endif%}\n    \n    \n    </br></br>\n    \n    <p><b class=\"m2\"> Total of Allowance to the extent exempt under section 10</b></p>\n</td>\n\n\n<td style=\"border: 1px solid black;\">\n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    {%if tax_exemption|length>0 %}\n    \n    {%if tax_exemption[0].name %}\n    </br></br>\n     {% set array1 = [] %}\n        {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n         {%if section.monthly_house_rent>0%}\n         \n        {% set formatted_amount = \"{:,}\".format(section.annual_hra_exemption|int) %}\n        <p class=\"m2\" style=\"text-align:right\">{{ formatted_amount }}</p>\n         \n          {% set _ = array1.append(section.annual_hra_exemption) %}\n        {%endif%}\n        \n       \n        {% for i in section.declaration_details %}\n             {% if i.exemption_category in [\"Section 10(13A)\", \"Section 10(14)\"] %}\n            \n            \n            {% set formatted_amount = \"{:,}\".format(i.declared_amount |round| int) %}\n            <p class=\"m2\" style=\"text-align:right\">{{ formatted_amount }}</p>\n                 {% set _ = array1.append(i.declared_amount|round| int) %}\n            {% endif %}\n        {% endfor %}\n        \n         {% set tax_total = array1 | sum | round | int %}\n         \n         \n         \n    {%else%}\n    \n    <p class=\"m2\">.0</p>\n     {% set tax_total = 0 %}\n        \n    {% endif %}\n    \n    {%else%}\n    {% set tax_total = 0 %}\n    \n    \n{%endif%}\n\n\n\n \n\n\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    \n    \n    \n    {%if tax_total%}\n    \n    {% set formatted_amount = \"{:,}\".format(tax_total|round | int) %}\n           \n   </br></br></br></br></br></br> <p class=\"m2\"  style=\"text-align:right\"><b>{{formatted_amount}}</b></p>\n    {%else%}\n    </br></br></br></br><p class=\"m2\"  style=\"text-align:right\"><b>0</b></p>\n    {%endif%}\n</td>\n\n\n\n\n\n\n\n\n  \n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">3) Total After Exemption (1-2)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    {%if total or tax_total%}\n    \n    \n   \n    <p class=\"m2\" style=\"text-align:right\"> <b>{{ \"{:,}\".format((total - tax_total)|round|int) }}</b></p>\n\n    \n    \n    {% else %}\n    <p><b class=\"m2\"  style=\"text-align:right\">0</b></p>\n    \n    {%endif%}\n\n    \n    \n</td>\n    \n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">4) Taxable income under previous employment</b></p></br></br>\n   <p class=\"m2\">1. Income after exemption</p>\n   <p class=\"m2\">2. Less:Professional Tax</p>\n   \n   </br></br>\n   \n   <p><b class=\"m2\">Total taxable income under previous employment</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\"></br></br>\n    &nbsp;\n   <p class=\"m2\"  style=\"text-align:right\"> 0</p> \n   <p class=\"m2\"  style=\"text-align:right\"> 0</p>\n</td>\n\n<td style=\"border: 1px solid black;\"></br></br>\n    &nbsp;\n    <p class=\"m2\"  style=\"text-align:right\"> 0</p>\n    <p class=\"m2\"  style=\"text-align:right\"> 0</p>\n   \n</td>\n\n<td style=\"border: 1px solid black;\"></br></br></br></br></br></br></br></br>\n<p class=\"m2\"  style=\"text-align:right\"><b> 0</b></p>   \n</td>\n    \n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">5) Gross Total (3+4)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    \n     {%if total or tax_total%}\n     \n    <p class=\"m2\"  style=\"text-align:right\"><b >{{ \"{:,}\".format((total - tax_total)|round|int) }}</b></p>\n    \n    \n    \n    {%else%}\n    <p class=\"m2\"  style=\"text-align:right\"> 0</p>\n    \n    {%endif%}\n    \n</td>\n    \n</tr>\n\n\n\n<tr>\n    <td style=\"border: 1px solid black;\">\n        <p><b style=\"font-size: 14px;font-family: serif;\">6) Under Section 16</b></p></br>\n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    \n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 16\" %}\n                <p class=\"m2\" > {{ i.exemption_sub_category}}</p>\n            {% endif %}\n        {% endfor %}\n        \n        \n    \n    {% endif %}\n    \n    <p class=\"m2\">Standard Deduction</p>\n    \n    </br></br>\n    <p><b class=\"m2\"> Total Under Section 16</b></p>\n    \n    </td>\n    \n    <td style=\"border: 1px solid black;\"></br></br>\n        {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        {% set array2=[]%}\n        \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 16\" %}\n                <p class=\"m2\"  style=\"text-align:right\"> {{ \"{:,}\".format(i.declared_amount|round| int) }}</p>\n                \n                {% set _ = array2.append(i.declared_amount|round| int) %}\n            {% endif %}\n        {% endfor %}\n        \n        \n    {%else%}\n    \n   \n    \n    {% set form_16 = 0 %}\n        \n    {% endif %}\n    \n    {%if doc.custom_income_tax_slab%}\n    \n    \n     {% set income_tax = frappe.get_doc(\"Income Tax Slab\", doc.custom_income_tax_slab) %}\n     \n     {%if income_tax.custom_select_regime==\"New Regime\"%}\n     \n     <p class=\"m2\"  style=\"text-align:right\">75,000</p>\n     \n     {%else%}\n     \n     {%if income_tax.custom_select_regime==\"Old Regime\"%}\n     \n      <p class=\"m2\"  style=\"text-align:right\">50,000</p>\n     \n     \n     {%endif%}\n      {%endif%}\n     \n\n    \n    {%endif%}\n    \n    \n    \n    \n    {%if array2%}\n    \n    \n    \n    {%if doc.custom_income_tax_slab%}\n    \n    \n     {% set income_tax = frappe.get_doc(\"Income Tax Slab\", doc.custom_income_tax_slab) %}\n     \n     {%if income_tax.custom_select_regime==\"New Regime\"%}\n     \n     \n     {% set _ = array2.append(75000) %}\n     {%else%}\n     \n     {%if income_tax.custom_select_regime==\"Old Regime\"%}\n     \n     {% set _ = array2.append(50000) %}\n     \n     \n     {%endif%}\n      {%endif%}\n     \n\n    \n    {%endif%}\n    \n    \n    \n    \n    \n    \n    \n    \n    \n    \n    \n    \n    \n    \n     {% set form_16 = array2 | sum %}\n     \n     {%else%}\n     \n     \n     \n     {%if doc.custom_income_tax_slab%}\n    \n    \n     {% set income_tax = frappe.get_doc(\"Income Tax Slab\", doc.custom_income_tax_slab) %}\n     \n     {%if income_tax.custom_select_regime==\"New Regime\"%}\n     \n     \n      {% set form_16 =75000 %}\n     \n     \n     {%else%}\n     \n     {%if income_tax.custom_select_regime==\"Old Regime\"%}\n     \n     {% set form_16 =50000 %}\n     \n     \n     {%endif%}\n      {%endif%}\n     \n\n    \n    {%endif%}\n     \n     \n    \n     \n     \n     \n     \n               \n     \n     \n       {% endif %}\n    \n    \n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\"></br></br></br></br></br></br>\n{%if form_16%}\n       <p class=\"m2\"  style=\"text-align:right\"><b >{{ \"{:,}\".format(form_16|round| int) }} </b></p>  \n       \n{%endif%}\n</td>\n    \n\n</tr>\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">7) Income chargeble under Head Salaries (5-6)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n         {%if total or tax_total or form_16 %} \n         \n         <p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(total - tax_total - form_16|round| int) }}</b></p>\n         \n         \n         {%else%}\n         <p class=\"m2\"  style=\"text-align:right\"><b>0</b></p>\n         \n         {%endif%}\n</td>\n    \n</tr>\n\n\n\n<tr>\n     \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">8) Any Other income reported by employee</b></p>\n   </br>\n   <p class=\"f1\">Interest Paid on Home Loan</p>\n   <p class=\"f1\">Let Out Property</p></br>\n   \n   <p><b class=\"f1\">Total Income From Other Sources</b></p>\n   <p style=\"font-size: 10px;font-family: serif;\">Note: A maximum of Rs.200,000.00 is allowed as exemption\nfor housing loan interests on Self Occupied House Property\nand Let Out Property.</p>\n</td>\n\n<td style=\"border: 1px solid black;\"></br></br>\n\n {% set c_array11 = [] %}\n{% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80EE\" %}\n            <p class=\"m2\"  style=\"text-align:right\">{{ \"{:,}\".format(i.declared_amount|round| int) }}</p> \n            \n           \n            {% set _ = c_array11.append(i.declared_amount|round| int) %}\n           \n            \n            {% endif %}\n        {% endfor %}\n        \n         \n        {% set c_array11 = c_array11 | sum %}\n        \n        \n        {%else%}\n        <p class=\"m2\"  style=\"text-align:right\">0</p>\n        {% set c_array11 = 0 %}\n    {%endif%}\n \n    \n    <!--<p>value</p>-->\n    <p class=\"m2\"  style=\"text-align:right\">0</p></br>\n    \n    \n    \n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\"></br></br></br></br></br></br></br>\n\n{%if c_array11 %}\n<p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(c_array11|round| int) }}</b></p> \n\n{%else%}\n<p class=\"m2\"  style=\"text-align:right\"><b>0</b></p>\n{%endif%}\n</td>\n    \n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">9) Gross Total Income (7+8)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    {%set sum_tax=[]%}\n     {%if total or tax_total or form_16 or c_array11%} \n         \n         <p class=\"m2\" style=\"text-align:right\"><b>{{ \"{:,}\".format((total - tax_total - form_16 - c_array11) |round| int) }}</b></p>\n\n         \n         {% set t1= (total-tax_total-form_16-c_array11) |round|int%}\n \n         \n         \n          {% set _ = sum_tax.append(t1) %}\n         \n         \n         \n         \n         \n         {%else%}\n         <p class=\"m2\"  style=\"text-align:right\"><b>0</b></p>\n         \n         {%endif%}\n    \n   \n\n</td>\n    \n</tr>\n\n\n\n\n<tr>\n     <td style=\"border: 1px solid black;\">\n        \n         <p><b class=\"m2\">10) Deduction under chapter VI-A</b></p></br>\n   \n       <p class=\"f1\"><b>80C</b></p>\n       \n       {% set c_array1 = [] %}\n\n   {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80C\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\"> {{ \"{:,}\".format(i.declared_amount|round| int) }}</span>\n                \n                \n                {% set _ = c_array1.append(i.declared_amount|round| int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n        {% set c_array11 = c_array1 | sum %}\n       \n        \n    {% endif %}\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n            <p class=\"m2\">Qualifying</p></br>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n             \n            <p class=\"m2\">Deductible</p>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\" ><br><br><br><br><br><br>\n         \n         {%if c_array11%}\n             \n            <p class=\"m2\" style=\"text-align:right\"><b>{{ \"{:,}\".format(c_array11|round|int) }}</b></p>\n            \n            {%else%}\n             <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p>\n            {%endif%}\n             \n             \n         </td>\n    \n</tr>\n\n\n\n\n\n<tr>\n     <td style=\"border: 1px solid black;\">\n        \n         \n   \n       <p class=\"f1\"><b>80CCC</b></p>\n    \n     {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        {% set c_array2 = [] %}\n        \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80CCC\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\"> {{ \"{:,}\".format(i.declared_amount|round| int) }}</span>\n                \n                \n                {% set _ = c_array2.append(i.declared_amount|round| int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n         {% set c_array22 = c_array2 | sum %}\n       \n        \n    {% endif %}\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n            <p class=\"m2\">&nbsp;</p></br>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n             \n            <p class=\"m2\">&nbsp;</p>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\" ><br>\n          {%if c_array11%}\n             \n            <p class=\"m2\" style=\"text-align:right\"><b>{{ \"{:,}\".format(c_array22|round| int) }}</b></p>\n            \n            \n            \n            \n            {%else%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p>\n\n             {%endif%}\n             \n         </td>\n    \n</tr>\n\n\n\n<tr>\n     <td style=\"border: 1px solid black;\">\n        \n         \n   \n       <p class=\"f1\"><b>80CCD</b></p>\n    \n     {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n          {% set c_array3 = [] %}   \n          \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80CCD\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\"> {{ \"{:,}\".format(i.declared_amount|round|int) }}</span>\n                \n                {% set _ = c_array3.append(i.declared_amount|round|int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n       {% set c_array33 = c_array3 | sum %}\n        \n    {% endif %}\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n            <p class=\"m2\">&nbsp;</p></br>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\">\n             \n            <p class=\"m2\">&nbsp;</p>\n         </td>\n         \n         \n         <td style=\"border: 1px solid black;\" ><br>\n         \n         {%if c_array33%}\n             \n            <p class=\"m2\">{{ \"{:,}\".format(i.c_array33|round|int) }}</p>\n            {%else%}\n                        <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p>\n\n            {%endif%}\n             \n             \n         </td>\n    \n</tr>\n\n\n\n<tr>\n    <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>Total (80C+80CCC+80CCD)</b> </p>\n     </td>\n      <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>&nbsp;</b> </p>\n     </td>\n      <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>&nbsp;</b> </p>\n     </td>\n      <td style=\"border: 1px solid black;\">\n          {%if c_array11 or c_array22 or c_array33%}\n     <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">{{ \"{:,}\".format((c_array11 + c_array22 + c_array33)|round|int) }}</p></b> </p>\n     \n     {%else%}\n          <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p></b> </p>\n\n     {%endif%}\n     \n     </td>\n</tr>\n\n\n\n\n\n<tr>\n    <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>80CCD(1B)</b></p>\n    \n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n          {% set c_array4 = [] %}   \n          \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80CCD(1B)\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\">  {{ \"{:,}\".format(i.declared_amount|round|int) }}</span>\n                \n                {% set _ = c_array4.append(i.declared_amount|round|int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n       {% set c_array44 = c_array4 | sum %}\n        \n    {% endif %}\n    </td>\n    <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">\n            \n            {%if c_array44%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">{{ \"{:,}\".format(c_array44|round|int) }}</p></b> </p>\n            \n            {%else%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p></b> </p>\n\n            {%endif%}\n        </td>\n     \n</tr>\n\n\n\n\n\n\n<tr>\n    <td style=\"border: 1px solid black;\">\n     <p class=\"f1\"><b>80CCD(2)</b></p>\n    \n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n          {% set c_array5 = [] %}   \n          \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80CCD(2)\" %}\n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp; &nbsp; &nbsp;\n                <span style=\"float: right;\"> {{ \"{:,}\".format(i.declared_amount|round|int) }}</span>\n                {% set _ = c_array5.append(i.declared_amount|round|int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n       {% set c_array55 = c_array5 | sum %}\n        \n    {% endif %}\n    </td>\n    <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">\n            {%if c_array55%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">{{ \"{:,}\".format(c_array55|round|int) }}</p></b> </p>\n            {%else%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p></b> </p>\n\n            {%endif%}\n        </td>\n     \n</tr>\n\n\n\n\n\n<tr>\n    <td>\n    <p class=\"f1\"><b>80D</b></p>\n    \n   \n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n          {% set c_array6 = [] %}   \n          \n        {% for i in section.declaration_details %}\n            {% if i.exemption_category == \"Section 80D\" %}\n            \n            <p class=\"m2\">\n                * {{ i.exemption_sub_category }} &nbsp; &nbsp;\n                <span style=\"float: right;\">  {{ \"{:,}\".format(i.declared_amount|round|int) }}</span>\n                {% set _ = c_array6.append(i.declared_amount|round|int) %}\n            </p>\n                \n            {% endif %}\n        {% endfor %}\n        \n     \n        \n       {% set c_array66 = c_array6 | sum %}\n        \n    {% endif %}\n    </td>\n    <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">&nbsp;\n        </td>\n        <td style=\"border: 1px solid black;\">\n            \n            {%if c_array66 %}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">{{ \"{:,}\".format(c_array66|round|int) }}</p></b> </p>\n            {%else%}\n            <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p></b> </p>\n\n            {%endif%}\n        </td>\n     \n</tr>\n\n\n<tr>\n    \n     <td style=\"border: 1px solid black;\">\n         <p class=\"f1\"><b>Total of Deductions under Chapter VI-A</b></p>\n\n     </td>\n     <td style=\"border: 1px solid black;\">\n         &nbsp;\n         \n     </td>\n     <td style=\"border: 1px solid black;\">&nbsp;\n         \n     </td>\n     <td style=\"border: 1px solid black;\">\n         \n          {%if c_array66 or c_array55 or c_array44 or c_array11 or c_array22 or c_array33 %}\n         \n         <p class=\"f1\" style=\"text-align:right\"><b>{{ \"{:,}\".format((c_array66+c_array55+c_array44+c_array11 + c_array22 + c_array33)|round|int) }}</b></p>\n         \n         {% set _ = sum_tax.append(c_array66+c_array55+c_array44+c_array11 + c_array22 + c_array33|round|int) %}\n         \n         \n         \n         {%else%}\n         {% set _ = sum_tax.append(0) %}\n         <p class=\"f1\"><b><p class=\"f1\"  style=\"text-align:right\">0</p></b> </p>\n     {%endif%}\n     </td>\n    \n</tr>\n\n\n\n<tr>\n\n <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">11) Total Taxble Value  (9-10)</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    \n   \n    \n    \n    \n    \n    <p class=\"f1\"  style=\"text-align:right\"><b>{{ \"{:,}\".format((sum_tax[0]-sum_tax[1])|round|int) }}</b></p>\n    \n    \n    \n       \n    \n    \n   \n    \n      \n      \n      \n    \n    </td>\n        \n  </tr> \n  \n  \n  \n    <tr>\n      <td style=\"border: 1px solid black;\">\n          \n          <p><b class=\"m2\"> 12) Tax Calculation</b></p>\n          \n          {%if doc.custom_tax_slab|length>0%}\n          \n          \n          <table style=\"border:1px solid black;width:100%\">\n              <tr>\n                  <td style=\"width:70%;border:1px solid black\">\n                       <p class=\"f1\"><b> Taxable Income Range</b></p>\n                     \n                  </td>\n                  \n                  <td style=\"width:30%;border:1px solid black\">\n                     <p class=\"f1\"><b>  Tax Amount</b></p>\n                  </td>\n                  \n                  \n              </tr>\n              \n              {%for i in doc.custom_tax_slab%}\n              <tr>\n                  <td style=\"border:1px solid black\">\n                      {%if i.to_amount>0%}\n                       <p class=\"f1\"  >{{i.from_amount|round}}-{{i.to_amount|round}}<br>(Tax: of {{i.percentage}}% of {{i.amount|round}})</p>\n                  \n                        {%else%}\n                        {%if i.to_amount==0%}\n                        <p class=\"f1\"  >{{i.from_amount|round}} And Above<br>(Tax: of {{i.percentage}}% of {{i.amount|round}})</p>\n\n                        {%endif%}\n                        \n                {%endif%}\n\n                  \n                  </td>\n                  \n                  <td style=\"border:1px solid black\">\n                       <p class=\"f1\" style=\"text-align:right\" >{{i.tax_amount|round}}</p>\n                  </td>\n              </tr>\n              {%endfor%}\n          </table>\n          <br>\n          \n\n        {%endif%}\n         \n      </td>\n      <td style=\"border: 1px solid black;\">\n          \n      </td>\n      <td style=\"border: 1px solid black;\">\n          \n      </td>\n      <td style=\"border: 1px solid black;\">\n          \n          \n          \n      </td>\n  </tr>\n  \n  \n  \n  \n   \n  <tr>\n    \n    <td style=\"border: 1px solid black;\">\n        \n        {%if doc.custom_income_tax_slab==\"Old Regime\"%}\n    \n           <p class=\"f1\"><b>Tax on total Income</b></p>\n                  <p class=\"f1\"><b>Less : Rebate Under Section 87A</b></p>\n                  <p style=\"font-size:10px\">Note: If taxable income is less than Rs.500,000.00, tax rebate\n        of a maximum of Rs.12,500.00 is provided under Section 87A.</p></b></p>\n        \n        {%else%}\n        \n         <p class=\"f1\"><b>Tax on total Income</b></p>\n                  <p class=\"f1\"><b>Less : Rebate Under Section 87B</b></p>\n                  <p style=\"font-size:10px\">Note: If taxable income is less than Rs.700,000.00, tax rebate\n        of a maximum of Rs.25,000.00 is provided under Section 87A.</p></b></p>\n        \n        {%endif%}\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n\n        <p class=\"f1\" style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.custom_tax_on_total_income|round|int) }}</b></p>\n          <p class=\"f1\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.custom_rebate_under_section_87a|round|int) }}</b></p>\n          \n          \n          \n   \n\n</td>\n    \n    \n</tr>\n  \n  \n  \n  \n  \n  \n \n             \n  \n\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">13) Total Tax on Income</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n   \n         <p class=\"m2\"   style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.custom_total_tax_on_income|round|int) }}</b></p>\n         \n         \n        \n</td>\n    \n    \n</tr>\n\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n  \n   \n   \n   \n   \n                    <p class=\"m2\"><b>Surcharge</b></p>\n                    <p class=\"m2\"><b>Education Cess</b></p>\n                    <p class=\"m2\"><b>Less: Relief Under Section 89</b></p>\n                    \n\n \n   \n    </td>\n    \n    <td style=\"border: 1px solid black;\">\n       \n        &nbsp;\n    </td>\n    \n    <td style=\"border: 1px solid black;\">\n       \n        &nbsp;\n    </td>\n    <td style=\"border: 1px solid black;\">\n        \n      <p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.custom_surcharge|round|int) }}</b></p>\n             <p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.custom_education_cess|round|int) }}</b></p>\n             <p class=\"m2\"  style=\"text-align:right\"><b>0</b></p>\n            \n       </td>\n        \n       \n     \n    \n    \n</tr>\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">14) Tax Payable including Education cess minus of relief under section 89</b></p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    \n        \n              \n         <p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format((doc.custom_total_tax_on_income + doc.custom_surcharge + doc.custom_education_cess)|round|int) }}</b></p>\n         \n\n             \n           \n    \n</td>\n    \n    \n</tr>\n\n\n\n<tr>\n\n <td style=\"border: 1px solid black;\">\n   <p><b class=\"m2\">15) Tax Deducted at source u/s 192</b></p>\n   </br> \n   <p class=\"m2\">* TDS till last month</p>\n   <p class=\"m2\">* TDS of the month</p>\n   <p class=\"m2\">* TDS by Previous Employer</p></br>\n   <p class=\"m2\">Total Tax Deducted at source</p></br>\n   <p class=\"m2\">Tax Payable / Refundable (14 - 15(A))</p>\n   <p class=\"m2\">TDS per month for the next {{doc.custom_month_count}} months</p>\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n   {% set tax_exemption = frappe.get_list(\n        \"Salary Slip\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)],\n            \"custom_payroll_period\":doc.custom_payroll_period\n        },\n        fields=[\"*\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%if tax_exemption|length>0 %}\n    \n    {%set tds_sum=[]%}\n    {%for j in tax_exemption %}\n    {%if j.name!=doc.name%}\n    \n    {%set _ = tds_sum.append(j.current_month_income_tax)%}\n    \n    \n    \n    \n    \n    \n    \n    {%endif%}\n    \n    {%endfor%}\n    \n    {%endif%}\n    \n    {%set j1=tds_sum|sum%}\n    \n    </br>    </br>\n   <p class=\"m2\"  style=\"text-align:right\">{{j1|round|int}}</p>\n   \n   \n     \n{%if doc.current_month_income_tax > 0%}\n{%set month_tds=doc.custom_total_amount/12%}\n<p class=\"m2\"  style=\"text-align:right\">{{ \"{:,}\".format(doc.current_month_income_tax|round|int) }}</p>\n{%else%}\n<p class=\"m2\"  style=\"text-align:right\">0</p>\n{%endif%}\n\n\n\n        <p class=\"m2\"  style=\"text-align:right\">0</p></br>\n\n\n\n\n\n\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\"></br>    </br></br>    </br></br>    </br></br>\n{%if doc.current_month_income_tax > 0%}\n    <p class=\"m2\"  style=\"text-align:right\"><b>{{(doc.current_month_income_tax+j1)|round|int}}</b></p>\n    \n    {%else%}\n<p class=\"m2\"  style=\"text-align:right\">0</p>\n{%endif%}\n \n {%set j2=doc.current_month_income_tax+j1%}\n {%set j3=doc.custom_total_tax_on_income + doc.custom_surcharge + doc.custom_education_cess%}\n {%set final=j3-j2%}\n <br>\n <p class=\"m2\"  style=\"text-align:right\"><b>{{(final)|round|int}}</b></p>\n {#\n <p class=\"m2\"  style=\"text-align:right\"><b>{{(final/doc.custom_month_count)|round|int}}</b></p>\n #}\n <p class=\"m2\"  style=\"text-align:right\"><b>{{(doc.current_month_income_tax|round|int)}}</b></p>\n\n</td>\n    \n\n</tr>\n\n\n\n\n\n<tr>\n    \n    <td style=\"border: 1px solid black;\">\n        <p class=\"m2\"><b>TDS for {{doc.custom_month}}</b></p>\n   </td>\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n\n<td style=\"border: 1px solid black;\">\n   \n    &nbsp;\n</td>\n<td style=\"border: 1px solid black;\">\n    {%if doc.current_month_income_tax > 0%}\n    \n    <p class=\"m2\"  style=\"text-align:right\"><b>{{ \"{:,}\".format(doc.current_month_income_tax|round|int) }}</b></p>\n    {%else%}\n<p class=\"m2\"  style=\"text-align:right\">0</p>\n{%endif%}\n</td>\n    \n    \n</tr>\n\n\n\n\n\n\n\n\n\n\n\n\n\n</table>\n\n\n<br>\n<table style=\"width:100%;border:1px solid black\">\n    \n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%set sum_array=[]%}\n    {%if tax_exemption|length>0 %}\n        {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        \n        {% if section.hra_breakup| length > 0 %}\n    \n    \n    <tr>\n        <td class=\"m2\" style=\"border:1px solid black\">Month</td>\n        <td class=\"m2\" style=\"border:1px solid black\">Rent Paid</td>\n        <td class=\"m2\" style=\"border:1px solid black\">% of Earned Basic(Metro 50%, Non-Metro 40%)</td>\n        <td class=\"m2\" style=\"border:1px solid black\">HRA Received</td>\n        <td class=\"m2\" style=\"border:1px solid black\">Excess of Rent Paid Over 10% of Basic</td>\n        <td class=\"m2\" style=\"border:1px solid black\">Exemption Amount</td>\n    </tr>\n    \n    {% endif %}\n    {% endif %}\n    \n    \n    \n    {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%set sum_array=[]%}\n    {%if tax_exemption|length>0 %}\n        {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        \n        {% if section.hra_breakup| length > 0 %}\n            {% for i in section.hra_breakup %}\n                <tr>\n                   <td class=\"m2\" style=\"border:1px solid black\">{{ i.month}}</td>\n                    <td class=\"m2\" style=\"border:1px solid black\">{{ i.rent_paid|int }}</td>\n                    <td class=\"m2\" style=\"border:1px solid black\">{{ i.earned_basic|int }}</td>\n                    {% set _ = sum_array.append(i.earned_basic | int) %}\n                    \n                    <td class=\"m2\" style=\"border:1px solid black\">{{ i.hra_received|int }}</td>\n                    <td class=\"m2\" style=\"border:1px solid black\">{{ i.excess_of_rent_paid|int }}</td>\n                    <td class=\"m2\" style=\"border:1px solid black\">{{ i.exemption_amount|int }}</td>\n                    \n                    \n                </tr>\n           \n     {% endfor %}\n    {% set b = sum_array | sum %}\n    \n    \n    <tr>\n        <td class=\"m2\" style=\"border:1px solid black\"><b>Total</b></td>\n        <td class=\"m2\" style=\"border:1px solid black\"><b>{{((section.monthly_house_rent*12)|round|int)}}</b></td>\n        \n        <td class=\"m2\" style=\"border:1px solid black\"><b>{{b}}</b></td>\n        <td class=\"m2\" style=\"border:1px solid black\"><b>{{section.hra_as_per_salary_structure|round|int}}</b></td>\n        <td class=\"m2\" style=\"border:1px solid black\"><b>{{section.annual_hra_exemption|round|int}}</b></td>\n        <td class=\"m2\" style=\"border:1px solid black\"><b>{{section.annual_hra_exemption|round|int}}</b></td>\n        \n    </tr>\n</table><br>\n\n\n        {% endif %}\n    {% endif %}\n    \n    \n {% set tax_exemption = frappe.get_list(\n        \"Tax Declaration History\",\n        filters={\n            \"employee\": doc.employee,\n            \"posting_date\": [\"<=\", frappe.utils.getdate(doc.end_date)]\n        },\n        fields=[\"name\", \"posting_date\"],\n        order_by=\"posting_date desc\"\n    ) %}\n    \n    {%set sum_array=[]%}\n    {%if tax_exemption|length>0 %}\n        {% set section = frappe.get_doc(\"Tax Declaration History\", tax_exemption[0].name) %}\n        \n        \n        \n        {% if section.hra_breakup| length > 0 %}   \n    \n<table style=\"border:1px solid black;width:100%\">\n    <tr>\n        <td class=\"m2\" >\n            Total House Rent Allowance Exemption Amount\nLeast amount of the three columns (% of Earned Basic, HRA Received and Excess of Rent Paid\nOver 10% of Basic) will be considered for tax exemption under HRA\n        </td>\n        <td class=\"m2\" >\n            <b>{{section.annual_hra_exemption|round|int}}</b>\n        </td>\n    </tr>\n</table>\n    {% endif %}\n    {% endif %}\n\n</body>\n</html>\n",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2024-10-09 22:50:00.681650",
  "module": "cn-indian-payroll",
  "name": "TDS WorkSheet",
  "page_number": "Hide",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 }
]